var Xt=Object.defineProperty,er=Object.defineProperties;var tr=Object.getOwnPropertyDescriptors;var lt=Object.getOwnPropertySymbols;var rr=Object.prototype.hasOwnProperty,ar=Object.prototype.propertyIsEnumerable;var sr=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r);var Fe=(r,e,t)=>e in r?Xt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,V=(r,e)=>{for(var t in e||(e={}))rr.call(e,t)&&Fe(r,t,e[t]);if(lt)for(var t of lt(e))ar.call(e,t)&&Fe(r,t,e[t]);return r},le=(r,e)=>er(r,tr(e));var nr=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var G=(r,e,t)=>Fe(r,typeof e!="symbol"?e+"":e,t);var b=(r,e,t)=>new Promise((s,n)=>{var o=l=>{try{c(t.next(l))}catch(d){n(d)}},i=l=>{try{c(t.throw(l))}catch(d){n(d)}},c=l=>l.done?s(l.value):Promise.resolve(l.value).then(o,i);c((t=t.apply(r,e)).next())}),Me=function(r,e){this[0]=r,this[1]=e},ct=(r,e,t)=>{var s=(i,c,l,d)=>{try{var h=t[i](c),x=(c=h.value)instanceof Me,f=h.done;Promise.resolve(x?c[0]:c).then(g=>x?s(i==="return"?i:"next",c[1]?{done:g.done,value:g.value}:g,l,d):l({value:g,done:f})).catch(g=>s("throw",g,l,d))}catch(g){d(g)}},n=i=>o[i]=c=>new Promise((l,d)=>s(i,c,l,d)),o={};return t=t.apply(r,e),o[sr("asyncIterator")]=()=>o,n("next"),n("throw"),n("return"),o};import{r as or,a as ir,g as lr}from"./vendor-DwRCIQB9.js";import{R as ce,r as m,I as he,_ as me,B as D,P as cr,F as S,M as Le,a as ae,T as dr,S as q,b as dt,c as ur,d as hr,U as zt,s as O,e as mr,f as fr,g as gr,C as pr,t as ut}from"./ui-CcgbCK45.js";import{S as ht,L as Ue,P as br,D as xr,a as yr,C as mt,H as wr,_ as Pe}from"./aws-MgGeQvF_.js";var Ja=nr(T=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();var De={exports:{}},be={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ft;function vr(){if(ft)return be;ft=1;var r=or(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,n=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function i(c,l,d){var h,x={},f=null,g=null;d!==void 0&&(f=""+d),l.key!==void 0&&(f=""+l.key),l.ref!==void 0&&(g=l.ref);for(h in l)s.call(l,h)&&!o.hasOwnProperty(h)&&(x[h]=l[h]);if(c&&c.defaultProps)for(h in l=c.defaultProps,l)x[h]===void 0&&(x[h]=l[h]);return{$$typeof:e,type:c,key:f,ref:g,props:x,_owner:n.current}}return be.Fragment=t,be.jsx=i,be.jsxs=i,be}var gt;function kr(){return gt||(gt=1,De.exports=vr()),De.exports}var a=kr(),Oe={},pt;function jr(){if(pt)return Oe;pt=1;var r=ir();return Oe.createRoot=r.createRoot,Oe.hydrateRoot=r.hydrateRoot,Oe}var Cr=jr(),xe={},ze={exports:{}},bt;function Te(){return bt||(bt=1,(function(r){function e(t){return t&&t.__esModule?t:{default:t}}r.exports=e,r.exports.__esModule=!0,r.exports.default=r.exports})(ze)),ze.exports}var ye={},xt;function Sr(){if(xt)return ye;xt=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.default=void 0;var r={items_per_page:"条/页",jump_to:"跳至",jump_to_confirm:"确定",page:"页",prev_page:"上一页",next_page:"下一页",prev_5:"向前 5 页",next_5:"向后 5 页",prev_3:"向前 3 页",next_3:"向后 3 页",page_size:"页码"};return ye.default=r,ye}var we={},ve={},ke={},Be={exports:{}},Ae={exports:{}},Ve={exports:{}},qe={exports:{}},yt;function Bt(){return yt||(yt=1,(function(r){function e(t){"@babel/helpers - typeof";return r.exports=e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},r.exports.__esModule=!0,r.exports.default=r.exports,e(t)}r.exports=e,r.exports.__esModule=!0,r.exports.default=r.exports})(qe)),qe.exports}var Ke={exports:{}},wt;function Pr(){return wt||(wt=1,(function(r){var e=Bt().default;function t(s,n){if(e(s)!="object"||!s)return s;var o=s[Symbol.toPrimitive];if(o!==void 0){var i=o.call(s,n||"default");if(e(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(s)}r.exports=t,r.exports.__esModule=!0,r.exports.default=r.exports})(Ke)),Ke.exports}var vt;function Nr(){return vt||(vt=1,(function(r){var e=Bt().default,t=Pr();function s(n){var o=t(n,"string");return e(o)=="symbol"?o:o+""}r.exports=s,r.exports.__esModule=!0,r.exports.default=r.exports})(Ve)),Ve.exports}var kt;function Ir(){return kt||(kt=1,(function(r){var e=Nr();function t(s,n,o){return(n=e(n))in s?Object.defineProperty(s,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):s[n]=o,s}r.exports=t,r.exports.__esModule=!0,r.exports.default=r.exports})(Ae)),Ae.exports}var jt;function Mr(){return jt||(jt=1,(function(r){var e=Ir();function t(n,o){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);o&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),i.push.apply(i,c)}return i}function s(n){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?arguments[o]:{};o%2?t(Object(i),!0).forEach(function(c){e(n,c,i[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(i,c))})}return n}r.exports=s,r.exports.__esModule=!0,r.exports.default=r.exports})(Be)),Be.exports}var je={},Ct;function Or(){return Ct||(Ct=1,Object.defineProperty(je,"__esModule",{value:!0}),je.commonLocale=void 0,je.commonLocale={yearFormat:"YYYY",dayFormat:"D",cellMeridiemFormat:"A",monthBeforeYear:!0}),je}var St;function _r(){if(St)return ke;St=1;var r=Te().default;Object.defineProperty(ke,"__esModule",{value:!0}),ke.default=void 0;var e=r(Mr()),t=Or(),s=(0,e.default)((0,e.default)({},t.commonLocale),{},{locale:"zh_CN",today:"今天",now:"此刻",backToToday:"返回今天",ok:"确定",timeSelect:"选择时间",dateSelect:"选择日期",weekSelect:"选择周",clear:"清除",week:"周",month:"月",year:"年",previousMonth:"上个月 (翻页上键)",nextMonth:"下个月 (翻页下键)",monthSelect:"选择月份",yearSelect:"选择年份",decadeSelect:"选择年代",previousYear:"上一年 (Control键加左方向键)",nextYear:"下一年 (Control键加右方向键)",previousDecade:"上一年代",nextDecade:"下一年代",previousCentury:"上一世纪",nextCentury:"下一世纪",yearFormat:"YYYY年",cellDateFormat:"D",monthBeforeYear:!1});return ke.default=s,ke}var Ce={},Pt;function At(){if(Pt)return Ce;Pt=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.default=void 0;const r={placeholder:"请选择时间",rangePlaceholder:["开始时间","结束时间"]};return Ce.default=r,Ce}var Nt;function Vt(){if(Nt)return ve;Nt=1;var r=Te().default;Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=void 0;var e=r(_r()),t=r(At());const s={lang:Object.assign({placeholder:"请选择日期",yearPlaceholder:"请选择年份",quarterPlaceholder:"请选择季度",monthPlaceholder:"请选择月份",weekPlaceholder:"请选择周",rangePlaceholder:["开始日期","结束日期"],rangeYearPlaceholder:["开始年份","结束年份"],rangeMonthPlaceholder:["开始月份","结束月份"],rangeQuarterPlaceholder:["开始季度","结束季度"],rangeWeekPlaceholder:["开始周","结束周"]},e.default),timePickerLocale:Object.assign({},t.default)};return s.lang.ok="确定",ve.default=s,ve}var It;function Er(){if(It)return we;It=1;var r=Te().default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=void 0;var e=r(Vt());return we.default=e.default,we}var Mt;function $r(){if(Mt)return xe;Mt=1;var r=Te().default;Object.defineProperty(xe,"__esModule",{value:!0}),xe.default=void 0;var e=r(Sr()),t=r(Er()),s=r(Vt()),n=r(At());const o="${label}不是一个有效的${type}",i={locale:"zh-cn",Pagination:e.default,DatePicker:s.default,TimePicker:n.default,Calendar:t.default,global:{placeholder:"请选择",close:"关闭"},Table:{filterTitle:"筛选",filterConfirm:"确定",filterReset:"重置",filterEmptyText:"无筛选项",filterCheckAll:"全选",filterSearchPlaceholder:"在筛选项中搜索",emptyText:"暂无数据",selectAll:"全选当页",selectInvert:"反选当页",selectNone:"清空所有",selectionAll:"全选所有",sortTitle:"排序",expand:"展开行",collapse:"关闭行",triggerDesc:"点击降序",triggerAsc:"点击升序",cancelSort:"取消排序"},Modal:{okText:"确定",cancelText:"取消",justOkText:"知道了"},Tour:{Next:"下一步",Previous:"上一步",Finish:"结束导览"},Popconfirm:{cancelText:"取消",okText:"确定"},Transfer:{titles:["",""],searchPlaceholder:"请输入搜索内容",itemUnit:"项",itemsUnit:"项",remove:"删除",selectCurrent:"全选当页",removeCurrent:"删除当页",selectAll:"全选所有",deselectAll:"取消全选",removeAll:"删除全部",selectInvert:"反选当页"},Upload:{uploading:"文件上传中",removeFile:"删除文件",uploadError:"上传错误",previewFile:"预览文件",downloadFile:"下载文件"},Empty:{description:"暂无数据"},Icon:{icon:"图标"},Text:{edit:"编辑",copy:"复制",copied:"复制成功",expand:"展开",collapse:"收起"},Form:{optional:"（可选）",defaultValidateMessages:{default:"字段验证错误${label}",required:"请输入${label}",enum:"${label}必须是其中一个[${enum}]",whitespace:"${label}不能为空字符",date:{format:"${label}日期格式无效",parse:"${label}不能转换为日期",invalid:"${label}是一个无效日期"},types:{string:o,method:o,array:o,object:o,number:o,date:o,boolean:o,integer:o,float:o,regexp:o,email:o,url:o,hex:o},string:{len:"${label}须为${len}个字符",min:"${label}最少${min}个字符",max:"${label}最多${max}个字符",range:"${label}须在${min}-${max}字符之间"},number:{len:"${label}必须等于${len}",min:"${label}最小值为${min}",max:"${label}最大值为${max}",range:"${label}须在${min}-${max}之间"},array:{len:"须为${len}个${label}",min:"最少${min}个${label}",max:"最多${max}个${label}",range:"${label}数量须在${min}-${max}之间"},pattern:{mismatch:"${label}与模式不匹配${pattern}"}}},Image:{preview:"预览"},QRCode:{expired:"二维码过期",refresh:"点击刷新",scanned:"已扫描"},ColorPicker:{presetEmpty:"暂无",transparent:"无色",singleColor:"单色",gradientColor:"渐变色"}};return xe.default=i,xe}var We,Ot;function Lr(){return Ot||(Ot=1,We=$r()),We}var Tr=Lr();const Rr=lr(Tr),_t=r=>{let e;const t=new Set,s=(d,h)=>{const x=typeof d=="function"?d(e):d;if(!Object.is(x,e)){const f=e;e=(h!=null?h:typeof x!="object"||x===null)?x:Object.assign({},e,x),t.forEach(g=>g(e,f))}},n=()=>e,c={setState:s,getState:n,getInitialState:()=>l,subscribe:d=>(t.add(d),()=>t.delete(d))},l=e=r(s,n,c);return c},Fr=(r=>r?_t(r):_t),Ur=r=>r;function Dr(r,e=Ur){const t=ce.useSyncExternalStore(r.subscribe,ce.useCallback(()=>e(r.getState()),[r,e]),ce.useCallback(()=>e(r.getInitialState()),[r,e]));return ce.useDebugValue(t),t}const Et=r=>{const e=Fr(r),t=s=>Dr(e,s);return Object.assign(t,e),t},te=(r=>r?Et(r):Et),He="s3-gallery-config",Ge="s3-gallery-theme",Ye="s3-gallery-app-config",Se={itemsPerPage:20,copyFormat:"url",uploadFormat:"original",uploadNameStrategy:"original",uploadTargetPath:"current",uploadCustomPath:""};class zr{saveConfig(e){try{const t=JSON.stringify(e);localStorage.setItem(He,t)}catch(t){throw console.error("保存配置失败:",t),new Error("保存配置失败")}}loadConfig(){try{const e=localStorage.getItem(He);return e?JSON.parse(e):null}catch(e){return console.error("加载配置失败:",e),null}}exportConfig(){const e=this.loadConfig(),t=this.loadAppConfig();if(!e)throw new Error("没有可导出的配置");return JSON.stringify({s3:e,app:t},null,2)}importConfig(e){var t,s,n,o;try{const i=JSON.parse(e);if(i.accessKeyId){const l=i;if(!l.accessKeyId||!l.secretAccessKey||!l.endpoint||!l.bucket)throw new Error("配置文件缺少必填字段");return{s3:l,app:Se}}const c=i;if(!((t=c.s3)!=null&&t.accessKeyId)||!((s=c.s3)!=null&&s.secretAccessKey)||!((n=c.s3)!=null&&n.endpoint)||!((o=c.s3)!=null&&o.bucket))throw new Error("配置文件缺少必填字段");return c.app=V(V({},Se),c.app),c}catch(i){throw i instanceof SyntaxError?new Error("配置文件格式无效"):i}}saveAppConfig(e){try{const t=JSON.stringify(e);localStorage.setItem(Ye,t)}catch(t){throw console.error("保存应用配置失败:",t),new Error("保存应用配置失败")}}loadAppConfig(){try{const e=localStorage.getItem(Ye);if(!e)return Se;const t=JSON.parse(e);return V(V({},Se),t)}catch(e){return console.error("加载应用配置失败:",e),Se}}saveTheme(e){try{localStorage.setItem(Ge,e)}catch(t){console.error("保存主题失败:",t)}}loadTheme(){try{const e=localStorage.getItem(Ge);return e==="dark"||e==="light"?e:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch(e){return"light"}}clearAll(){localStorage.removeItem(He),localStorage.removeItem(Ge),localStorage.removeItem(Ye)}}const re=new zr,$=te(r=>({theme:"light",uploadModalVisible:!1,settingsModalVisible:!1,viewerVisible:!1,currentImageIndex:0,renameModalVisible:!1,moveModalVisible:!1,createFolderModalVisible:!1,currentOperationItem:null,toggleTheme:()=>r(e=>{const t=e.theme==="light"?"dark":"light";return re.saveTheme(t),{theme:t}}),showUploadModal:()=>r({uploadModalVisible:!0}),hideUploadModal:()=>r({uploadModalVisible:!1}),showSettingsModal:()=>r({settingsModalVisible:!0}),hideSettingsModal:()=>r({settingsModalVisible:!1}),showViewer:e=>r({viewerVisible:!0,currentImageIndex:e}),hideViewer:()=>r({viewerVisible:!1}),setCurrentImageIndex:e=>r({currentImageIndex:e}),loadThemeFromStorage:()=>{const e=re.loadTheme();r({theme:e})},showRenameModal:e=>r({renameModalVisible:!0,currentOperationItem:e}),hideRenameModal:()=>r({renameModalVisible:!1,currentOperationItem:null}),showMoveModal:e=>r({moveModalVisible:!0,currentOperationItem:e}),hideMoveModal:()=>r({moveModalVisible:!1,currentOperationItem:null}),showCreateFolderModal:()=>r({createFolderModalVisible:!0}),hideCreateFolderModal:()=>r({createFolderModalVisible:!1})}));class qt{constructor(e){G(this,"client");G(this,"config");this.config=e,this.client=new ht({region:e.region,endpoint:e.endpoint,credentials:{accessKeyId:e.accessKeyId,secretAccessKey:e.secretAccessKey},forcePathStyle:!0})}listObjects(e){return b(this,null,function*(){try{const t=new Ue({Bucket:this.config.bucket,Prefix:e,Delimiter:"/"}),s=yield this.client.send(t),n=[];if(s.CommonPrefixes)for(const o of s.CommonPrefixes)o.Prefix&&n.push({key:o.Prefix,size:0,lastModified:new Date,isFolder:!0});if(s.Contents)for(const o of s.Contents)o.Key&&o.Key!==e&&n.push({key:o.Key,size:o.Size||0,lastModified:o.LastModified||new Date,isFolder:!1});return n}catch(t){throw console.error("列出对象失败:",t),new Error(`列出对象失败: ${t instanceof Error?t.message:"未知错误"}`)}})}uploadObject(e,t){return b(this,null,function*(){try{const s=yield t.arrayBuffer(),n=new Uint8Array(s),o=new br({Bucket:this.config.bucket,Key:e,Body:n,ContentType:t.type});yield this.client.send(o)}catch(s){throw console.error("上传对象失败:",s),new Error(`上传对象失败: ${s instanceof Error?s.message:"未知错误"}`)}})}deleteObject(e){return b(this,null,function*(){try{if(e.endsWith("/"))yield this.deleteFolderRecursive(e);else{const s=new xr({Bucket:this.config.bucket,Key:e});yield this.client.send(s)}}catch(t){throw console.error("删除对象失败:",t),new Error(`删除对象失败: ${t instanceof Error?t.message:"未知错误"}`)}})}deleteFolderRecursive(e){return b(this,null,function*(){const t=new Ue({Bucket:this.config.bucket,Prefix:e}),s=yield this.client.send(t);if(!s.Contents||s.Contents.length===0)return;const n=s.Contents.map(o=>o.Key).filter(Boolean);n.length>0&&(yield this.deleteObjects(n))})}deleteObjects(e){return b(this,null,function*(){const t={success:[],failed:[]};if(e.length===0)return t;try{for(let n=0;n<e.length;n+=1e3){const o=e.slice(n,n+1e3),i=new yr({Bucket:this.config.bucket,Delete:{Objects:o.map(l=>({Key:l})),Quiet:!1}}),c=yield this.client.send(i);if(c.Deleted)for(const l of c.Deleted)l.Key&&t.success.push(l.Key);if(c.Errors)for(const l of c.Errors)l.Key&&t.failed.push({key:l.Key,error:l.Message||"未知错误"})}}catch(s){console.error("批量删除对象失败:",s);for(const n of e)t.success.includes(n)||t.failed.push({key:n,error:s instanceof Error?s.message:"未知错误"})}return t})}renameObject(e,t){return b(this,null,function*(){try{if(e.endsWith("/"))yield this.renameFolderRecursive(e,t);else{const n=new mt({Bucket:this.config.bucket,CopySource:`${this.config.bucket}/${e}`,Key:t});yield this.client.send(n),yield this.deleteObject(e)}}catch(s){throw console.error("重命名对象失败:",s),new Error(`重命名对象失败: ${s instanceof Error?s.message:"未知错误"}`)}})}renameFolderRecursive(e,t){return b(this,null,function*(){const s=new Ue({Bucket:this.config.bucket,Prefix:e}),n=yield this.client.send(s);if(!n.Contents||n.Contents.length===0){yield this.uploadObject(t,new Blob([])),yield this.deleteObject(e);return}const o=n.Contents.map(c=>b(this,null,function*(){if(!c.Key)return;const l=c.Key.substring(e.length),d=t+l;if(c.Key.endsWith("/")&&(c.Size===0||!c.Size))return;const h=new mt({Bucket:this.config.bucket,CopySource:`${this.config.bucket}/${c.Key}`,Key:d});yield this.client.send(h)}));yield Promise.all(o),yield this.uploadObject(t,new Blob([]));const i=n.Contents.map(c=>c.Key).filter(Boolean);i.length>0&&(yield this.deleteObjects(i))})}moveObject(e,t){return b(this,null,function*(){return this.renameObject(e,t)})}testConnection(){return b(this,null,function*(){try{const e=new wr({Bucket:this.config.bucket});return yield this.client.send(e),!0}catch(e){return console.error("测试连接失败:",e),!1}})}getObjectUrl(e){if(this.config.customDomain)return`${this.config.customDomain.replace(/\/$/,"")}/${e}`;const t=this.config.endpoint.replace(/\/$/,"");return t.includes("://")?`${t}/${this.config.bucket}/${e}`:`https://${t}/${this.config.bucket}/${e}`}updateConfig(e){this.config=e,this.client=new ht({region:e.region,endpoint:e.endpoint,credentials:{accessKeyId:e.accessKeyId,secretAccessKey:e.secretAccessKey},forcePathStyle:!0})}destroy(){this.client.destroy()}}let se=null;function _e(r){return se&&se.destroy(),se=new qt(r),se}function ee(){return se}function Kt(){se&&(se.destroy(),se=null)}const Wt=Object.freeze(Object.defineProperty({__proto__:null,S3Service:qt,destroyS3Service:Kt,getS3Service:ee,initS3Service:_e},Symbol.toStringTag,{value:"Module"})),de=te(r=>({config:null,isInitialized:!1,setConfig:e=>{_e(e),r({config:e,isInitialized:!0})},clearConfig:()=>{Kt(),re.saveConfig({}),r({config:null,isInitialized:!1})},loadConfigFromStorage:()=>{const e=re.loadConfig();e?(_e(e),r({config:e,isInitialized:!0})):r({isInitialized:!0})},saveConfigToStorage:e=>{re.saveConfig(e),_e(e),r({config:e,isInitialized:!0})}})),Ht=te(r=>({corsAvailable:null,corsErrorShown:!1,setCorsAvailable:e=>r({corsAvailable:e}),setCorsErrorShown:e=>r({corsErrorShown:e}),resetCorsState:()=>r({corsAvailable:null,corsErrorShown:!1})})),Ne=te((r,e)=>({itemsPerPage:20,copyFormat:"url",uploadFormat:"original",uploadNameStrategy:"original",uploadTargetPath:"current",uploadCustomPath:"",setItemsPerPage:t=>{r({itemsPerPage:t}),e().saveToStorage()},setCopyFormat:t=>{r({copyFormat:t}),e().saveToStorage()},setUploadFormat:t=>{r({uploadFormat:t}),e().saveToStorage()},setUploadNameStrategy:t=>{r({uploadNameStrategy:t}),e().saveToStorage()},setUploadTargetPath:t=>{r({uploadTargetPath:t}),e().saveToStorage()},setUploadCustomPath:t=>{r({uploadCustomPath:t}),e().saveToStorage()},loadFromStorage:()=>{const t=re.loadAppConfig();r(t)},saveToStorage:()=>{const{itemsPerPage:t,copyFormat:s,uploadFormat:n,uploadNameStrategy:o,uploadTargetPath:i,uploadCustomPath:c}=e();re.saveAppConfig({itemsPerPage:t,copyFormat:s,uploadFormat:n,uploadNameStrategy:o,uploadTargetPath:i,uploadCustomPath:c})}}));var Br={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},Ar=function(e,t){return m.createElement(he,me({},e,{ref:t,icon:Br}))},Vr=m.forwardRef(Ar),qr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M484 443.1V528h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H484v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V584h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H540v-84.9c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1zm396-144.7H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z"}}]},name:"folder-add",theme:"outlined"},Kr=function(e,t){return m.createElement(he,me({},e,{ref:t,icon:qr}))},et=m.forwardRef(Kr),Wr={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},Hr=function(e,t){return m.createElement(he,me({},e,{ref:t,icon:Wr}))},Gr=m.forwardRef(Hr),Yr={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M489.5 111.66c30.65-1.8 45.98 36.44 22.58 56.33A243.35 243.35 0 00426 354c0 134.76 109.24 244 244 244 72.58 0 139.9-31.83 186.01-86.08 19.87-23.38 58.07-8.1 56.34 22.53C900.4 745.82 725.15 912 512.5 912 291.31 912 112 732.69 112 511.5c0-211.39 164.29-386.02 374.2-399.65l.2-.01zm-81.15 79.75l-4.11 1.36C271.1 237.94 176 364.09 176 511.5 176 697.34 326.66 848 512.5 848c148.28 0 274.94-96.2 319.45-230.41l.63-1.93-.11.07a307.06 307.06 0 01-159.73 46.26L670 662c-170.1 0-308-137.9-308-308 0-58.6 16.48-114.54 46.27-162.47z"}}]},name:"moon",theme:"outlined"},Zr=function(e,t){return m.createElement(he,me({},e,{ref:t,icon:Yr}))},Jr=m.forwardRef(Zr),Qr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"},Xr=function(e,t){return m.createElement(he,me({},e,{ref:t,icon:Qr}))},$t=m.forwardRef(Xr),ea={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M548 818v126a16 16 0 01-16 16h-40a16 16 0 01-16-16V818c15.85 1.64 27.84 2.46 36 2.46 8.15 0 20.16-.82 36-2.46m205.25-115.66l89.1 89.1a16 16 0 010 22.62l-28.29 28.29a16 16 0 01-22.62 0l-89.1-89.1c12.37-10.04 21.43-17.95 27.2-23.71 5.76-5.77 13.67-14.84 23.71-27.2m-482.5 0c10.04 12.36 17.95 21.43 23.71 27.2 5.77 5.76 14.84 13.67 27.2 23.71l-89.1 89.1a16 16 0 01-22.62 0l-28.29-28.29a16 16 0 010-22.63zM512 278c129.24 0 234 104.77 234 234S641.24 746 512 746 278 641.24 278 512s104.77-234 234-234m0 72c-89.47 0-162 72.53-162 162s72.53 162 162 162 162-72.53 162-162-72.53-162-162-162M206 476c-1.64 15.85-2.46 27.84-2.46 36 0 8.15.82 20.16 2.46 36H80a16 16 0 01-16-16v-40a16 16 0 0116-16zm738 0a16 16 0 0116 16v40a16 16 0 01-16 16H818c1.64-15.85 2.46-27.84 2.46-36 0-8.15-.82-20.16-2.46-36zM814.06 180.65l28.29 28.29a16 16 0 010 22.63l-89.1 89.09c-10.04-12.37-17.95-21.43-23.71-27.2-5.77-5.76-14.84-13.67-27.2-23.71l89.1-89.1a16 16 0 0122.62 0m-581.5 0l89.1 89.1c-12.37 10.04-21.43 17.95-27.2 23.71-5.76 5.77-13.67 14.84-23.71 27.2l-89.1-89.1a16 16 0 010-22.62l28.29-28.29a16 16 0 0122.62 0M532 64a16 16 0 0116 16v126c-15.85-1.64-27.84-2.46-36-2.46-8.15 0-20.16.82-36 2.46V80a16 16 0 0116-16z"}}]},name:"sun",theme:"outlined"},ta=function(e,t){return m.createElement(he,me({},e,{ref:t,icon:ea}))},ra=m.forwardRef(ta),aa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},sa=function(e,t){return m.createElement(he,me({},e,{ref:t,icon:aa}))},tt=m.forwardRef(sa);function na(){const r=$(i=>i.theme),e=$(i=>i.toggleTheme),t=$(i=>i.showUploadModal),s=$(i=>i.showSettingsModal),n=$(i=>i.showCreateFolderModal),o=r==="dark";return a.jsx("header",{role:"banner",className:`sticky top-0 z-50 border-b ${o?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:a.jsxs("div",{className:"w-full px-3 sm:px-4 h-14 sm:h-16 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[a.jsx("img",{src:"/logo.svg",alt:"鱼鱼图床",className:`w-7 h-7 sm:w-8 sm:h-8 ${o?"brightness-0 invert":""}`}),a.jsx("h1",{className:`text-base sm:text-lg md:text-xl font-bold ${o?"text-white":"text-gray-900"}`,children:"鱼鱼图床"})]}),a.jsxs("nav",{className:"flex items-center gap-1 sm:gap-2","aria-label":"主要操作",children:[a.jsx(D,{type:"text",icon:o?a.jsx(ra,{}):a.jsx(Jr,{}),onClick:e,"aria-label":o?"切换到浅色模式":"切换到深色模式",title:o?"切换到浅色模式":"切换到深色模式",className:`${o?"text-gray-300 hover:text-white":""} min-w-[32px] sm:min-w-[40px]`}),a.jsx(D,{icon:a.jsx(et,{}),onClick:n,className:"hidden sm:inline-flex","aria-label":"新建文件夹",children:"新建文件夹"}),a.jsx(D,{icon:a.jsx(et,{}),onClick:n,className:"sm:hidden min-w-[32px]","aria-label":"新建文件夹",title:"新建文件夹"}),a.jsx(D,{type:"primary",icon:a.jsx(tt,{}),onClick:t,className:"hidden sm:inline-flex","aria-label":"上传图片",children:"上传"}),a.jsx(D,{type:"primary",icon:a.jsx(tt,{}),onClick:t,className:"sm:hidden min-w-[32px]","aria-label":"上传图片",title:"上传图片"}),a.jsx(D,{icon:a.jsx($t,{}),onClick:s,className:"hidden sm:inline-flex","aria-label":"打开设置",children:"设置"}),a.jsx(D,{icon:a.jsx($t,{}),onClick:s,className:"sm:hidden min-w-[32px]","aria-label":"打开设置",title:"打开设置"})]})]})})}const oa=({currentPath:r,onNavigate:e,selectedCount:t,onBatchDownload:s,onBatchCopyUrl:n,onBatchDelete:o})=>{const i=ce.useMemo(()=>{if(!r||r==="/")return[{name:"根目录",path:""}];const c=r.split("/").filter(Boolean),l=[{name:"根目录",path:""}];let d="";for(const h of c)d+=(d?"/":"")+h,l.push({name:h,path:d});return l},[r]);return a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between px-3 sm:px-4 py-2 sm:py-3 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 gap-2",children:[a.jsx("nav",{className:"flex items-center space-x-1 sm:space-x-2 flex-1 overflow-x-auto w-full sm:w-auto","aria-label":"面包屑导航",children:i.map((c,l)=>a.jsxs(ce.Fragment,{children:[l>0&&a.jsx("span",{className:"text-gray-400 dark:text-gray-500","aria-hidden":"true",children:"/"}),a.jsx("button",{onClick:()=>e(c.path),className:`
                px-2 py-1 rounded text-xs sm:text-sm font-medium transition-colors whitespace-nowrap
                focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1
                ${l===i.length-1?"text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 cursor-default":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}
              `,disabled:l===i.length-1,"aria-current":l===i.length-1?"page":void 0,"aria-label":`导航到 ${c.name}`,children:c.name})]},c.path))}),t>0&&a.jsxs("div",{className:"flex items-center flex-wrap gap-1 sm:gap-2 w-full sm:w-auto sm:ml-4",role:"toolbar","aria-label":"批量操作",children:[a.jsxs("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mr-1",children:["已选中 ",t," 项"]}),a.jsxs("button",{onClick:s,className:"px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:bg-blue-700 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",title:"批量下载","aria-label":`批量下载 ${t} 个项目`,children:[a.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 inline-block sm:mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),a.jsx("span",{className:"hidden sm:inline",children:"下载"})]}),a.jsxs("button",{onClick:n,className:"px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 focus:bg-gray-200 dark:focus:bg-gray-600 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-1",title:"批量复制路径","aria-label":`批量复制 ${t} 个项目的路径`,children:[a.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 inline-block sm:mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),a.jsx("span",{className:"hidden sm:inline",children:"复制"})]}),a.jsxs("button",{onClick:o,className:"px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:bg-red-700 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-1",title:"批量删除","aria-label":`批量删除 ${t} 个项目`,children:[a.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 inline-block sm:mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),a.jsx("span",{className:"hidden sm:inline",children:"删除"})]})]})]})},pe=te(r=>({currentPath:"",pathHistory:[],navigate:e=>r(t=>({currentPath:e,pathHistory:[...t.pathHistory,t.currentPath]})),goBack:()=>r(e=>{var n;const t=[...e.pathHistory];return{currentPath:(n=t.pop())!=null?n:"",pathHistory:t}}),goToPath:e=>r({currentPath:e,pathHistory:[]})})),Gt=te((r,e)=>({selectedItems:new Set,toggleSelection:t=>r(s=>{const n=new Set(s.selectedItems);return n.has(t)?n.delete(t):n.add(t),{selectedItems:n}}),selectAll:t=>r({selectedItems:new Set(t)}),clearSelection:()=>r({selectedItems:new Set}),isSelected:t=>e().selectedItems.has(t)})),rt=(r,e)=>e.some(t=>r instanceof t);let Lt,Tt;function ia(){return Lt||(Lt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function la(){return Tt||(Tt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const at=new WeakMap,Ze=new WeakMap,Re=new WeakMap;function ca(r){const e=new Promise((t,s)=>{const n=()=>{r.removeEventListener("success",o),r.removeEventListener("error",i)},o=()=>{t(ue(r.result)),n()},i=()=>{s(r.error),n()};r.addEventListener("success",o),r.addEventListener("error",i)});return Re.set(e,r),e}function da(r){if(at.has(r))return;const e=new Promise((t,s)=>{const n=()=>{r.removeEventListener("complete",o),r.removeEventListener("error",i),r.removeEventListener("abort",i)},o=()=>{t(),n()},i=()=>{s(r.error||new DOMException("AbortError","AbortError")),n()};r.addEventListener("complete",o),r.addEventListener("error",i),r.addEventListener("abort",i)});at.set(r,e)}let st={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return at.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ue(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function Yt(r){st=r(st)}function ua(r){return la().includes(r)?function(...e){return r.apply(nt(this),e),ue(this.request)}:function(...e){return ue(r.apply(nt(this),e))}}function ha(r){return typeof r=="function"?ua(r):(r instanceof IDBTransaction&&da(r),rt(r,ia())?new Proxy(r,st):r)}function ue(r){if(r instanceof IDBRequest)return ca(r);if(Ze.has(r))return Ze.get(r);const e=ha(r);return e!==r&&(Ze.set(r,e),Re.set(e,r)),e}const nt=r=>Re.get(r);function ma(r,e,{blocked:t,upgrade:s,blocking:n,terminated:o}={}){const i=indexedDB.open(r,e),c=ue(i);return s&&i.addEventListener("upgradeneeded",l=>{s(ue(i.result),l.oldVersion,l.newVersion,ue(i.transaction),l)}),t&&i.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),c.then(l=>{o&&l.addEventListener("close",()=>o()),n&&l.addEventListener("versionchange",d=>n(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const fa=["get","getKey","getAll","getAllKeys","count"],ga=["put","add","delete","clear"],Je=new Map;function Rt(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(Je.get(e))return Je.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,n=ga.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(n||fa.includes(t)))return;const o=function(i,...c){return b(this,null,function*(){const l=this.transaction(i,n?"readwrite":"readonly");let d=l.store;return s&&(d=d.index(c.shift())),(yield Promise.all([d[t](...c),n&&l.done]))[0]})};return Je.set(e,o),o}Yt(r=>le(V({},r),{get:(e,t,s)=>Rt(e,t)||r.get(e,t,s),has:(e,t)=>!!Rt(e,t)||r.has(e,t)}));const pa=["continue","continuePrimaryKey","advance"],Ft={},ot=new WeakMap,Zt=new WeakMap,ba={get(r,e){if(!pa.includes(e))return r[e];let t=Ft[e];return t||(t=Ft[e]=function(...s){ot.set(this,Zt.get(this)[e](...s))}),t}};function xa(...r){return ct(this,null,function*(){let e=this;if(e instanceof IDBCursor||(e=yield new Me(e.openCursor(...r))),!e)return;e=e;const t=new Proxy(e,ba);for(Zt.set(t,e),Re.set(t,nt(e));e;)yield t,e=yield new Me(ot.get(t)||e.continue()),ot.delete(t)})}function Ut(r,e){return e===Symbol.asyncIterator&&rt(r,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&rt(r,[IDBIndex,IDBObjectStore])}Yt(r=>le(V({},r),{get(e,t,s){return Ut(e,t)?xa:r.get(e,t,s)},has(e,t){return Ut(e,t)||r.has(e,t)}}));const ya=300*1e3,wa="s3-image-gallery-cache",va=1;class Jt{constructor(){G(this,"db",null);G(this,"initPromise",null)}init(){return b(this,null,function*(){if(!this.db)return this.initPromise?this.initPromise:(this.initPromise=this.doInit(),this.initPromise)})}doInit(){return b(this,null,function*(){try{this.db=yield ma(wa,va,{upgrade(e){e.objectStoreNames.contains("directories")||e.createObjectStore("directories"),e.objectStoreNames.contains("thumbnails")||e.createObjectStore("thumbnails")}})}catch(e){console.error("Failed to initialize IndexedDB:",e),this.db=null}})}ensureDB(){return b(this,null,function*(){return this.db||(yield this.init()),this.db})}cacheDirectory(n,o){return b(this,arguments,function*(e,t,s=ya){const i=yield this.ensureDB();if(i)try{const c={items:t,timestamp:Date.now(),ttl:s};yield i.put("directories",c,e)}catch(c){console.error("Failed to cache directory:",c)}})}getDirectory(e){return b(this,null,function*(){const t=yield this.ensureDB();if(!t)return null;try{const s=yield t.get("directories",e);return s?Date.now()-s.timestamp>s.ttl?(yield t.delete("directories",e),null):s.items:null}catch(s){return console.error("Failed to get cached directory:",s),null}})}cacheThumbnail(e,t){return b(this,null,function*(){const s=yield this.ensureDB();if(s)try{const n={blob:t,timestamp:Date.now()};yield s.put("thumbnails",n,e)}catch(n){console.error("Failed to cache thumbnail:",n)}})}getThumbnail(e){return b(this,null,function*(){const t=yield this.ensureDB();if(!t)return null;try{const s=yield t.get("thumbnails",e);return s?s.blob:null}catch(s){return console.error("Failed to get cached thumbnail:",s),null}})}clearPath(e){return b(this,null,function*(){const t=yield this.ensureDB();if(t)try{const s=t.transaction("directories","readwrite"),n=s.objectStore("directories"),o=yield n.getAllKeys(),i=e.endsWith("/")?e:e+"/";for(const l of o)(l===e||l.startsWith(i))&&(yield n.delete(l));const c=this.getParentPath(e);c!==null&&c!==e&&(yield n.delete(c)),yield s.done}catch(s){console.error("Failed to clear path cache:",s)}})}getParentPath(e){if(!e||e===""||e==="/")return null;const t=e.endsWith("/")?e.slice(0,-1):e,s=t.lastIndexOf("/");return s===-1?"":t.substring(0,s)}clearAll(){return b(this,null,function*(){const e=yield this.ensureDB();if(e)try{yield e.clear("directories"),yield e.clear("thumbnails")}catch(t){console.error("Failed to clear all cache:",t)}})}close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null)}}const K=new Jt,ka=Object.freeze(Object.defineProperty({__proto__:null,CacheService:Jt,cacheService:K},Symbol.toStringTag,{value:"Module"}));class ja{constructor(){G(this,"generatingQueue",new Map);G(this,"maxConcurrent",6);G(this,"currentGenerating",0);G(this,"blobUrlCache",new Map);G(this,"processingKeys",new Set)}generateThumbnail(e,t=300,s=300){return b(this,null,function*(){return new Promise((n,o)=>{const i=new Image,c=URL.createObjectURL(e);i.onload=()=>{URL.revokeObjectURL(c);let l=i.width,d=i.height;if(l>t||d>s){const f=Math.min(t/l,s/d);l=Math.round(l*f),d=Math.round(d*f)}const h=document.createElement("canvas");h.width=l,h.height=d;const x=h.getContext("2d");if(!x){o(new Error("无法创建Canvas上下文"));return}x.drawImage(i,0,0,l,d),h.toBlob(f=>{f?n(f):o(new Error("生成缩略图失败"))},"image/jpeg",.8)},i.onerror=()=>{URL.revokeObjectURL(c),o(new Error("加载图片失败"))},i.src=c})})}convertToWebP(e,t=.9){return b(this,null,function*(){return new Promise((s,n)=>{const o=new Image,i=URL.createObjectURL(e);o.onload=()=>{URL.revokeObjectURL(i);const c=document.createElement("canvas");c.width=o.width,c.height=o.height;const l=c.getContext("2d");if(!l){n(new Error("无法创建Canvas上下文"));return}l.drawImage(o,0,0),c.toBlob(d=>{d?s(d):n(new Error("转换WebP失败"))},"image/webp",t)},o.onerror=()=>{URL.revokeObjectURL(i),n(new Error("加载图片失败"))},o.src=i})})}calculateMD5(e){return b(this,null,function*(){const t=yield e.arrayBuffer(),s=yield crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map(i=>i.toString(16).padStart(2,"0")).join("").substring(0,16)})}downloadImages(e,t){return b(this,null,function*(){for(let s=0;s<e.length;s++)yield this.downloadSingleImage(e[s],t[s]),s<e.length-1&&(yield new Promise(n=>setTimeout(n,300)))})}downloadSingleImage(e,t){return b(this,null,function*(){try{const n=yield(yield fetch(e)).blob(),o=URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)}catch(s){throw console.error(`下载图片失败: ${t}`,s),s}})}getImageDimensions(e){return b(this,null,function*(){return new Promise((t,s)=>{const n=new Image,o=URL.createObjectURL(e);n.onload=()=>{URL.revokeObjectURL(o),t({width:n.width,height:n.height})},n.onerror=()=>{URL.revokeObjectURL(o),s(new Error("加载图片失败"))},n.src=o})})}generateAndCacheThumbnailFromUrl(e,t,s=300,n=300){return b(this,null,function*(){if(this.blobUrlCache.has(t))return this.blobUrlCache.get(t);if(this.generatingQueue.has(t))return this.generatingQueue.get(t);const o=this.generateThumbnailInternal(e,t,s,n);this.generatingQueue.set(t,o),this.processingKeys.add(t);try{const i=yield o;return this.blobUrlCache.set(t,i),i}finally{this.generatingQueue.delete(t),this.processingKeys.delete(t)}})}generateThumbnailInternal(e,t,s,n){return b(this,null,function*(){for(;this.currentGenerating>=this.maxConcurrent;)yield new Promise(o=>setTimeout(o,100));this.currentGenerating++;try{return yield new Promise((o,i)=>{const c=new Image;c.crossOrigin="anonymous",c.onload=()=>b(this,null,function*(){try{let l=c.width,d=c.height;if(l>s||d>n){const f=Math.min(s/l,n/d);l=Math.round(l*f),d=Math.round(d*f)}const h=document.createElement("canvas");h.width=l,h.height=d;const x=h.getContext("2d");if(!x){i(new Error("无法创建Canvas上下文"));return}x.drawImage(c,0,0,l,d),h.toBlob(f=>b(this,null,function*(){f?(yield K.cacheThumbnail(t,f),o(URL.createObjectURL(f))):i(new Error("生成缩略图失败"))}),"image/jpeg",.8)}catch(l){i(l)}}),c.onerror=l=>{console.error("图片加载失败，可能是CORS问题:",l),i(l)},c.src=e})}finally{this.currentGenerating--}})}preGenerateThumbnails(e,t=3){return b(this,null,function*(){const s=[];for(const o of e){if(this.isProcessing(o.key)||this.blobUrlCache.has(o.key))continue;const i=yield K.getThumbnail(o.key);if(i){const c=URL.createObjectURL(i);this.blobUrlCache.set(o.key,c);continue}s.push(o)}const n=s.map(o=>this.generateAndCacheThumbnailFromUrl(o.url,o.key).catch(i=>{console.error(`预生成缩略图失败: ${o.key}`,i)}));yield Promise.all(n)})}getCachedThumbnailUrl(e){return b(this,null,function*(){if(this.blobUrlCache.has(e))return this.blobUrlCache.get(e);const t=yield K.getThumbnail(e);if(t){const s=URL.createObjectURL(t);return this.blobUrlCache.set(e,s),s}return null})}isProcessing(e){return this.processingKeys.has(e)}revokeBlobUrl(e){const t=this.blobUrlCache.get(e);t&&(URL.revokeObjectURL(t),this.blobUrlCache.delete(e))}revokeAllBlobUrls(){this.blobUrlCache.forEach(e=>{URL.revokeObjectURL(e)}),this.blobUrlCache.clear()}}const ge=new ja,Ca=Object.freeze(Object.defineProperty({__proto__:null,imageService:ge},Symbol.toStringTag,{value:"Module"}));function Qe(r){return[...r].sort((e,t)=>e.type==="folder"&&t.type!=="folder"?-1:e.type!=="folder"&&t.type==="folder"?1:e.name.localeCompare(t.name))}const ne=te((r,e)=>({items:[],loading:!1,error:null,currentPath:"",setItems:t=>r({items:Qe(t),error:null}),setLoading:t=>r({loading:t}),setError:t=>r({error:t,loading:!1}),clearItems:()=>r({items:[],error:null}),loadItems:t=>b(null,null,function*(){const s=ee();if(!s){r({error:"请先配置S3连接信息",loading:!1});return}r({loading:!0,error:null,currentPath:t});try{const n=yield K.getDirectory(t);if(n){r({items:Qe(n),loading:!1}),e().preloadThumbnails();return}const i=(yield s.listObjects(t)).map(l=>{const d=l.key.replace(t,"").replace(/\/$/,"");return l.isFolder?{type:"folder",key:l.key,name:d}:{type:"image",key:l.key,name:d,fullUrl:s.getObjectUrl(l.key),thumbnailUrl:void 0,size:l.size,lastModified:l.lastModified}}).filter(l=>l.name),c=Qe(i);r({items:c,loading:!1}),yield K.cacheDirectory(t,c),e().preloadThumbnails()}catch(n){console.error("加载目录失败:",n),r({error:n instanceof Error?n.message:"加载目录失败",loading:!1})}}),refreshItems:()=>b(null,null,function*(){const{currentPath:t,loadItems:s}=e();yield K.clearPath(t),yield s(t)}),preloadThumbnails:()=>b(null,null,function*(){const{items:t}=e(),s=t.filter(n=>n.type==="image"&&n.fullUrl).map(n=>({url:n.fullUrl,key:n.key}));s.length!==0&&ge.preGenerateThumbnails(s,3).catch(n=>{console.error("预加载缩略图失败:",n)})})})),Sa=Object.freeze(Object.defineProperty({__proto__:null,useGalleryStore:ne},Symbol.toStringTag,{value:"Module"}));let Pa=0;const X=te((r,e)=>({messages:[],addMessage:(t,s,n=3e3)=>{const o=`message-${++Pa}`,i={id:o,type:t,content:s,duration:n};return r(c=>({messages:[...c.messages,i]})),t!=="loading"&&n>0&&setTimeout(()=>{r(c=>({messages:c.messages.filter(l=>l.id!==o)}))},n),o},removeMessage:t=>{r(s=>({messages:s.messages.filter(n=>n.id!==t)}))},success:(t,s)=>e().addMessage("success",t,s),error:(t,s=5e3)=>e().addMessage("error",t,s),info:(t,s)=>e().addMessage("info",t,s),warning:(t,s)=>e().addMessage("warning",t,s),loading:t=>e().addMessage("loading",t,0)})),M={success:(r,e)=>{X.getState().success(r,e)},error:(r,e)=>{X.getState().error(r,e)},info:(r,e)=>{X.getState().info(r,e)},warning:(r,e)=>{X.getState().warning(r,e)},loading:r=>X.getState().loading(r),destroy:r=>{X.getState().removeMessage(r)}},fe=te((r,e)=>({visible:!1,options:null,loading:!1,showConfirm:t=>{r({visible:!0,options:t,loading:!1})},hideConfirm:()=>{r({visible:!1,options:null,loading:!1})},setLoading:t=>{r({loading:t})},handleOk:()=>b(null,null,function*(){const{options:t,hideConfirm:s,setLoading:n}=e();if(!(t!=null&&t.onOk)){s();return}try{n(!0),yield t.onOk(),s()}catch(o){throw console.error("确认操作失败:",o),n(!1),o}}),handleCancel:()=>{var n;const{options:t,hideConfirm:s}=e();(n=t==null?void 0:t.onCancel)==null||n.call(t),s()}})),Qt=r=>{fe.getState().showConfirm(r)},$e=te(r=>({loading:!1,tip:"加载中...",showLoading:(e="加载中...")=>{r({loading:!0,tip:e})},hideLoading:()=>{r({loading:!1})}})),Xe={show:r=>{$e.getState().showLoading(r)},hide:()=>{$e.getState().hideLoading()}},Na=()=>{const{currentPath:r,goToPath:e}=pe(),{selectedItems:t,clearSelection:s}=Gt(),{items:n,refreshItems:o}=ne(),{copyFormat:i}=Ne(),c=ce.useMemo(()=>n.filter(f=>f.type==="image"&&t.has(f.key)),[n,t]),l=f=>{e(f),s()},d=()=>b(null,null,function*(){if(c.length===0){M.warning("请选择要下载的图片");return}const f=ee();if(!f){M.error("请先配置S3连接信息");return}Xe.show(`正在下载 ${c.length} 张图片...`);try{const g=c.map(_=>f.getObjectUrl(_.key)),v=c.map(_=>_.name);yield ge.downloadImages(g,v),Xe.hide(),M.success(`成功下载 ${c.length} 张图片`)}catch(g){console.error("批量下载失败:",g),Xe.hide(),M.error(g instanceof Error?g.message:"批量下载失败，请重试")}}),h=()=>b(null,null,function*(){if(c.length===0){M.warning("请选择要复制路径的图片");return}const f=ee();if(!f){M.error("请先配置S3连接信息");return}try{const g=c.map(L=>f.getObjectUrl(L.key));let v;i==="markdown"?v=c.map((F,j)=>`![${F.name}](${g[j]})`).join(`
`):v=g.join(`
`),yield navigator.clipboard.writeText(v);const _=i==="markdown"?"Markdown格式":"原链接";M.success(`已复制 ${c.length} 个图片${_}到剪贴板`)}catch(g){console.error("复制URL失败:",g),M.error("复制失败，请重试")}}),x=()=>{if(c.length===0){M.warning("请选择要删除的图片");return}Qt({title:"确认批量删除",content:`确定要删除选中的 ${c.length} 张图片吗？此操作无法撤销。`,okText:"删除",cancelText:"取消",okType:"danger",onOk:()=>b(null,null,function*(){const f=ee();if(!f){M.error("请先配置S3连接信息");return}try{const g=c.map(_=>_.key),v=yield f.deleteObjects(g);v.failed.length>0?M.warning(`删除完成，成功: ${v.success.length}，失败: ${v.failed.length}`):M.success(`成功删除 ${v.success.length} 张图片`),s(),yield K.clearPath(r),yield o()}catch(g){throw console.error("批量删除失败:",g),M.error(g instanceof Error?g.message:"批量删除失败，请重试"),g}})})};return a.jsx(oa,{currentPath:r,onNavigate:l,selectedCount:t.size,onBatchDownload:d,onBatchCopyUrl:h,onBatchDelete:x})},Ia=({item:r,selected:e,onSelect:t,onClick:s,onDownload:n,onCopyUrl:o,onDelete:i,onRename:c,onMove:l})=>{const[d,h]=m.useState(!1),[x,f]=m.useState(!1),[g,v]=m.useState(!1),[_,L]=m.useState(null),[F,j]=m.useState(!1),[y,R]=m.useState(!1),[p,P]=m.useState(!1),N=m.useRef(null),Y=m.useRef(null),{corsAvailable:W,corsErrorShown:B,setCorsAvailable:H,setCorsErrorShown:Z}=Ht();m.useEffect(()=>{if(!N.current)return;const w=new IntersectionObserver(A=>{A.forEach(E=>{E.isIntersecting&&(f(!0),w.disconnect())})},{rootMargin:"400px",threshold:.01});return w.observe(N.current),()=>{w.disconnect()}},[]),m.useEffect(()=>!x||!r.fullUrl?void 0:(b(null,null,function*(){try{j(!0),R(!1);const A=yield ge.getCachedThumbnailUrl(r.key);if(A){L(A),j(!1),W===null&&H(!0);return}if(r.thumbnailUrl){L(r.thumbnailUrl),j(!1);return}if(r.fullUrl)try{const E=yield ge.generateAndCacheThumbnailFromUrl(r.fullUrl,r.key,300,300);L(E),j(!1),W===null&&H(!0)}catch(E){console.warn("CORS方式失败，使用原图优化加载模式:",E),W===null&&(H(!1),Z(!0)),P(!0),L(r.fullUrl),j(!1)}}catch(A){console.error("加载缩略图失败:",A),R(!0),j(!1)}}),()=>{}),[x,r.key,r.thumbnailUrl,r.fullUrl,W,B,H,Z]),m.useEffect(()=>{const w=A=>{Y.current&&!Y.current.contains(A.target)&&v(!1)};return g&&document.addEventListener("mousedown",w),()=>{document.removeEventListener("mousedown",w)}},[g]);const oe=w=>{w.stopPropagation(),t(w.target.checked)},J=()=>{s()},u=w=>{w.stopPropagation(),n()},k=w=>{w.stopPropagation(),o()},I=w=>{w.stopPropagation(),i()},C=w=>{w.stopPropagation(),v(!g)},Q=w=>{w.stopPropagation(),v(!1),c==null||c()},z=w=>{w.stopPropagation(),v(!1),l==null||l()},ie=()=>{console.warn("缩略图显示失败"),R(!0)};return a.jsxs("article",{ref:N,className:`relative rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 w-full shadow-md hover:shadow-xl transition-shadow duration-300 ${e?"ring-2 ring-blue-500":""}`,style:{contentVisibility:"auto",containIntrinsicSize:"300px",aspectRatio:"1"},role:"listitem",children:[a.jsx("div",{className:"absolute top-1.5 sm:top-2 left-1.5 sm:left-2 z-20",children:a.jsx("input",{type:"checkbox",id:`image-checkbox-${r.key}`,name:`image-checkbox-${r.key}`,checked:e,onChange:oe,className:"w-4 h-4 sm:w-5 sm:h-5 cursor-pointer accent-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-offset-1","aria-label":`选择 ${r.name}`})}),a.jsxs("div",{className:"w-full h-full cursor-pointer overflow-hidden bg-gradient-to-br from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-800 relative",onClick:J,onKeyDown:w=>{(w.key==="Enter"||w.key===" ")&&(w.preventDefault(),J())},tabIndex:0,role:"button","aria-label":`查看图片 ${r.name}`,children:[y?a.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center gap-2",role:"status","aria-label":"加载失败",children:[a.jsx("svg",{className:"w-16 h-16 text-red-400 dark:text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),a.jsx("span",{className:"text-xs text-red-600 dark:text-red-400 font-medium",children:"加载失败"})]}):_?a.jsx("img",le(V({src:_,alt:r.name,className:`w-full h-full object-cover transition-opacity duration-300 ${d?"opacity-100":"opacity-0"}`,style:V({},p?{imageRendering:"-webkit-optimize-contrast",transform:"translateZ(0)",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"}:{willChange:d?"auto":"opacity"}),onLoad:()=>h(!0),onError:ie,loading:"lazy",decoding:"async"},p?{}:{crossOrigin:"anonymous"}),{width:300,height:300})):a.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center gap-3",role:"status","aria-label":"加载中",children:F?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 font-medium",children:"生成缩略图中..."})]}):a.jsx("div",{className:"w-full h-full flex items-center justify-center",children:a.jsx("svg",{className:"w-16 h-16 text-gray-400 dark:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),a.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-1.5 sm:p-2 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md z-10",children:[a.jsx("div",{className:"text-xs sm:text-sm text-gray-700 dark:text-gray-300 truncate mb-1.5 sm:mb-2",title:r.name,children:r.name}),a.jsxs("div",{className:"flex items-center justify-around gap-0.5 sm:gap-1",role:"toolbar","aria-label":`${r.name} 的操作`,children:[a.jsx("button",{onClick:u,className:"flex-1 flex items-center justify-center p-1 sm:p-1.5 rounded hover:bg-white/50 dark:hover:bg-gray-800/50 focus:bg-white/50 dark:focus:bg-gray-800/50 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":`下载 ${r.name}`,title:"下载",children:a.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),a.jsx("button",{onClick:k,className:"flex-1 flex items-center justify-center p-1 sm:p-1.5 rounded hover:bg-white/50 dark:hover:bg-gray-800/50 focus:bg-white/50 dark:focus:bg-gray-800/50 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":`复制 ${r.name} 的路径`,title:"复制路径",children:a.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),a.jsx("button",{onClick:I,className:"flex-1 flex items-center justify-center p-1 sm:p-1.5 rounded hover:bg-red-50/50 dark:hover:bg-red-900/30 focus:bg-red-50/50 dark:focus:bg-red-900/30 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500","aria-label":`删除 ${r.name}`,title:"删除",children:a.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),a.jsxs("div",{className:"relative flex-1",ref:Y,children:[a.jsx("button",{onClick:C,className:"w-full flex items-center justify-center p-1 sm:p-1.5 rounded hover:bg-white/50 dark:hover:bg-gray-800/50 focus:bg-white/50 dark:focus:bg-gray-800/50 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":`${r.name} 的更多操作`,"aria-expanded":g,"aria-haspopup":"true",title:"更多",children:a.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),g&&a.jsxs("div",{className:"absolute bottom-full right-0 mb-1 w-28 sm:w-32 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 z-20",role:"menu","aria-label":"更多操作菜单",children:[a.jsx("button",{onClick:Q,className:"w-full px-3 sm:px-4 py-1.5 sm:py-2 text-left text-xs sm:text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700 rounded-t-md focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500",role:"menuitem",children:"重命名"}),a.jsx("button",{onClick:z,className:"w-full px-3 sm:px-4 py-1.5 sm:py-2 text-left text-xs sm:text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700 rounded-b-md focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500",role:"menuitem",children:"移动"})]})]})]})]})]})]})},Ma=({item:r,onClick:e,onDelete:t,onRename:s,onMove:n,isBackItem:o=!1})=>{const[i,c]=m.useState(!1),l=m.useRef(null);m.useEffect(()=>{const g=v=>{l.current&&!l.current.contains(v.target)&&c(!1)};return i&&document.addEventListener("mousedown",g),()=>{document.removeEventListener("mousedown",g)}},[i]);const d=g=>{g.stopPropagation(),c(!i)},h=g=>{g.stopPropagation(),c(!1),s==null||s()},x=g=>{g.stopPropagation(),c(!1),n==null||n()},f=g=>{g.stopPropagation(),c(!1),t==null||t()};return a.jsxs("article",{className:"relative rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer transition-all duration-300 w-full overflow-hidden shadow-md hover:shadow-xl",style:{aspectRatio:"1"},role:"listitem",children:[a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{bottom:!o&&(t||s||n)?"70px":"0"},onClick:e,onKeyDown:g=>{(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),e())},tabIndex:0,"aria-label":o?"返回上一级目录":`打开文件夹 ${r.name}`,children:o?a.jsx("svg",{className:"w-12 h-12 sm:w-14 sm:h-14 text-gray-500 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}):a.jsx("svg",{className:"w-12 h-12 sm:w-14 sm:h-14 text-blue-500 dark:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true",children:a.jsx("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})})}),!o&&(t||s||n)&&a.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-1.5 sm:p-2 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md z-10",children:[a.jsx("div",{className:"text-xs sm:text-sm text-gray-700 dark:text-gray-300 truncate mb-1.5 sm:mb-2",title:r.name,children:r.name}),a.jsxs("div",{className:"flex items-center justify-around gap-0.5 sm:gap-1",role:"toolbar","aria-label":`${r.name} 的操作`,children:[s&&a.jsx("button",{onClick:h,className:"flex-1 flex items-center justify-center p-1 sm:p-1.5 rounded hover:bg-white/50 dark:hover:bg-gray-800/50 focus:bg-white/50 dark:focus:bg-gray-800/50 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":`重命名 ${r.name}`,title:"重命名",children:a.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),n&&a.jsx("button",{onClick:x,className:"flex-1 flex items-center justify-center p-1 sm:p-1.5 rounded hover:bg-white/50 dark:hover:bg-gray-800/50 focus:bg-white/50 dark:focus:bg-gray-800/50 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":`移动 ${r.name}`,title:"移动",children:a.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),t&&a.jsx("button",{onClick:f,className:"flex-1 flex items-center justify-center p-1 sm:p-1.5 rounded hover:bg-red-50/50 dark:hover:bg-red-900/30 focus:bg-red-50/50 dark:focus:bg-red-900/30 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500","aria-label":`删除 ${r.name}`,title:"删除",children:a.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),(s||n)&&a.jsxs("div",{className:"relative flex-1",ref:l,children:[a.jsx("button",{onClick:d,className:"w-full flex items-center justify-center p-1 sm:p-1.5 rounded hover:bg-white/50 dark:hover:bg-gray-800/50 focus:bg-white/50 dark:focus:bg-gray-800/50 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":`${r.name} 的更多操作`,"aria-expanded":i,"aria-haspopup":"true",title:"更多",children:a.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),i&&a.jsxs("div",{className:"absolute bottom-full right-0 mb-1 w-28 sm:w-32 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 z-20",role:"menu","aria-label":"更多操作菜单",children:[s&&a.jsx("button",{onClick:h,className:"w-full px-3 sm:px-4 py-1.5 sm:py-2 text-left text-xs sm:text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700 rounded-t-md focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500",role:"menuitem",children:"重命名"}),n&&a.jsx("button",{onClick:x,className:"w-full px-3 sm:px-4 py-1.5 sm:py-2 text-left text-xs sm:text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700 rounded-b-md focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500",role:"menuitem",children:"移动"})]})]})]})]})]})};function Oa(r,e){let t=!1,s;return function(...n){const o=this;return t||(s=r.apply(o,n),t=!0,setTimeout(()=>{t=!1},e)),s}}const _a=({items:r,loading:e,onItemClick:t,onFolderClick:s,selectedItems:n,onSelectionChange:o,onDownload:i,onCopyUrl:c,onDelete:l,onRename:d,onMove:h,currentPage:x=1,totalPages:f=1,onPageChange:g})=>{const[v,_]=m.useState({width:window.innerWidth,height:window.innerHeight});m.useEffect(()=>{const y=Oa(()=>{_({width:window.innerWidth,height:window.innerHeight})},150);return window.addEventListener("resize",y,{passive:!0}),()=>{window.removeEventListener("resize",y)}},[]);const{columnCount:L}=m.useMemo(()=>{const y=v.width-32,R=140,p=260,P=12;let N=Math.floor((y+P)/(R+P));return N=Math.max(2,Math.min(N,10)),(y-(N-1)*P)/N>p&&N<10&&(N=Math.floor((y+P)/(p+P)),N=Math.max(2,Math.min(N,10))),{columnCount:N}},[v]),F=m.useCallback(y=>{s(y)},[s]),j=m.useCallback(y=>{t(y)},[t]);return e?a.jsx("div",{className:"flex items-center justify-center h-64",role:"status","aria-live":"polite",children:a.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"加载中..."})}):r.length===0?a.jsx("div",{className:"flex items-center justify-center h-64",role:"status",children:a.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"暂无内容"})}):a.jsxs(a.Fragment,{children:[a.jsx("main",{className:"w-full px-2 sm:px-3 md:px-4 py-3 sm:py-4",role:"main",children:a.jsx("div",{className:"grid gap-2 sm:gap-3 w-full",style:{gridTemplateColumns:`repeat(${L}, minmax(0, 1fr))`},role:"list","aria-label":"图片和文件夹列表",children:r.map(y=>{const R=n.has(y.key),p=y.key==="__back__";return y.type==="folder"?a.jsx(Ma,{item:y,onClick:()=>F(y.key),onDelete:p?void 0:()=>l==null?void 0:l(y),onRename:p?void 0:()=>d==null?void 0:d(y),onMove:p?void 0:()=>h==null?void 0:h(y),isBackItem:p},y.key):a.jsx(Ia,{item:y,selected:R,onSelect:P=>o(y.key,P),onClick:()=>j(y),onDownload:()=>i==null?void 0:i(y),onCopyUrl:()=>c==null?void 0:c(y),onDelete:()=>l==null?void 0:l(y),onRename:()=>d==null?void 0:d(y),onMove:()=>h==null?void 0:h(y)},y.key)})})}),f>1&&g&&a.jsx("div",{className:"flex justify-center py-6",children:a.jsx(cr,{current:x,total:f*10,pageSize:10,onChange:g,showSizeChanger:!1,showQuickJumper:!0,showTotal:()=>`共 ${f} 页`})})]})},Ea=()=>{const{items:r,loading:e,loadItems:t,refreshItems:s}=ne(),{currentPath:n,navigate:o}=pe(),{selectedItems:i,toggleSelection:c,clearSelection:l}=Gt(),{showViewer:d,showRenameModal:h,showMoveModal:x}=$(),{itemsPerPage:f,copyFormat:g}=Ne(),v=de(u=>u.config),_=de(u=>u.isInitialized),[L,F]=m.useState(1);m.useEffect(()=>{_&&v&&t(n)},[_,v,n,t]),m.useEffect(()=>{l(),F(1)},[n,l]);const j=()=>{const u=n.split("/").filter(Boolean);u.pop();const k=u.length>0?u.join("/")+"/":"";o(k)},y=m.useMemo(()=>!n||n===""||n==="/"?r:[{type:"folder",key:"__back__",name:".."},...r],[n,r]),{paginatedItems:R,totalPages:p}=m.useMemo(()=>{const u=(L-1)*f,k=u+f,I=y.slice(u,k),C=Math.ceil(y.length/f);return{paginatedItems:I,totalPages:C}},[y,L,f]),P=m.useCallback(u=>{F(u),window.scrollTo({top:0,behavior:"smooth"})},[]),N=u=>{u==="__back__"?j():o(u)},Y=u=>{if(u.type==="image"){const I=y.filter(C=>C.type==="image").findIndex(C=>C.key===u.key);I!==-1&&d(I)}},W=u=>{u!=="__back__"&&c(u)},B=m.useCallback(u=>b(null,null,function*(){if(u.fullUrl)try{yield ge.downloadImages([u.fullUrl],[u.name]),M.success("下载成功")}catch(k){console.error("下载失败:",k),M.error("下载失败，请重试")}}),[]),H=m.useCallback(u=>b(null,null,function*(){if(u.fullUrl)try{let k=u.fullUrl;g==="markdown"&&(k=`![${u.name}](${u.fullUrl})`),yield navigator.clipboard.writeText(k),M.success("已复制到剪贴板")}catch(k){console.error("复制失败:",k),M.error("复制失败，请重试")}}),[g]),Z=m.useCallback(u=>{Qt({title:"确认删除",content:`确定要删除 "${u.name}" 吗？此操作无法撤销。`,okText:"删除",cancelText:"取消",okType:"danger",onOk:()=>b(null,null,function*(){const k=ee();if(!k){M.error("请先配置S3连接信息");return}try{yield k.deleteObject(u.key),M.success("删除成功"),yield K.clearPath(n),yield s()}catch(I){throw console.error("删除失败:",I),M.error(I instanceof Error?I.message:"删除失败，请重试"),I}})})},[n,s]),oe=m.useCallback(u=>{h({key:u.key,name:u.name})},[h]),J=m.useCallback(u=>{x({key:u.key,name:u.name})},[x]);return a.jsx(_a,{items:R,loading:e,onItemClick:Y,onFolderClick:N,selectedItems:i,onSelectionChange:W,onDownload:B,onCopyUrl:H,onDelete:Z,onRename:oe,onMove:J,currentPage:L,totalPages:p,onPageChange:P})},$a=()=>{const{viewerVisible:r,currentImageIndex:e,hideViewer:t,setCurrentImageIndex:s}=$(),{items:n}=ne(),o=m.useMemo(()=>n.filter(c=>c.type==="image"),[n]);if(m.useEffect(()=>{if(!r||o.length===0)return;const c=l=>{switch(l.key){case"ArrowLeft":l.preventDefault(),e>0&&s(e-1);break;case"ArrowRight":l.preventDefault(),e<o.length-1&&s(e+1);break;case"Escape":l.preventDefault(),t();break}};return document.addEventListener("keydown",c),()=>{document.removeEventListener("keydown",c)}},[r,e,o.length,s,t]),!r||o.length===0)return null;const i=o[e];return i?a.jsxs("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-90 flex items-center justify-center",onClick:t,role:"dialog","aria-modal":"true","aria-label":"图片查看器",children:[a.jsx("button",{className:"absolute top-2 sm:top-4 right-2 sm:right-4 text-white hover:text-gray-300 focus:text-gray-300 transition-colors z-10 p-2 focus:outline-none focus:ring-2 focus:ring-white rounded",onClick:t,"aria-label":"关闭图片查看器",title:"关闭 (ESC)",children:a.jsx("svg",{className:"w-6 h-6 sm:w-8 sm:h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e>0&&a.jsx("button",{className:"absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 focus:text-gray-300 transition-colors z-10 p-2 focus:outline-none focus:ring-2 focus:ring-white rounded",onClick:c=>{c.stopPropagation(),s(e-1)},"aria-label":"上一张图片",title:"上一张 (←)",children:a.jsx("svg",{className:"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e<o.length-1&&a.jsx("button",{className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 focus:text-gray-300 transition-colors z-10 p-2 focus:outline-none focus:ring-2 focus:ring-white rounded",onClick:c=>{c.stopPropagation(),s(e+1)},"aria-label":"下一张图片",title:"下一张 (→)",children:a.jsx("svg",{className:"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),a.jsxs("div",{className:"absolute bottom-2 sm:bottom-4 left-1/2 -translate-x-1/2 text-white text-center z-10 px-4 max-w-full",children:[a.jsx("div",{className:"text-xs sm:text-sm mb-1 truncate max-w-[90vw]",title:i.name,children:i.name}),a.jsxs("div",{className:"text-xs text-gray-400","aria-live":"polite","aria-atomic":"true",children:[e+1," / ",o.length]})]}),a.jsx("div",{className:"relative max-w-[90vw] max-h-[90vh] flex items-center justify-center p-4",onClick:c=>c.stopPropagation(),children:a.jsx("img",{src:i.fullUrl||i.thumbnailUrl||"",alt:i.name,className:"max-w-full max-h-[90vh] object-contain",loading:"lazy"})})]}):null};function La(){const[r]=S.useForm(),[e]=S.useForm(),[t,s]=m.useState(!1),[n,o]=m.useState(null),i=$(u=>u.settingsModalVisible),c=$(u=>u.hideSettingsModal),l=de(u=>u.config),d=de(u=>u.saveConfigToStorage),h=$(u=>u.theme),x=ne(u=>u.refreshItems),{itemsPerPage:f,copyFormat:g,uploadFormat:v,uploadNameStrategy:_,uploadTargetPath:L,uploadCustomPath:F,setItemsPerPage:j,setCopyFormat:y,setUploadFormat:R,setUploadNameStrategy:p,setUploadTargetPath:P,setUploadCustomPath:N}=Ne(),Y=h==="dark",W=()=>{l&&r.setFieldsValue(l),e.setFieldsValue({itemsPerPage:f,copyFormat:g,uploadFormat:v,uploadNameStrategy:_,uploadTargetPath:L,uploadCustomPath:F})},B=()=>b(null,null,function*(){try{yield r.validateFields();const u=r.getFieldsValue();s(!0),o(null);const{S3Service:k}=yield Pe(()=>b(null,null,function*(){const{S3Service:Q}=yield Promise.resolve().then(()=>Wt);return{S3Service:Q}}),void 0),I=new k(u),C=yield I.testConnection();I.destroy(),C?(o("success"),O.success("连接测试成功！")):(o("error"),O.error("连接测试失败，请检查配置"))}catch(u){o("error"),u instanceof Error?O.error(`连接测试失败: ${u.message}`):O.error("连接测试失败，请检查配置")}finally{s(!1)}}),H=()=>{try{const u=re.exportConfig(),k=new Blob([u],{type:"application/json"}),I=URL.createObjectURL(k),C=document.createElement("a");C.href=I,C.download=`s3-config-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(I),O.success("配置已导出")}catch(u){u instanceof Error?O.error(u.message):O.error("导出配置失败")}},Z=u=>{const k=new FileReader;return k.onload=I=>{var C;try{const Q=(C=I.target)==null?void 0:C.result,z=re.importConfig(Q);r.setFieldsValue(z.s3),e.setFieldsValue(z.app),O.success("配置已导入，请检查并保存")}catch(Q){Q instanceof Error?O.error(Q.message):O.error("导入配置失败")}},k.readAsText(u),!1},oe=()=>b(null,null,function*(){try{const u=yield r.validateFields(),k=yield e.validateFields();d(u),j(k.itemsPerPage),y(k.copyFormat),R(k.uploadFormat),p(k.uploadNameStrategy),P(k.uploadTargetPath),N(k.uploadCustomPath||""),O.success("配置已保存"),c(),setTimeout(()=>{x().catch(I=>{console.error("刷新图片列表失败:",I)})},100)}catch(u){O.error("请填写所有必填字段")}}),J=()=>{o(null),c()};return a.jsxs(Le,{title:"S3配置设置",open:i,onCancel:J,afterOpenChange:u=>u&&W(),width:600,footer:[a.jsx(D,{onClick:J,children:"取消"},"cancel"),a.jsx(D,{type:"primary",onClick:oe,children:"保存配置"},"save")],className:Y?"dark-modal":"","aria-labelledby":"settings-modal-title","aria-describedby":"settings-modal-description",children:[a.jsx("div",{id:"settings-modal-description",className:"sr-only",children:"配置S3存储连接信息，包括访问密钥、区域、端点和存储桶名称"}),a.jsxs(S,{form:r,layout:"vertical",autoComplete:"off",className:"mt-4",children:[a.jsx(S.Item,{label:"Access Key ID",name:"accessKeyId",rules:[{required:!0,message:"请输入Access Key ID"},{min:16,message:"Access Key ID长度至少16个字符"}],children:a.jsx(ae,{placeholder:"请输入Access Key ID","aria-required":"true","aria-describedby":"accessKeyId-help",autoComplete:"username"})}),a.jsx(S.Item,{label:"Secret Access Key",name:"secretAccessKey",rules:[{required:!0,message:"请输入Secret Access Key"},{min:32,message:"Secret Access Key长度至少32个字符"}],children:a.jsx(ae.Password,{placeholder:"请输入Secret Access Key","aria-required":"true","aria-describedby":"secretAccessKey-help",autoComplete:"current-password"})}),a.jsx(S.Item,{label:"Region",name:"region",rules:[{required:!0,message:"请输入Region"}],tooltip:"例如: us-east-1, auto",children:a.jsx(ae,{placeholder:"例如: us-east-1, auto","aria-required":"true","aria-describedby":"region-help",autoComplete:"off"})}),a.jsx(S.Item,{label:"Endpoint",name:"endpoint",rules:[{required:!0,message:"请输入Endpoint"},{pattern:/^https?:\/\/.+/,message:"Endpoint必须以http://或https://开头"}],tooltip:"例如: https://s3.amazonaws.com 或 https://your-account.r2.cloudflarestorage.com",children:a.jsx(ae,{placeholder:"https://your-endpoint.com","aria-required":"true","aria-describedby":"endpoint-help",autoComplete:"url"})}),a.jsx(S.Item,{label:"Bucket",name:"bucket",rules:[{required:!0,message:"请输入Bucket名称"},{pattern:/^[a-z0-9][a-z0-9-]*[a-z0-9]$/,message:"Bucket名称只能包含小写字母、数字和连字符"}],children:a.jsx(ae,{placeholder:"your-bucket-name","aria-required":"true","aria-describedby":"bucket-help",autoComplete:"off"})}),a.jsx(S.Item,{label:"自定义域名（可选）",name:"customDomain",tooltip:"如果配置了自定义域名，将使用该域名生成图片URL",rules:[{pattern:/^https?:\/\/.+/,message:"自定义域名必须以http://或https://开头"}],children:a.jsx(ae,{placeholder:"https://your-custom-domain.com","aria-describedby":"customDomain-help",autoComplete:"url"})})]}),a.jsxs(S,{form:e,layout:"vertical",className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("div",{className:"text-base font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"应用设置"}),a.jsx(S.Item,{label:"单页显示数量",name:"itemsPerPage",rules:[{required:!0,message:"请输入单页显示数量"},{type:"number",min:1,max:100,message:"数量范围：1-100"}],tooltip:"设置每页显示的图片数量，超过则分页显示",children:a.jsx(dr,{min:1,max:100,className:"w-full",placeholder:"默认 20"})}),a.jsx(S.Item,{label:"复制格式",name:"copyFormat",rules:[{required:!0,message:"请选择复制格式"}],tooltip:"选择复制图片链接时使用的格式",children:a.jsxs(q,{placeholder:"选择复制格式",children:[a.jsx(q.Option,{value:"url",children:"原链接"}),a.jsx(q.Option,{value:"markdown",children:"Markdown 格式"})]})}),a.jsx(S.Item,{label:"上传图片格式",name:"uploadFormat",rules:[{required:!0,message:"请选择上传图片格式"}],tooltip:"选择WebP可以减小文件大小，提高加载速度",children:a.jsxs(q,{placeholder:"选择上传图片格式",children:[a.jsx(q.Option,{value:"original",children:"保持原格式"}),a.jsx(q.Option,{value:"webp",children:"转换为WebP"})]})}),a.jsx(S.Item,{label:"上传文件名策略",name:"uploadNameStrategy",rules:[{required:!0,message:"请选择文件名策略"}],tooltip:"使用MD5可以避免文件名冲突，并且文件名长度固定",children:a.jsxs(q,{placeholder:"选择文件名策略",children:[a.jsx(q.Option,{value:"original",children:"保留原文件名"}),a.jsx(q.Option,{value:"md5",children:"使用MD5命名"})]})}),a.jsx(S.Item,{label:"上传目标路径",name:"uploadTargetPath",rules:[{required:!0,message:"请选择上传目标路径"}],tooltip:"设置默认的上传路径策略，支持{year}/{mouth}/{day}变量",children:a.jsxs(q,{placeholder:"选择上传目标路径",children:[a.jsx(q.Option,{value:"current",children:"当前目录"}),a.jsx(q.Option,{value:"custom",children:"自定义路径"})]})}),a.jsx(S.Item,{noStyle:!0,shouldUpdate:(u,k)=>u.uploadTargetPath!==k.uploadTargetPath,children:({getFieldValue:u})=>u("uploadTargetPath")==="custom"?a.jsx(S.Item,{name:"uploadCustomPath",rules:[{required:!0,message:"请输入自定义路径"}],tooltip:"支持变量: {year}, {month}, {day}",children:a.jsx(ae,{placeholder:"例如: images/{year}/{month}/{day}","aria-label":"输入自定义上传路径"})}):null})]}),a.jsx(S,{form:r,layout:"vertical",autoComplete:"off",className:"mt-4",children:a.jsx(S.Item,{children:a.jsxs(dt,{className:"w-full",direction:"vertical",children:[a.jsx(D,{block:!0,icon:t?a.jsx(ur,{}):n==="success"?a.jsx(Vr,{}):void 0,onClick:B,loading:t,type:n==="success"?"primary":"default",danger:n==="error","aria-label":t?"正在测试连接":n==="success"?"连接测试成功":n==="error"?"连接测试失败":"测试S3连接",children:t?"测试中...":n==="success"?"连接成功":n==="error"?"连接失败":"测试连接"}),a.jsxs(dt,{className:"w-full",children:[a.jsx(D,{icon:a.jsx(hr,{}),onClick:H,disabled:!l,className:"flex-1","aria-label":"导出配置到JSON文件",children:"导出配置"}),a.jsx(zt,{accept:".json",showUploadList:!1,beforeUpload:Z,className:"flex-1",children:a.jsx(D,{icon:a.jsx(tt,{}),className:"w-full","aria-label":"从JSON文件导入配置",children:"导入配置"})})]})]})})})]})}function Ta(){return a.jsx(La,{})}function Dt(r,e=new Date){const t=e.getFullYear().toString(),s=(e.getMonth()+1).toString().padStart(2,"0"),n=e.getDate().toString().padStart(2,"0");return r.replace(/\{year\}/gi,t).replace(/\{month\}/gi,s).replace(/\{day\}/gi,n)}function Ee(r){if(!r)return"";let e=r.replace(/\/+/g,"/");return e=e.replace(/^\/+/,""),e.length>0&&(e=e.replace(/\/+$/,"")),e}function Ra(r,e){return Ee(r?e?`${r}/${e}`:r:e)}const{Dragger:Fa}=zt;function Ua(){const[r]=S.useForm(),[e,t]=m.useState([]),[s,n]=m.useState(!1),[o,i]=m.useState([]),c=$(p=>p.uploadModalVisible),l=$(p=>p.hideUploadModal),d=pe(p=>p.currentPath),h=$(p=>p.theme),{uploadFormat:x,uploadNameStrategy:f,uploadTargetPath:g,uploadCustomPath:v}=Ne(),_=h==="dark";m.useEffect(()=>{c&&(t([]),i([]))},[c]);const L=p=>{const P=p.fileList.map(N=>N.originFileObj).filter(Boolean);return t(P),!1},F=()=>b(null,null,function*(){if(e.length===0){O.warning("请先选择要上传的文件");return}try{const p={files:e,format:x,targetPath:g,customPath:v,nameStrategy:f};n(!0);const P=e.map(N=>({fileName:N.name,progress:0,status:"pending"}));i(P),yield j(p),O.success("所有文件上传完成！"),setTimeout(()=>{l()},1e3)}catch(p){p instanceof Error?O.error(`上传失败: ${p.message}`):O.error("上传失败，请重试")}finally{n(!1)}}),j=p=>b(null,null,function*(){const{imageService:P}=yield Pe(()=>b(null,null,function*(){const{imageService:u}=yield Promise.resolve().then(()=>Ca);return{imageService:u}}),void 0),{getS3Service:N}=yield Pe(()=>b(null,null,function*(){const{getS3Service:u}=yield Promise.resolve().then(()=>Wt);return{getS3Service:u}}),void 0),{cacheService:Y}=yield Pe(()=>b(null,null,function*(){const{cacheService:u}=yield Promise.resolve().then(()=>ka);return{cacheService:u}}),void 0),W=N();if(!W)throw new Error("S3服务未初始化，请先配置S3连接");let B=d;p.targetPath==="custom"&&p.customPath&&(B=Dt(p.customPath)),B=Ee(B);const H=3,Z=[];for(let u=0;u<p.files.length;u+=H){const I=p.files.slice(u,u+H).map((C,Q)=>b(null,null,function*(){const z=u+Q;try{i(E=>{const U=[...E];return U[z]=le(V({},U[z]),{status:"uploading",progress:10}),U});let ie=C,w=C.name;if(p.format==="webp"&&!C.type.includes("webp")){i(U=>{const Ie=[...U];return Ie[z].progress=30,Ie}),ie=yield P.convertToWebP(C);const E=w.lastIndexOf(".");E!==-1?w=w.substring(0,E)+".webp":w=w+".webp"}if(p.nameStrategy==="md5"){i(Ie=>{const it=[...Ie];return it[z].progress=50,it});const E=yield P.calculateMD5(C),U=w.split(".").pop();w=U?`${E}.${U}`:E}const A=B?Ra(B,w):w;i(E=>{const U=[...E];return U[z].progress=70,U}),yield W.uploadObject(A,ie),i(E=>{const U=[...E];return U[z]=le(V({},U[z]),{status:"success",progress:100}),U}),Z.push({success:!0,fileName:C.name})}catch(ie){const w=ie instanceof Error?ie.message:"未知错误";i(A=>{const E=[...A];return E[z]=le(V({},E[z]),{status:"error",progress:0,error:w}),E}),Z.push({success:!1,fileName:C.name,error:w})}}));yield Promise.all(I)}yield Y.clearPath(B);const{useGalleryStore:oe}=yield Pe(()=>b(null,null,function*(){const{useGalleryStore:u}=yield Promise.resolve().then(()=>Sa);return{useGalleryStore:u}}),void 0);yield oe.getState().refreshItems();const J=Z.filter(u=>!u.success);if(J.length>0)throw new Error(`${J.length} 个文件上传失败`)}),y=()=>{if(s){O.warning("上传进行中，请等待完成");return}l()},R=()=>g==="custom"&&v?Dt(v):d||"根目录";return a.jsxs(Le,{title:"上传图片",open:c,onCancel:y,width:600,destroyOnHidden:!0,footer:[a.jsx(D,{onClick:y,disabled:s,children:"取消"},"cancel"),a.jsx(D,{type:"primary",onClick:F,loading:s,disabled:e.length===0,"aria-label":s?"正在上传":"开始上传图片",children:s?"上传中...":"开始上传"},"upload")],className:_?"dark-modal":"",closable:!s,maskClosable:!s,"aria-labelledby":"upload-modal-title","aria-describedby":"upload-modal-description",children:[a.jsx("div",{id:"upload-modal-description",className:"sr-only",children:"选择图片文件进行上传，上传设置可在设置弹窗中配置"}),a.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:a.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300 space-y-1",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"上传路径："}),R()]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"图片格式："}),x==="webp"?"转换为WebP":"保持原格式"]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"文件名策略："}),f==="md5"?"使用MD5命名":"保留原文件名"]}),a.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"💡 可在设置中修改这些配置"})]})}),a.jsxs(S,{form:r,layout:"vertical",children:[a.jsx(S.Item,{label:"选择文件",htmlFor:"file-upload-dragger",children:a.jsxs(Fa,{id:"file-upload-dragger",multiple:!0,accept:"image/*",fileList:e.map((p,P)=>({uid:`${P}`,name:p.name,status:"done"})),onChange:L,beforeUpload:()=>!1,disabled:s,"aria-label":"拖拽或点击选择图片文件",children:[a.jsx("p",{className:"ant-upload-drag-icon",children:a.jsx(Gr,{})}),a.jsx("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"}),a.jsx("p",{className:"ant-upload-hint",children:"支持单个或批量上传图片文件"})]})}),o.length>0&&a.jsxs("div",{className:"mt-4 space-y-2",role:"region","aria-label":"上传进度","aria-live":"polite",children:[a.jsx("div",{className:"font-medium",children:"上传进度："}),o.map((p,P)=>a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[a.jsx("span",{className:"truncate flex-1",title:p.fileName,children:p.fileName}),a.jsxs("span",{className:"ml-2","aria-label":`${p.fileName} 的上传状态`,children:[p.status==="pending"&&"等待中",p.status==="uploading"&&`${p.progress}%`,p.status==="success"&&"✓ 完成",p.status==="error"&&"✗ 失败"]})]}),a.jsx(mr,{percent:p.progress,status:p.status==="error"?"exception":p.status==="success"?"success":"active",showInfo:!1,size:"small","aria-label":`${p.fileName} 上传进度 ${p.progress}%`}),p.error&&a.jsx("div",{className:"text-xs text-red-500",role:"alert",children:p.error})]},P))]})]})]})}function Da(){return a.jsx(Ua,{})}const za=({visible:r,currentName:e,onClose:t,onRename:s})=>{const[n,o]=m.useState(""),[i,c]=m.useState(!1),[l,d]=m.useState(null);m.useEffect(()=>{r&&(o(e),d(null))},[r,e]);const h=f=>b(null,null,function*(){if(f.preventDefault(),!n.trim()){d("文件名不能为空");return}if(n===e){d("新文件名与原文件名相同");return}if(/[<>:"/\\|?*]/.test(n)){d('文件名不能包含特殊字符: < > : " / \\ | ? *');return}c(!0),d(null);try{yield s(n),t()}catch(v){d(v instanceof Error?v.message:"重命名失败")}finally{c(!1)}}),x=()=>{i||t()};return r?a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",onClick:x,role:"dialog","aria-modal":"true","aria-labelledby":"rename-modal-title",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md",onClick:f=>f.stopPropagation(),children:[a.jsx("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-200 dark:border-gray-700",children:a.jsx("h2",{id:"rename-modal-title",className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:"重命名文件"})}),a.jsxs("form",{onSubmit:h,children:[a.jsxs("div",{className:"px-4 sm:px-6 py-3 sm:py-4",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{htmlFor:"newName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"新文件名"}),a.jsx("input",{id:"newName",type:"text",value:n,onChange:f=>o(f.target.value),disabled:i,className:"w-full px-3 py-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white disabled:opacity-50",placeholder:"请输入新文件名",autoFocus:!0,"aria-required":"true","aria-invalid":!!l,"aria-describedby":l?"rename-error":"rename-hint"})]}),a.jsxs("div",{id:"rename-hint",className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 mb-2",children:["原文件名: ",e]}),l&&a.jsx("div",{id:"rename-error",className:"mt-2 text-xs sm:text-sm text-red-600 dark:text-red-400",role:"alert",children:l})]}),a.jsxs("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-2 sm:gap-3",children:[a.jsx("button",{type:"button",onClick:x,disabled:i,className:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50","aria-label":"取消重命名",children:"取消"}),a.jsx("button",{type:"submit",disabled:i,className:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50","aria-label":i?"正在重命名":"确认重命名",children:i?"重命名中...":"确认"})]})]})]})}):null},Ba=()=>{const{renameModalVisible:r,currentOperationItem:e,hideRenameModal:t}=$(),{refreshItems:s}=ne(),{currentPath:n}=pe(),o=i=>b(null,null,function*(){if(!e)return;const c=ee();if(!c)throw new Error("请先配置S3连接信息");try{const l=e.key.endsWith("/"),d=e.key.split("/").filter(Boolean);d[d.length-1]=i;let h=d.join("/");l&&(h=h+"/"),yield c.renameObject(e.key,h),M.success("重命名成功"),yield K.clearPath(n),yield s()}catch(l){throw console.error("重命名失败:",l),l}});return a.jsx(za,{visible:r,currentName:(e==null?void 0:e.name)||"",onClose:t,onRename:o})},Aa=({visible:r,currentKey:e,currentPath:t,onClose:s,onMove:n})=>{const[o,i]=m.useState(""),[c,l]=m.useState(!1),[d,h]=m.useState(null),[x,f]=m.useState([]),[g,v]=m.useState(!1);m.useEffect(()=>{r&&(i(t),h(null),_())},[r,t]);const _=()=>b(null,null,function*(){const j=ee();if(j){v(!0);try{const R=(yield j.listObjects("")).filter(p=>p.isFolder).map(p=>p.key);f(["",...R])}catch(y){console.error("加载文件夹列表失败:",y)}finally{v(!1)}}}),L=j=>b(null,null,function*(){j.preventDefault();const y=e.split("/").pop()||"";if((o?`${o}${y}`:y)===e){h("目标路径与当前路径相同");return}l(!0),h(null);try{yield n(o),s()}catch(p){h(p instanceof Error?p.message:"移动失败")}finally{l(!1)}}),F=()=>{c||s()};return r?a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",onClick:F,role:"dialog","aria-modal":"true","aria-labelledby":"move-modal-title",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md",onClick:j=>j.stopPropagation(),children:[a.jsx("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-200 dark:border-gray-700",children:a.jsx("h2",{id:"move-modal-title",className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:"移动文件"})}),a.jsxs("form",{onSubmit:L,children:[a.jsxs("div",{className:"px-4 sm:px-6 py-3 sm:py-4",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{htmlFor:"targetPath",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"目标路径"}),g?a.jsx("div",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",role:"status","aria-live":"polite",children:"加载文件夹列表..."}):a.jsxs("select",{id:"targetPath",value:o,onChange:j=>i(j.target.value),disabled:c,className:"w-full px-3 py-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white disabled:opacity-50","aria-describedby":"targetPath-hint",children:[a.jsx("option",{value:"",children:"根目录 (/)"}),x.slice(1).map(j=>a.jsx("option",{value:j,children:j},j))]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{htmlFor:"customPath",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"或输入自定义路径"}),a.jsx("input",{id:"customPath",type:"text",value:o,onChange:j=>i(j.target.value),disabled:c,className:"w-full px-3 py-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white disabled:opacity-50",placeholder:"例如: images/2024/","aria-describedby":"customPath-hint"}),a.jsx("p",{id:"customPath-hint",className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"路径应以 / 结尾，留空表示根目录"})]}),a.jsxs("div",{id:"targetPath-hint",className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 mb-2",children:["当前位置: ",e]}),d&&a.jsx("div",{className:"mt-2 text-xs sm:text-sm text-red-600 dark:text-red-400",role:"alert",children:d})]}),a.jsxs("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-2 sm:gap-3",children:[a.jsx("button",{type:"button",onClick:F,disabled:c,className:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50","aria-label":"取消移动",children:"取消"}),a.jsx("button",{type:"submit",disabled:c,className:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50","aria-label":c?"正在移动文件":"确认移动文件",children:c?"移动中...":"确认"})]})]})]})}):null},Va=()=>{const{moveModalVisible:r,currentOperationItem:e,hideMoveModal:t}=$(),{refreshItems:s}=ne(),{currentPath:n}=pe(),o=i=>b(null,null,function*(){if(!e)return;const c=ee();if(!c)throw new Error("请先配置S3连接信息");try{const l=e.key.endsWith("/"),d=e.key.split("/").filter(Boolean),h=d[d.length-1];let x=i?`${i}${h}`:h;l&&(x=x+"/"),yield c.moveObject(e.key,x),M.success("移动成功"),yield K.clearPath(n),yield K.clearPath(i),yield s()}catch(l){throw console.error("移动失败:",l),l}});return a.jsx(Aa,{visible:r,currentKey:(e==null?void 0:e.key)||"",currentPath:n,onClose:t,onMove:o})};function qa({visible:r,loading:e,onOk:t,onCancel:s,isDark:n}){const[o]=S.useForm(),i=()=>b(null,null,function*(){try{const d=yield o.validateFields();yield t(d.folderName),o.resetFields()}catch(d){console.error("操作失败:",d)}}),c=()=>{o.resetFields(),s()},l=()=>{o.resetFields()};return a.jsx(Le,{title:a.jsxs("span",{children:[a.jsx(et,{className:"mr-2"}),"新建文件夹"]}),open:r,onOk:i,onCancel:c,afterClose:l,confirmLoading:e,okText:"确定",cancelText:"取消",className:n?"dark-modal":"",children:a.jsx(S,{form:o,layout:"vertical",className:"mt-4",children:a.jsx(S.Item,{name:"folderName",label:"文件夹名称",rules:[{required:!0,message:"请输入文件夹名称"},{pattern:/^[^/\\:*?"<>|]+$/,message:'文件夹名称不能包含特殊字符: / \\ : * ? " < > |'}],children:a.jsx(ae,{placeholder:"请输入文件夹名称",autoFocus:!0,onPressEnter:i})})})})}function Ka(){const[r,e]=m.useState(!1),t=$(h=>h.theme==="dark"),s=$(h=>h.createFolderModalVisible),n=$(h=>h.hideCreateFolderModal),o=pe(h=>h.currentPath),i=ne(h=>h.refreshItems),c=X(h=>h.success),l=X(h=>h.error),d=h=>b(null,null,function*(){const x=ee();if(!x){l("S3服务未初始化");return}e(!0);try{const f=o+h+"/";yield x.uploadObject(f,new Blob([])),c("文件夹创建成功"),n(),yield i()}catch(f){console.error("创建文件夹失败:",f),l(`创建文件夹失败: ${f instanceof Error?f.message:"未知错误"}`)}finally{e(!1)}});return a.jsx(qa,{visible:s,loading:r,onOk:d,onCancel:n,isDark:t})}class Wa extends m.Component{constructor(t){super(t);G(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error("错误边界捕获到错误:",t,s),this.setState({error:t,errorInfo:s})}render(){return this.state.hasError?a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:a.jsx(fr,{status:"error",title:"应用程序遇到错误",subTitle:"抱歉，应用程序遇到了一个意外错误。请尝试刷新页面。",extra:[a.jsx(D,{type:"primary",onClick:this.handleReset,children:"刷新页面"},"reload")],children:!1})}):this.props.children}}function Ha(){const r=X(t=>t.messages),e=X(t=>t.removeMessage);return m.useEffect(()=>{r.forEach(t=>{const s=t.id;switch(t.type){case"success":O.success({content:t.content,key:s,duration:(t.duration||3e3)/1e3,onClose:()=>e(t.id)});break;case"error":O.error({content:t.content,key:s,duration:(t.duration||5e3)/1e3,onClose:()=>e(t.id)});break;case"info":O.info({content:t.content,key:s,duration:(t.duration||3e3)/1e3,onClose:()=>e(t.id)});break;case"warning":O.warning({content:t.content,key:s,duration:(t.duration||3e3)/1e3,onClose:()=>e(t.id)});break;case"loading":O.loading({content:t.content,key:s,duration:0});break}})},[r,e]),null}function Ga(){const r=fe(o=>o.visible),e=fe(o=>o.options),t=fe(o=>o.loading),s=fe(o=>o.handleOk),n=fe(o=>o.handleCancel);return e?a.jsx(Le,{open:r,title:e.title,okText:e.okText||"确定",cancelText:e.cancelText||"取消",okButtonProps:{danger:e.okType==="danger",loading:t},onOk:s,onCancel:n,maskClosable:!t,closable:!t,children:e.content}):null}function Ya(){const r=$e(t=>t.loading),e=$e(t=>t.tip);return r?a.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black bg-opacity-30",children:a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-8 shadow-xl",children:a.jsx(gr,{size:"large",tip:e})})}):null}function Za(){const r=$(l=>l.theme==="dark"),e=$(l=>l.loadThemeFromStorage),t=$(l=>l.showSettingsModal),s=de(l=>l.config),n=de(l=>l.isInitialized),o=de(l=>l.loadConfigFromStorage),i=Ht(l=>l.resetCorsState),c=Ne(l=>l.loadFromStorage);return m.useEffect(()=>{e(),o(),c(),i()},[e,o,c,i]),m.useEffect(()=>{n&&!s&&t()},[n,s,t]),a.jsx(pr,{locale:Rr,theme:{algorithm:r?ut.darkAlgorithm:ut.defaultAlgorithm},children:a.jsxs("div",{className:`min-h-screen ${r?"dark bg-gray-900":"bg-gray-50"}`,lang:"zh-CN",children:[a.jsx("a",{href:"#main-content",className:"skip-to-content",children:"跳转到主内容"}),a.jsx(na,{}),a.jsx(Na,{}),a.jsx("div",{id:"main-content",children:a.jsx(Ea,{})}),a.jsx($a,{}),a.jsx(Ta,{}),a.jsx(Da,{}),a.jsx(Ba,{}),a.jsx(Va,{}),a.jsx(Ka,{}),a.jsx(Ha,{}),a.jsx(Ga,{}),a.jsx(Ya,{})]})})}Cr.createRoot(document.getElementById("root")).render(a.jsx(m.StrictMode,{children:a.jsx(Wa,{children:a.jsx(Za,{})})}))});export default Ja();
