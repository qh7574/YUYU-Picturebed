var dr=Object.defineProperty,ur=Object.defineProperties;var hr=Object.getOwnPropertyDescriptors;var _e=Object.getOwnPropertySymbols;var mt=Object.prototype.hasOwnProperty,gt=Object.prototype.propertyIsEnumerable;var fr=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t);var Ue=(t,e,r)=>e in t?dr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,W=(t,e)=>{for(var r in e||(e={}))mt.call(e,r)&&Ue(t,r,e[r]);if(_e)for(var r of _e(e))gt.call(e,r)&&Ue(t,r,e[r]);return t},re=(t,e)=>ur(t,hr(e));var Ee=(t,e)=>{var r={};for(var n in t)mt.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&_e)for(var n of _e(t))e.indexOf(n)<0&&gt.call(t,n)&&(r[n]=t[n]);return r};var mr=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var ue=(t,e,r)=>Ue(t,typeof e!="symbol"?e+"":e,r);var y=(t,e,r)=>new Promise((n,s)=>{var a=l=>{try{c(r.next(l))}catch(u){s(u)}},i=l=>{try{c(r.throw(l))}catch(u){s(u)}},c=l=>l.done?n(l.value):Promise.resolve(l.value).then(a,i);c((r=r.apply(t,e)).next())}),ze=function(t,e){this[0]=t,this[1]=e},pt=(t,e,r)=>{var n=(i,c,l,u)=>{try{var f=r[i](c),g=(c=f.value)instanceof ze,p=f.done;Promise.resolve(g?c[0]:c).then(x=>g?n(i==="return"?i:"next",c[1]?{done:x.done,value:x.value}:x,l,u):l({value:x,done:p})).catch(x=>n("throw",x,l,u))}catch(x){u(x)}},s=i=>a[i]=c=>new Promise((l,u)=>n(i,c,l,u)),a={};return r=r.apply(t,e),a[fr("asyncIterator")]=()=>a,s("next"),s("throw"),s("return"),a};import{r as gr,a as pr,g as xr}from"./vendor-DwRCIQB9.js";import{R as le,r as m,I as me,_ as ge,B as F,F as L,M as dt,a as ie,S as nt,b as yr,c as br,U as Yt,s as M,d as Y,P as vr,e as wr,f as jr,C as kr,t as xt}from"./ui-DDoHI4_O.js";import{S as yt,L as Sr,P as Cr,D as Ir,a as Or,C as Pr,H as Nr,_ as Oe}from"./aws-MgGeQvF_.js";var fs=mr(B=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}})();var Fe={exports:{}},be={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bt;function Mr(){if(bt)return be;bt=1;var t=gr(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,s=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function i(c,l,u){var f,g={},p=null,x=null;u!==void 0&&(p=""+u),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(x=l.ref);for(f in l)n.call(l,f)&&!a.hasOwnProperty(f)&&(g[f]=l[f]);if(c&&c.defaultProps)for(f in l=c.defaultProps,l)g[f]===void 0&&(g[f]=l[f]);return{$$typeof:e,type:c,key:p,ref:x,props:g,_owner:s.current}}return be.Fragment=r,be.jsx=i,be.jsxs=i,be}var vt;function _r(){return vt||(vt=1,Fe.exports=Mr()),Fe.exports}var o=_r(),Re={},wt;function Er(){if(wt)return Re;wt=1;var t=pr();return Re.createRoot=t.createRoot,Re.hydrateRoot=t.hydrateRoot,Re}var zr=Er(),ve={},Ae={exports:{}},jt;function Be(){return jt||(jt=1,(function(t){function e(r){return r&&r.__esModule?r:{default:r}}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports})(Ae)),Ae.exports}var we={},kt;function Rr(){if(kt)return we;kt=1,Object.defineProperty(we,"__esModule",{value:!0}),we.default=void 0;var t={items_per_page:"条/页",jump_to:"跳至",jump_to_confirm:"确定",page:"页",prev_page:"上一页",next_page:"下一页",prev_5:"向前 5 页",next_5:"向后 5 页",prev_3:"向前 3 页",next_3:"向后 3 页",page_size:"页码"};return we.default=t,we}var je={},ke={},Se={},qe={exports:{}},Ke={exports:{}},We={exports:{}},He={exports:{}},St;function Gt(){return St||(St=1,(function(t){function e(r){"@babel/helpers - typeof";return t.exports=e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports})(He)),He.exports}var Ye={exports:{}},Ct;function $r(){return Ct||(Ct=1,(function(t){var e=Gt().default;function r(n,s){if(e(n)!="object"||!n)return n;var a=n[Symbol.toPrimitive];if(a!==void 0){var i=a.call(n,s||"default");if(e(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(n)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports})(Ye)),Ye.exports}var It;function Lr(){return It||(It=1,(function(t){var e=Gt().default,r=$r();function n(s){var a=r(s,"string");return e(a)=="symbol"?a:a+""}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})(We)),We.exports}var Ot;function Dr(){return Ot||(Ot=1,(function(t){var e=Lr();function r(n,s,a){return(s=e(s))in n?Object.defineProperty(n,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[s]=a,n}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports})(Ke)),Ke.exports}var Pt;function Tr(){return Pt||(Pt=1,(function(t){var e=Dr();function r(s,a){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(s);a&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),i.push.apply(i,c)}return i}function n(s){for(var a=1;a<arguments.length;a++){var i=arguments[a]!=null?arguments[a]:{};a%2?r(Object(i),!0).forEach(function(c){e(s,c,i[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach(function(c){Object.defineProperty(s,c,Object.getOwnPropertyDescriptor(i,c))})}return s}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})(qe)),qe.exports}var Ce={},Nt;function Br(){return Nt||(Nt=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.commonLocale=void 0,Ce.commonLocale={yearFormat:"YYYY",dayFormat:"D",cellMeridiemFormat:"A",monthBeforeYear:!0}),Ce}var Mt;function Vr(){if(Mt)return Se;Mt=1;var t=Be().default;Object.defineProperty(Se,"__esModule",{value:!0}),Se.default=void 0;var e=t(Tr()),r=Br(),n=(0,e.default)((0,e.default)({},r.commonLocale),{},{locale:"zh_CN",today:"今天",now:"此刻",backToToday:"返回今天",ok:"确定",timeSelect:"选择时间",dateSelect:"选择日期",weekSelect:"选择周",clear:"清除",week:"周",month:"月",year:"年",previousMonth:"上个月 (翻页上键)",nextMonth:"下个月 (翻页下键)",monthSelect:"选择月份",yearSelect:"选择年份",decadeSelect:"选择年代",previousYear:"上一年 (Control键加左方向键)",nextYear:"下一年 (Control键加右方向键)",previousDecade:"上一年代",nextDecade:"下一年代",previousCentury:"上一世纪",nextCentury:"下一世纪",yearFormat:"YYYY年",cellDateFormat:"D",monthBeforeYear:!1});return Se.default=n,Se}var Ie={},_t;function Zt(){if(_t)return Ie;_t=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.default=void 0;const t={placeholder:"请选择时间",rangePlaceholder:["开始时间","结束时间"]};return Ie.default=t,Ie}var Et;function Jt(){if(Et)return ke;Et=1;var t=Be().default;Object.defineProperty(ke,"__esModule",{value:!0}),ke.default=void 0;var e=t(Vr()),r=t(Zt());const n={lang:Object.assign({placeholder:"请选择日期",yearPlaceholder:"请选择年份",quarterPlaceholder:"请选择季度",monthPlaceholder:"请选择月份",weekPlaceholder:"请选择周",rangePlaceholder:["开始日期","结束日期"],rangeYearPlaceholder:["开始年份","结束年份"],rangeMonthPlaceholder:["开始月份","结束月份"],rangeQuarterPlaceholder:["开始季度","结束季度"],rangeWeekPlaceholder:["开始周","结束周"]},e.default),timePickerLocale:Object.assign({},r.default)};return n.lang.ok="确定",ke.default=n,ke}var zt;function Ur(){if(zt)return je;zt=1;var t=Be().default;Object.defineProperty(je,"__esModule",{value:!0}),je.default=void 0;var e=t(Jt());return je.default=e.default,je}var Rt;function Fr(){if(Rt)return ve;Rt=1;var t=Be().default;Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=void 0;var e=t(Rr()),r=t(Ur()),n=t(Jt()),s=t(Zt());const a="${label}不是一个有效的${type}",i={locale:"zh-cn",Pagination:e.default,DatePicker:n.default,TimePicker:s.default,Calendar:r.default,global:{placeholder:"请选择",close:"关闭"},Table:{filterTitle:"筛选",filterConfirm:"确定",filterReset:"重置",filterEmptyText:"无筛选项",filterCheckAll:"全选",filterSearchPlaceholder:"在筛选项中搜索",emptyText:"暂无数据",selectAll:"全选当页",selectInvert:"反选当页",selectNone:"清空所有",selectionAll:"全选所有",sortTitle:"排序",expand:"展开行",collapse:"关闭行",triggerDesc:"点击降序",triggerAsc:"点击升序",cancelSort:"取消排序"},Modal:{okText:"确定",cancelText:"取消",justOkText:"知道了"},Tour:{Next:"下一步",Previous:"上一步",Finish:"结束导览"},Popconfirm:{cancelText:"取消",okText:"确定"},Transfer:{titles:["",""],searchPlaceholder:"请输入搜索内容",itemUnit:"项",itemsUnit:"项",remove:"删除",selectCurrent:"全选当页",removeCurrent:"删除当页",selectAll:"全选所有",deselectAll:"取消全选",removeAll:"删除全部",selectInvert:"反选当页"},Upload:{uploading:"文件上传中",removeFile:"删除文件",uploadError:"上传错误",previewFile:"预览文件",downloadFile:"下载文件"},Empty:{description:"暂无数据"},Icon:{icon:"图标"},Text:{edit:"编辑",copy:"复制",copied:"复制成功",expand:"展开",collapse:"收起"},Form:{optional:"（可选）",defaultValidateMessages:{default:"字段验证错误${label}",required:"请输入${label}",enum:"${label}必须是其中一个[${enum}]",whitespace:"${label}不能为空字符",date:{format:"${label}日期格式无效",parse:"${label}不能转换为日期",invalid:"${label}是一个无效日期"},types:{string:a,method:a,array:a,object:a,number:a,date:a,boolean:a,integer:a,float:a,regexp:a,email:a,url:a,hex:a},string:{len:"${label}须为${len}个字符",min:"${label}最少${min}个字符",max:"${label}最多${max}个字符",range:"${label}须在${min}-${max}字符之间"},number:{len:"${label}必须等于${len}",min:"${label}最小值为${min}",max:"${label}最大值为${max}",range:"${label}须在${min}-${max}之间"},array:{len:"须为${len}个${label}",min:"最少${min}个${label}",max:"最多${max}个${label}",range:"${label}数量须在${min}-${max}之间"},pattern:{mismatch:"${label}与模式不匹配${pattern}"}}},Image:{preview:"预览"},QRCode:{expired:"二维码过期",refresh:"点击刷新",scanned:"已扫描"},ColorPicker:{presetEmpty:"暂无",transparent:"无色",singleColor:"单色",gradientColor:"渐变色"}};return ve.default=i,ve}var Ge,$t;function Ar(){return $t||($t=1,Ge=Fr()),Ge}var qr=Ar();const Kr=xr(qr),Lt=t=>{let e;const r=new Set,n=(u,f)=>{const g=typeof u=="function"?u(e):u;if(!Object.is(g,e)){const p=e;e=(f!=null?f:typeof g!="object"||g===null)?g:Object.assign({},e,g),r.forEach(x=>x(e,p))}},s=()=>e,c={setState:n,getState:s,getInitialState:()=>l,subscribe:u=>(r.add(u),()=>r.delete(u))},l=e=t(n,s,c);return c},Wr=(t=>t?Lt(t):Lt),Hr=t=>t;function Yr(t,e=Hr){const r=le.useSyncExternalStore(t.subscribe,le.useCallback(()=>e(t.getState()),[t,e]),le.useCallback(()=>e(t.getInitialState()),[t,e]));return le.useDebugValue(r),r}const Dt=t=>{const e=Wr(t),r=n=>Yr(e,n);return Object.assign(r,e),r},ae=(t=>t?Dt(t):Dt),Ze="s3-gallery-config",Je="s3-gallery-theme";class Gr{saveConfig(e){try{const r=JSON.stringify(e);localStorage.setItem(Ze,r)}catch(r){throw console.error("保存配置失败:",r),new Error("保存配置失败")}}loadConfig(){try{const e=localStorage.getItem(Ze);return e?JSON.parse(e):null}catch(e){return console.error("加载配置失败:",e),null}}exportConfig(){const e=this.loadConfig();if(!e)throw new Error("没有可导出的配置");return JSON.stringify(e,null,2)}importConfig(e){try{const r=JSON.parse(e);if(!r.accessKeyId||!r.secretAccessKey||!r.endpoint||!r.bucket)throw new Error("配置文件缺少必填字段");return r}catch(r){throw r instanceof SyntaxError?new Error("配置文件格式无效"):r}}saveTheme(e){try{localStorage.setItem(Je,e)}catch(r){console.error("保存主题失败:",r)}}loadTheme(){try{const e=localStorage.getItem(Je);return e==="dark"||e==="light"?e:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch(e){return"light"}}clearAll(){localStorage.removeItem(Ze),localStorage.removeItem(Je)}}const ce=new Gr,D=ae(t=>({theme:"light",uploadModalVisible:!1,settingsModalVisible:!1,viewerVisible:!1,currentImageIndex:0,renameModalVisible:!1,moveModalVisible:!1,currentOperationItem:null,toggleTheme:()=>t(e=>{const r=e.theme==="light"?"dark":"light";return ce.saveTheme(r),{theme:r}}),showUploadModal:()=>t({uploadModalVisible:!0}),hideUploadModal:()=>t({uploadModalVisible:!1}),showSettingsModal:()=>t({settingsModalVisible:!0}),hideSettingsModal:()=>t({settingsModalVisible:!1}),showViewer:e=>t({viewerVisible:!0,currentImageIndex:e}),hideViewer:()=>t({viewerVisible:!1}),setCurrentImageIndex:e=>t({currentImageIndex:e}),loadThemeFromStorage:()=>{const e=ce.loadTheme();t({theme:e})},showRenameModal:e=>t({renameModalVisible:!0,currentOperationItem:e}),hideRenameModal:()=>t({renameModalVisible:!1,currentOperationItem:null}),showMoveModal:e=>t({moveModalVisible:!0,currentOperationItem:e}),hideMoveModal:()=>t({moveModalVisible:!1,currentOperationItem:null})}));class Qt{constructor(e){ue(this,"client");ue(this,"config");this.config=e,this.client=new yt({region:e.region,endpoint:e.endpoint,credentials:{accessKeyId:e.accessKeyId,secretAccessKey:e.secretAccessKey},forcePathStyle:!0})}listObjects(e){return y(this,null,function*(){try{const r=new Sr({Bucket:this.config.bucket,Prefix:e,Delimiter:"/"}),n=yield this.client.send(r),s=[];if(n.CommonPrefixes)for(const a of n.CommonPrefixes)a.Prefix&&s.push({key:a.Prefix,size:0,lastModified:new Date,isFolder:!0});if(n.Contents)for(const a of n.Contents)a.Key&&a.Key!==e&&s.push({key:a.Key,size:a.Size||0,lastModified:a.LastModified||new Date,isFolder:!1});return s}catch(r){throw console.error("列出对象失败:",r),new Error(`列出对象失败: ${r instanceof Error?r.message:"未知错误"}`)}})}uploadObject(e,r){return y(this,null,function*(){try{const n=new Cr({Bucket:this.config.bucket,Key:e,Body:r,ContentType:r.type});yield this.client.send(n)}catch(n){throw console.error("上传对象失败:",n),new Error(`上传对象失败: ${n instanceof Error?n.message:"未知错误"}`)}})}deleteObject(e){return y(this,null,function*(){try{const r=new Ir({Bucket:this.config.bucket,Key:e});yield this.client.send(r)}catch(r){throw console.error("删除对象失败:",r),new Error(`删除对象失败: ${r instanceof Error?r.message:"未知错误"}`)}})}deleteObjects(e){return y(this,null,function*(){const r={success:[],failed:[]};if(e.length===0)return r;try{for(let s=0;s<e.length;s+=1e3){const a=e.slice(s,s+1e3),i=new Or({Bucket:this.config.bucket,Delete:{Objects:a.map(l=>({Key:l})),Quiet:!1}}),c=yield this.client.send(i);if(c.Deleted)for(const l of c.Deleted)l.Key&&r.success.push(l.Key);if(c.Errors)for(const l of c.Errors)l.Key&&r.failed.push({key:l.Key,error:l.Message||"未知错误"})}}catch(n){console.error("批量删除对象失败:",n);for(const s of e)r.success.includes(s)||r.failed.push({key:s,error:n instanceof Error?n.message:"未知错误"})}return r})}renameObject(e,r){return y(this,null,function*(){try{const n=new Pr({Bucket:this.config.bucket,CopySource:`${this.config.bucket}/${e}`,Key:r});yield this.client.send(n),yield this.deleteObject(e)}catch(n){throw console.error("重命名对象失败:",n),new Error(`重命名对象失败: ${n instanceof Error?n.message:"未知错误"}`)}})}moveObject(e,r){return y(this,null,function*(){return this.renameObject(e,r)})}testConnection(){return y(this,null,function*(){try{const e=new Nr({Bucket:this.config.bucket});return yield this.client.send(e),!0}catch(e){return console.error("测试连接失败:",e),!1}})}getObjectUrl(e){if(this.config.customDomain)return`${this.config.customDomain.replace(/\/$/,"")}/${e}`;const r=this.config.endpoint.replace(/\/$/,"");return r.includes("://")?`${r}/${this.config.bucket}/${e}`:`https://${r}/${this.config.bucket}/${e}`}updateConfig(e){this.config=e,this.client=new yt({region:e.region,endpoint:e.endpoint,credentials:{accessKeyId:e.accessKeyId,secretAccessKey:e.secretAccessKey},forcePathStyle:!0})}destroy(){this.client.destroy()}}let se=null;function $e(t){return se&&se.destroy(),se=new Qt(t),se}function G(){return se}function Xt(){se&&(se.destroy(),se=null)}const er=Object.freeze(Object.defineProperty({__proto__:null,S3Service:Qt,destroyS3Service:Xt,getS3Service:G,initS3Service:$e},Symbol.toStringTag,{value:"Module"})),Pe=ae(t=>({config:null,isInitialized:!1,setConfig:e=>{$e(e),t({config:e,isInitialized:!0})},clearConfig:()=>{Xt(),ce.saveConfig({}),t({config:null,isInitialized:!1})},loadConfigFromStorage:()=>{const e=ce.loadConfig();e?($e(e),t({config:e,isInitialized:!0})):t({isInitialized:!0})},saveConfigToStorage:e=>{ce.saveConfig(e),$e(e),t({config:e,isInitialized:!0})}}));var Zr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},Jr=function(e,r){return m.createElement(me,ge({},e,{ref:r,icon:Zr}))},Qr=m.forwardRef(Jr),Xr={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},en=function(e,r){return m.createElement(me,ge({},e,{ref:r,icon:Xr}))},tn=m.forwardRef(en),rn={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M489.5 111.66c30.65-1.8 45.98 36.44 22.58 56.33A243.35 243.35 0 00426 354c0 134.76 109.24 244 244 244 72.58 0 139.9-31.83 186.01-86.08 19.87-23.38 58.07-8.1 56.34 22.53C900.4 745.82 725.15 912 512.5 912 291.31 912 112 732.69 112 511.5c0-211.39 164.29-386.02 374.2-399.65l.2-.01zm-81.15 79.75l-4.11 1.36C271.1 237.94 176 364.09 176 511.5 176 697.34 326.66 848 512.5 848c148.28 0 274.94-96.2 319.45-230.41l.63-1.93-.11.07a307.06 307.06 0 01-159.73 46.26L670 662c-170.1 0-308-137.9-308-308 0-58.6 16.48-114.54 46.27-162.47z"}}]},name:"moon",theme:"outlined"},nn=function(e,r){return m.createElement(me,ge({},e,{ref:r,icon:rn}))},sn=m.forwardRef(nn),on={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"},an=function(e,r){return m.createElement(me,ge({},e,{ref:r,icon:on}))},Tt=m.forwardRef(an),ln={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M548 818v126a16 16 0 01-16 16h-40a16 16 0 01-16-16V818c15.85 1.64 27.84 2.46 36 2.46 8.15 0 20.16-.82 36-2.46m205.25-115.66l89.1 89.1a16 16 0 010 22.62l-28.29 28.29a16 16 0 01-22.62 0l-89.1-89.1c12.37-10.04 21.43-17.95 27.2-23.71 5.76-5.77 13.67-14.84 23.71-27.2m-482.5 0c10.04 12.36 17.95 21.43 23.71 27.2 5.77 5.76 14.84 13.67 27.2 23.71l-89.1 89.1a16 16 0 01-22.62 0l-28.29-28.29a16 16 0 010-22.63zM512 278c129.24 0 234 104.77 234 234S641.24 746 512 746 278 641.24 278 512s104.77-234 234-234m0 72c-89.47 0-162 72.53-162 162s72.53 162 162 162 162-72.53 162-162-72.53-162-162-162M206 476c-1.64 15.85-2.46 27.84-2.46 36 0 8.15.82 20.16 2.46 36H80a16 16 0 01-16-16v-40a16 16 0 0116-16zm738 0a16 16 0 0116 16v40a16 16 0 01-16 16H818c1.64-15.85 2.46-27.84 2.46-36 0-8.15-.82-20.16-2.46-36zM814.06 180.65l28.29 28.29a16 16 0 010 22.63l-89.1 89.09c-10.04-12.37-17.95-21.43-23.71-27.2-5.77-5.76-14.84-13.67-27.2-23.71l89.1-89.1a16 16 0 0122.62 0m-581.5 0l89.1 89.1c-12.37 10.04-21.43 17.95-27.2 23.71-5.76 5.77-13.67 14.84-23.71 27.2l-89.1-89.1a16 16 0 010-22.62l28.29-28.29a16 16 0 0122.62 0M532 64a16 16 0 0116 16v126c-15.85-1.64-27.84-2.46-36-2.46-8.15 0-20.16.82-36 2.46V80a16 16 0 0116-16z"}}]},name:"sun",theme:"outlined"},cn=function(e,r){return m.createElement(me,ge({},e,{ref:r,icon:ln}))},dn=m.forwardRef(cn),un={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},hn=function(e,r){return m.createElement(me,ge({},e,{ref:r,icon:un}))},st=m.forwardRef(hn);function fn(){const t=D(a=>a.theme),e=D(a=>a.toggleTheme),r=D(a=>a.showUploadModal),n=D(a=>a.showSettingsModal),s=t==="dark";return o.jsx("header",{className:`sticky top-0 z-50 border-b ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:o.jsxs("div",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[o.jsx("h1",{className:`text-lg md:text-xl font-bold ${s?"text-white":"text-gray-900"}`,children:"S3图床管理"}),o.jsx("div",{className:"flex-1"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(F,{type:"text",icon:s?o.jsx(dn,{}):o.jsx(sn,{}),onClick:e,"aria-label":s?"切换到浅色模式":"切换到深色模式",className:s?"text-gray-300 hover:text-white":""}),o.jsx(F,{type:"primary",icon:o.jsx(st,{}),onClick:r,className:"hidden sm:inline-flex",children:"上传"}),o.jsx(F,{type:"primary",icon:o.jsx(st,{}),onClick:r,className:"sm:hidden","aria-label":"上传图片"}),o.jsx(F,{icon:o.jsx(Tt,{}),onClick:n,className:"hidden sm:inline-flex",children:"设置"}),o.jsx(F,{icon:o.jsx(Tt,{}),onClick:n,className:"sm:hidden","aria-label":"打开设置"})]})]})})}const mn=({currentPath:t,onNavigate:e,selectedCount:r,onBatchDownload:n,onBatchCopyUrl:s,onBatchDelete:a})=>{const i=le.useMemo(()=>{if(!t||t==="/")return[{name:"根目录",path:""}];const c=t.split("/").filter(Boolean),l=[{name:"根目录",path:""}];let u="";for(const f of c)u+=(u?"/":"")+f,l.push({name:f,path:u});return l},[t]);return o.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:[o.jsx("nav",{className:"flex items-center space-x-2 flex-1 overflow-x-auto",children:i.map((c,l)=>o.jsxs(le.Fragment,{children:[l>0&&o.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"/"}),o.jsx("button",{onClick:()=>e(c.path),className:`
                px-2 py-1 rounded text-sm font-medium transition-colors
                ${l===i.length-1?"text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}
              `,disabled:l===i.length-1,children:c.name})]},c.path))}),r>0&&o.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[o.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["已选中 ",r," 项"]}),o.jsxs("button",{onClick:n,className:"px-3 py-1.5 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded transition-colors",title:"批量下载",children:[o.jsx("svg",{className:"w-4 h-4 inline-block mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"下载"]}),o.jsxs("button",{onClick:s,className:"px-3 py-1.5 text-sm font-medium text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors",title:"批量复制路径",children:[o.jsx("svg",{className:"w-4 h-4 inline-block mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"复制"]}),o.jsxs("button",{onClick:a,className:"px-3 py-1.5 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded transition-colors",title:"批量删除",children:[o.jsx("svg",{className:"w-4 h-4 inline-block mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"删除"]})]})]})},Me=ae(t=>({currentPath:"",pathHistory:[],navigate:e=>t(r=>({currentPath:e,pathHistory:[...r.pathHistory,r.currentPath]})),goBack:()=>t(e=>{var s;const r=[...e.pathHistory];return{currentPath:(s=r.pop())!=null?s:"",pathHistory:r}}),goToPath:e=>t({currentPath:e,pathHistory:[]})})),tr=ae((t,e)=>({selectedItems:new Set,toggleSelection:r=>t(n=>{const s=new Set(n.selectedItems);return s.has(r)?s.delete(r):s.add(r),{selectedItems:s}}),selectAll:r=>t({selectedItems:new Set(r)}),clearSelection:()=>t({selectedItems:new Set}),isSelected:r=>e().selectedItems.has(r)})),ot=(t,e)=>e.some(r=>t instanceof r);let Bt,Vt;function gn(){return Bt||(Bt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function pn(){return Vt||(Vt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const at=new WeakMap,Qe=new WeakMap,Ve=new WeakMap;function xn(t){const e=new Promise((r,n)=>{const s=()=>{t.removeEventListener("success",a),t.removeEventListener("error",i)},a=()=>{r(de(t.result)),s()},i=()=>{n(t.error),s()};t.addEventListener("success",a),t.addEventListener("error",i)});return Ve.set(e,t),e}function yn(t){if(at.has(t))return;const e=new Promise((r,n)=>{const s=()=>{t.removeEventListener("complete",a),t.removeEventListener("error",i),t.removeEventListener("abort",i)},a=()=>{r(),s()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",a),t.addEventListener("error",i),t.addEventListener("abort",i)});at.set(t,e)}let it={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return at.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return de(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function rr(t){it=t(it)}function bn(t){return pn().includes(t)?function(...e){return t.apply(lt(this),e),de(this.request)}:function(...e){return de(t.apply(lt(this),e))}}function vn(t){return typeof t=="function"?bn(t):(t instanceof IDBTransaction&&yn(t),ot(t,gn())?new Proxy(t,it):t)}function de(t){if(t instanceof IDBRequest)return xn(t);if(Qe.has(t))return Qe.get(t);const e=vn(t);return e!==t&&(Qe.set(t,e),Ve.set(e,t)),e}const lt=t=>Ve.get(t);function wn(t,e,{blocked:r,upgrade:n,blocking:s,terminated:a}={}){const i=indexedDB.open(t,e),c=de(i);return n&&i.addEventListener("upgradeneeded",l=>{n(de(i.result),l.oldVersion,l.newVersion,de(i.transaction),l)}),r&&i.addEventListener("blocked",l=>r(l.oldVersion,l.newVersion,l)),c.then(l=>{a&&l.addEventListener("close",()=>a()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),c}const jn=["get","getKey","getAll","getAllKeys","count"],kn=["put","add","delete","clear"],Xe=new Map;function Ut(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Xe.get(e))return Xe.get(e);const r=e.replace(/FromIndex$/,""),n=e!==r,s=kn.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(s||jn.includes(r)))return;const a=function(i,...c){return y(this,null,function*(){const l=this.transaction(i,s?"readwrite":"readonly");let u=l.store;return n&&(u=u.index(c.shift())),(yield Promise.all([u[r](...c),s&&l.done]))[0]})};return Xe.set(e,a),a}rr(t=>re(W({},t),{get:(e,r,n)=>Ut(e,r)||t.get(e,r,n),has:(e,r)=>!!Ut(e,r)||t.has(e,r)}));const Sn=["continue","continuePrimaryKey","advance"],Ft={},ct=new WeakMap,nr=new WeakMap,Cn={get(t,e){if(!Sn.includes(e))return t[e];let r=Ft[e];return r||(r=Ft[e]=function(...n){ct.set(this,nr.get(this)[e](...n))}),r}};function In(...t){return pt(this,null,function*(){let e=this;if(e instanceof IDBCursor||(e=yield new ze(e.openCursor(...t))),!e)return;e=e;const r=new Proxy(e,Cn);for(nr.set(r,e),Ve.set(r,lt(e));e;)yield r,e=yield new ze(ct.get(r)||e.continue()),ct.delete(r)})}function At(t,e){return e===Symbol.asyncIterator&&ot(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&ot(t,[IDBIndex,IDBObjectStore])}rr(t=>re(W({},t),{get(e,r,n){return At(e,r)?In:t.get(e,r,n)},has(e,r){return At(e,r)||t.has(e,r)}}));const On=300*1e3,Pn="s3-image-gallery-cache",Nn=1;class sr{constructor(){ue(this,"db",null);ue(this,"initPromise",null)}init(){return y(this,null,function*(){if(!this.db)return this.initPromise?this.initPromise:(this.initPromise=this.doInit(),this.initPromise)})}doInit(){return y(this,null,function*(){try{this.db=yield wn(Pn,Nn,{upgrade(e){e.objectStoreNames.contains("directories")||e.createObjectStore("directories"),e.objectStoreNames.contains("thumbnails")||e.createObjectStore("thumbnails")}})}catch(e){console.error("Failed to initialize IndexedDB:",e),this.db=null}})}ensureDB(){return y(this,null,function*(){return this.db||(yield this.init()),this.db})}cacheDirectory(s,a){return y(this,arguments,function*(e,r,n=On){const i=yield this.ensureDB();if(i)try{const c={items:r,timestamp:Date.now(),ttl:n};yield i.put("directories",c,e)}catch(c){console.error("Failed to cache directory:",c)}})}getDirectory(e){return y(this,null,function*(){const r=yield this.ensureDB();if(!r)return null;try{const n=yield r.get("directories",e);return n?Date.now()-n.timestamp>n.ttl?(yield r.delete("directories",e),null):n.items:null}catch(n){return console.error("Failed to get cached directory:",n),null}})}cacheThumbnail(e,r){return y(this,null,function*(){const n=yield this.ensureDB();if(n)try{const s={blob:r,timestamp:Date.now()};yield n.put("thumbnails",s,e)}catch(s){console.error("Failed to cache thumbnail:",s)}})}getThumbnail(e){return y(this,null,function*(){const r=yield this.ensureDB();if(!r)return null;try{const n=yield r.get("thumbnails",e);return n?n.blob:null}catch(n){return console.error("Failed to get cached thumbnail:",n),null}})}clearPath(e){return y(this,null,function*(){const r=yield this.ensureDB();if(r)try{const n=r.transaction("directories","readwrite"),s=n.objectStore("directories"),a=yield s.getAllKeys(),i=e.endsWith("/")?e:e+"/";for(const l of a)(l===e||l.startsWith(i))&&(yield s.delete(l));const c=this.getParentPath(e);c!==null&&c!==e&&(yield s.delete(c)),yield n.done}catch(n){console.error("Failed to clear path cache:",n)}})}getParentPath(e){if(!e||e===""||e==="/")return null;const r=e.endsWith("/")?e.slice(0,-1):e,n=r.lastIndexOf("/");return n===-1?"":r.substring(0,n)}clearAll(){return y(this,null,function*(){const e=yield this.ensureDB();if(e)try{yield e.clear("directories"),yield e.clear("thumbnails")}catch(r){console.error("Failed to clear all cache:",r)}})}close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null)}}const Z=new sr,Mn=Object.freeze(Object.defineProperty({__proto__:null,CacheService:sr,cacheService:Z},Symbol.toStringTag,{value:"Module"}));function et(t){return[...t].sort((e,r)=>e.type==="folder"&&r.type!=="folder"?-1:e.type!=="folder"&&r.type==="folder"?1:e.name.localeCompare(r.name))}const pe=ae((t,e)=>({items:[],loading:!1,error:null,currentPath:"",setItems:r=>t({items:et(r),error:null}),setLoading:r=>t({loading:r}),setError:r=>t({error:r,loading:!1}),clearItems:()=>t({items:[],error:null}),loadItems:r=>y(null,null,function*(){const n=G();if(!n){t({error:"请先配置S3连接信息",loading:!1});return}t({loading:!0,error:null,currentPath:r});try{const s=yield Z.getDirectory(r);if(s){t({items:et(s),loading:!1});return}const i=(yield n.listObjects(r)).map(l=>{const u=l.key.replace(r,"").replace(/\/$/,"");return l.isFolder?{type:"folder",key:l.key,name:u}:{type:"image",key:l.key,name:u,fullUrl:n.getObjectUrl(l.key),thumbnailUrl:n.getObjectUrl(l.key),size:l.size,lastModified:l.lastModified}}).filter(l=>l.name),c=et(i);t({items:c,loading:!1}),yield Z.cacheDirectory(r,c)}catch(s){console.error("加载目录失败:",s),t({error:s instanceof Error?s.message:"加载目录失败",loading:!1})}}),refreshItems:()=>y(null,null,function*(){const{currentPath:r,loadItems:n}=e();yield Z.clearPath(r),yield n(r)})})),_n=Object.freeze(Object.defineProperty({__proto__:null,useGalleryStore:pe},Symbol.toStringTag,{value:"Module"}));let En=0;const ne=ae((t,e)=>({messages:[],addMessage:(r,n,s=3e3)=>{const a=`message-${++En}`,i={id:a,type:r,content:n,duration:s};return t(c=>({messages:[...c.messages,i]})),r!=="loading"&&s>0&&setTimeout(()=>{t(c=>({messages:c.messages.filter(l=>l.id!==a)}))},s),a},removeMessage:r=>{t(n=>({messages:n.messages.filter(s=>s.id!==r)}))},success:(r,n)=>e().addMessage("success",r,n),error:(r,n=5e3)=>e().addMessage("error",r,n),info:(r,n)=>e().addMessage("info",r,n),warning:(r,n)=>e().addMessage("warning",r,n),loading:r=>e().addMessage("loading",r,0)})),N={success:(t,e)=>{ne.getState().success(t,e)},error:(t,e)=>{ne.getState().error(t,e)},info:(t,e)=>{ne.getState().info(t,e)},warning:(t,e)=>{ne.getState().warning(t,e)},loading:t=>ne.getState().loading(t),destroy:t=>{ne.getState().removeMessage(t)}},fe=ae((t,e)=>({visible:!1,options:null,loading:!1,showConfirm:r=>{t({visible:!0,options:r,loading:!1})},hideConfirm:()=>{t({visible:!1,options:null,loading:!1})},setLoading:r=>{t({loading:r})},handleOk:()=>y(null,null,function*(){const{options:r,hideConfirm:n,setLoading:s}=e();if(!(r!=null&&r.onOk)){n();return}try{s(!0),yield r.onOk(),n()}catch(a){throw console.error("确认操作失败:",a),s(!1),a}}),handleCancel:()=>{var s;const{options:r,hideConfirm:n}=e();(s=r==null?void 0:r.onCancel)==null||s.call(r),n()}})),or=t=>{fe.getState().showConfirm(t)},De=ae(t=>({loading:!1,tip:"加载中...",showLoading:(e="加载中...")=>{t({loading:!0,tip:e})},hideLoading:()=>{t({loading:!1})}})),tt={show:t=>{De.getState().showLoading(t)},hide:()=>{De.getState().hideLoading()}};class zn{generateThumbnail(e,r=300,n=300){return y(this,null,function*(){return new Promise((s,a)=>{const i=new Image,c=URL.createObjectURL(e);i.onload=()=>{URL.revokeObjectURL(c);let l=i.width,u=i.height;if(l>r||u>n){const p=Math.min(r/l,n/u);l=Math.round(l*p),u=Math.round(u*p)}const f=document.createElement("canvas");f.width=l,f.height=u;const g=f.getContext("2d");if(!g){a(new Error("无法创建Canvas上下文"));return}g.drawImage(i,0,0,l,u),f.toBlob(p=>{p?s(p):a(new Error("生成缩略图失败"))},"image/jpeg",.8)},i.onerror=()=>{URL.revokeObjectURL(c),a(new Error("加载图片失败"))},i.src=c})})}convertToWebP(e,r=.9){return y(this,null,function*(){return new Promise((n,s)=>{const a=new Image,i=URL.createObjectURL(e);a.onload=()=>{URL.revokeObjectURL(i);const c=document.createElement("canvas");c.width=a.width,c.height=a.height;const l=c.getContext("2d");if(!l){s(new Error("无法创建Canvas上下文"));return}l.drawImage(a,0,0),c.toBlob(u=>{u?n(u):s(new Error("转换WebP失败"))},"image/webp",r)},a.onerror=()=>{URL.revokeObjectURL(i),s(new Error("加载图片失败"))},a.src=i})})}calculateMD5(e){return y(this,null,function*(){const r=yield e.arrayBuffer(),n=yield crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(n)).map(i=>i.toString(16).padStart(2,"0")).join("").substring(0,16)})}downloadImages(e,r){return y(this,null,function*(){for(let n=0;n<e.length;n++)yield this.downloadSingleImage(e[n],r[n]),n<e.length-1&&(yield new Promise(s=>setTimeout(s,300)))})}downloadSingleImage(e,r){return y(this,null,function*(){try{const s=yield(yield fetch(e)).blob(),a=URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.download=r,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)}catch(n){throw console.error(`下载图片失败: ${r}`,n),n}})}getImageDimensions(e){return y(this,null,function*(){return new Promise((r,n)=>{const s=new Image,a=URL.createObjectURL(e);s.onload=()=>{URL.revokeObjectURL(a),r({width:s.width,height:s.height})},s.onerror=()=>{URL.revokeObjectURL(a),n(new Error("加载图片失败"))},s.src=a})})}}const ut=new zn,Rn=Object.freeze(Object.defineProperty({__proto__:null,imageService:ut},Symbol.toStringTag,{value:"Module"})),$n=()=>{const{currentPath:t,goToPath:e}=Me(),{selectedItems:r,clearSelection:n}=tr(),{items:s,refreshItems:a}=pe(),i=le.useMemo(()=>s.filter(g=>g.type==="image"&&r.has(g.key)),[s,r]),c=g=>{e(g),n()},l=()=>y(null,null,function*(){if(i.length===0){N.warning("请选择要下载的图片");return}const g=G();if(!g){N.error("请先配置S3连接信息");return}tt.show(`正在下载 ${i.length} 张图片...`);try{const p=i.map(S=>g.getObjectUrl(S.key)),x=i.map(S=>S.name);yield ut.downloadImages(p,x),tt.hide(),N.success(`成功下载 ${i.length} 张图片`)}catch(p){console.error("批量下载失败:",p),tt.hide(),N.error(p instanceof Error?p.message:"批量下载失败，请重试")}}),u=()=>y(null,null,function*(){if(i.length===0){N.warning("请选择要复制路径的图片");return}const g=G();if(!g){N.error("请先配置S3连接信息");return}try{const x=i.map(S=>g.getObjectUrl(S.key)).join(`
`);yield navigator.clipboard.writeText(x),N.success(`已复制 ${i.length} 个图片URL到剪贴板`)}catch(p){console.error("复制URL失败:",p),N.error("复制失败，请重试")}}),f=()=>{if(i.length===0){N.warning("请选择要删除的图片");return}or({title:"确认批量删除",content:`确定要删除选中的 ${i.length} 张图片吗？此操作无法撤销。`,okText:"删除",cancelText:"取消",okType:"danger",onOk:()=>y(null,null,function*(){const g=G();if(!g){N.error("请先配置S3连接信息");return}try{const p=i.map(S=>S.key),x=yield g.deleteObjects(p);x.failed.length>0?N.warning(`删除完成，成功: ${x.success.length}，失败: ${x.failed.length}`):N.success(`成功删除 ${x.success.length} 张图片`),n(),yield Z.clearPath(t),yield a()}catch(p){throw console.error("批量删除失败:",p),N.error(p instanceof Error?p.message:"批量删除失败，请重试"),p}})})};return o.jsx(mn,{currentPath:t,onNavigate:c,selectedCount:r.size,onBatchDownload:l,onBatchCopyUrl:u,onBatchDelete:f})},qt=({item:t,selected:e,onSelect:r,onClick:n,onDownload:s,onCopyUrl:a,onDelete:i,onRename:c,onMove:l})=>{const[u,f]=m.useState(!1),[g,p]=m.useState(!1),[x,S]=m.useState(!1),I=m.useRef(null),P=m.useRef(null);m.useEffect(()=>{if(!I.current)return;const C=new IntersectionObserver(k=>{k.forEach(E=>{E.isIntersecting&&(p(!0),C.disconnect())})},{rootMargin:"50px"});return C.observe(I.current),()=>{C.disconnect()}},[]),m.useEffect(()=>{const C=k=>{P.current&&!P.current.contains(k.target)&&S(!1)};return x&&document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[x]);const d=C=>{C.stopPropagation(),r(C.target.checked)},b=()=>{n()},j=C=>{C.stopPropagation(),s()},w=C=>{C.stopPropagation(),a()},v=C=>{C.stopPropagation(),i()},h=C=>{C.stopPropagation(),S(!x)},_=C=>{C.stopPropagation(),S(!1),c==null||c()},O=C=>{C.stopPropagation(),S(!1),l==null||l()};return o.jsxs("div",{ref:I,className:`relative group rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 transition-all duration-200 ${e?"ring-2 ring-blue-500":""}`,children:[o.jsx("div",{className:"absolute top-2 left-2 z-10",children:o.jsx("input",{type:"checkbox",checked:e,onChange:d,className:"w-5 h-5 cursor-pointer accent-blue-500","aria-label":`选择 ${t.name}`})}),o.jsx("div",{className:"aspect-square cursor-pointer overflow-hidden",onClick:b,children:g?o.jsx("img",{src:t.thumbnailUrl||t.fullUrl,alt:t.name,className:`w-full h-full object-cover transition-all duration-300 ${u?"opacity-100":"opacity-0"} group-hover:scale-105`,onLoad:()=>f(!0),loading:"lazy"}):o.jsx("div",{className:"w-full h-full flex items-center justify-center",children:o.jsx("div",{className:"animate-pulse bg-gray-200 dark:bg-gray-700 w-full h-full"})})}),o.jsxs("div",{className:"p-2 bg-white dark:bg-gray-900",children:[o.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 truncate mb-2",title:t.name,children:t.name}),o.jsxs("div",{className:"flex items-center justify-around gap-2",children:[o.jsx("button",{onClick:j,className:"flex-1 flex items-center justify-center p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"下载图片",title:"下载",children:o.jsx("svg",{className:"w-5 h-5 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),o.jsx("button",{onClick:w,className:"flex-1 flex items-center justify-center p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"复制路径",title:"复制路径",children:o.jsx("svg",{className:"w-5 h-5 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),o.jsx("button",{onClick:v,className:"flex-1 flex items-center justify-center p-2 rounded hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors","aria-label":"删除图片",title:"删除",children:o.jsx("svg",{className:"w-5 h-5 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),o.jsxs("div",{className:"relative flex-1",ref:P,children:[o.jsx("button",{onClick:h,className:"w-full flex items-center justify-center p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"更多操作",title:"更多",children:o.jsx("svg",{className:"w-5 h-5 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),x&&o.jsxs("div",{className:"absolute bottom-full right-0 mb-1 w-32 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 z-10",children:[o.jsx("button",{onClick:_,className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-t-md",children:"重命名"}),o.jsx("button",{onClick:O,className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-b-md",children:"移动"})]})]})]})]})]})};function Ln(t){let e=t;for(;e;){if(e.dir)return e.dir==="rtl";e=e.parentElement}return!1}function Dn(t,e){const[r,n]=m.useState(e==="rtl");return m.useLayoutEffect(()=>{t&&(e||n(Ln(t)))},[e,t]),r}const Te=typeof window<"u"?m.useLayoutEffect:m.useEffect;function Kt(t){if(t!==void 0)switch(typeof t){case"number":return t;case"string":{if(t.endsWith("px"))return parseFloat(t);break}}}function Tn({box:t,defaultHeight:e,defaultWidth:r,disabled:n,element:s,mode:a,style:i}){const{styleHeight:c,styleWidth:l}=m.useMemo(()=>({styleHeight:Kt(i==null?void 0:i.height),styleWidth:Kt(i==null?void 0:i.width)}),[i==null?void 0:i.height,i==null?void 0:i.width]),[u,f]=m.useState({height:e,width:r}),g=n||a==="only-height"&&c!==void 0||a==="only-width"&&l!==void 0||c!==void 0&&l!==void 0;return Te(()=>{if(s===null||g)return;const p=new ResizeObserver(x=>{for(const S of x){const{contentRect:I,target:P}=S;s===P&&f(d=>d.height===I.height&&d.width===I.width?d:{height:I.height,width:I.width})}});return p.observe(s,{box:t}),()=>{p==null||p.unobserve(s)}},[t,g,s,c,l]),m.useMemo(()=>({height:c!=null?c:u.height,width:l!=null?l:u.width}),[u,c,l])}function Bn(t){const e=m.useRef(()=>{throw new Error("Cannot call during render.")});return Te(()=>{e.current=t},[t]),m.useCallback(r=>{var n;return(n=e.current)==null?void 0:n.call(e,r)},[e])}let he=null;function Vn(t=!1){if(he===null||t){const e=document.createElement("div"),r=e.style;r.width="50px",r.height="50px",r.overflow="scroll",r.direction="rtl";const n=document.createElement("div"),s=n.style;return s.width="100px",s.height="100px",e.appendChild(n),document.body.appendChild(e),e.scrollLeft>0?he="positive-descending":(e.scrollLeft=1,e.scrollLeft===0?he="negative":he="positive-ascending"),document.body.removeChild(e),he}return he}function rt({containerElement:t,direction:e,isRtl:r,scrollOffset:n}){if(e==="horizontal"&&r)switch(Vn()){case"negative":return-n;case"positive-descending":{if(t){const{clientWidth:s,scrollLeft:a,scrollWidth:i}=t;return i-s-a}break}}return n}function oe(t,e="Assertion error"){if(!t)throw console.error(e),Error(e)}function Ne(t,e){if(t===e)return!0;if(!!t!=!!e||(oe(t!==void 0),oe(e!==void 0),Object.keys(t).length!==Object.keys(e).length))return!1;for(const r in t)if(!Object.is(e[r],t[r]))return!1;return!0}function ar({cachedBounds:t,itemCount:e,itemSize:r}){if(e===0)return 0;if(typeof r=="number")return e*r;{const n=t.get(t.size===0?0:t.size-1);oe(n!==void 0,"Unexpected bounds cache miss");const s=(n.scrollOffset+n.size)/t.size;return e*s}}function Un({align:t,cachedBounds:e,index:r,itemCount:n,itemSize:s,containerScrollOffset:a,containerSize:i}){if(r<0||r>=n)throw RangeError(`Invalid index specified: ${r}`,{cause:`Index ${r} is not within the range of 0 - ${n-1}`});const c=ar({cachedBounds:e,itemCount:n,itemSize:s}),l=e.get(r),u=Math.max(0,Math.min(c-i,l.scrollOffset)),f=Math.max(0,l.scrollOffset-i+l.size);switch(t==="smart"&&(a>=f&&a<=u?t="auto":t="center"),t){case"start":return u;case"end":return f;case"center":return l.scrollOffset<=i/2?0:l.scrollOffset+l.size/2>=c-i/2?c-i:l.scrollOffset+l.size/2-i/2;case"auto":default:return a>=f&&a<=u?a:a<f?f:u}}function Wt({cachedBounds:t,containerScrollOffset:e,containerSize:r,itemCount:n,overscanCount:s}){const a=n-1;let i=0,c=-1,l=0,u=-1,f=0;for(;f<a;){const g=t.get(f);if(g.scrollOffset+g.size>e)break;f++}for(i=f,l=Math.max(0,i-s);f<a;){const g=t.get(f);if(g.scrollOffset+g.size>=e+r)break;f++}return c=Math.min(a,f),u=Math.min(n-1,c+s),i<0&&(i=0,c=-1,l=0,u=-1),{startIndexVisible:i,stopIndexVisible:c,startIndexOverscan:l,stopIndexOverscan:u}}function Fn({itemCount:t,itemProps:e,itemSize:r}){const n=new Map;return{get(s){for(oe(s<t,`Invalid index ${s}`);n.size-1<s;){const i=n.size;let c;switch(typeof r){case"function":{c=r(i,e);break}case"number":{c=r;break}}if(i===0)n.set(i,{size:c,scrollOffset:0});else{const l=n.get(i-1);oe(l!==void 0,`Unexpected bounds cache miss for index ${s}`),n.set(i,{scrollOffset:l.scrollOffset+l.size,size:c})}}const a=n.get(s);return oe(a!==void 0,`Unexpected bounds cache miss for index ${s}`),a},set(s,a){n.set(s,a)},get size(){return n.size}}}function An({itemCount:t,itemProps:e,itemSize:r}){return m.useMemo(()=>Fn({itemCount:t,itemProps:e,itemSize:r}),[t,e,r])}function qn({containerSize:t,itemSize:e}){let r;switch(typeof e){case"string":{oe(e.endsWith("%"),`Invalid item size: "${e}"; string values must be percentages (e.g. "100%")`),oe(t!==void 0,"Container size must be defined if a percentage item size is specified"),r=t*parseInt(e)/100;break}default:{r=e;break}}return r}function Ht({containerElement:t,containerStyle:e,defaultContainerSize:r=0,direction:n,isRtl:s=!1,itemCount:a,itemProps:i,itemSize:c,onResize:l,overscanCount:u}){const[f,g]=m.useState({startIndexVisible:0,startIndexOverscan:0,stopIndexVisible:-1,stopIndexOverscan:-1}),{startIndexVisible:p,startIndexOverscan:x,stopIndexVisible:S,stopIndexOverscan:I}={startIndexVisible:Math.min(a-1,f.startIndexVisible),startIndexOverscan:Math.min(a-1,f.startIndexOverscan),stopIndexVisible:Math.min(a-1,f.stopIndexVisible),stopIndexOverscan:Math.min(a-1,f.stopIndexOverscan)},{height:P=r,width:d=r}=Tn({defaultHeight:n==="vertical"?r:void 0,defaultWidth:n==="horizontal"?r:void 0,element:t,mode:n==="vertical"?"only-height":"only-width",style:e}),b=m.useRef({height:0,width:0}),j=n==="vertical"?P:d,w=qn({containerSize:j,itemSize:c});m.useLayoutEffect(()=>{if(typeof l=="function"){const k=b.current;(k.height!==P||k.width!==d)&&(l({height:P,width:d},W({},k)),k.height=P,k.width=d)}},[P,l,d]);const v=An({itemCount:a,itemProps:i,itemSize:w}),h=m.useCallback(k=>v.get(k),[v]),_=m.useCallback(()=>ar({cachedBounds:v,itemCount:a,itemSize:w}),[v,a,w]),O=m.useCallback(k=>{const E=rt({containerElement:t,direction:n,isRtl:s,scrollOffset:k});return Wt({cachedBounds:v,containerScrollOffset:E,containerSize:j,itemCount:a,overscanCount:u})},[v,t,j,n,s,a,u]);Te(()=>{var E;const k=(E=n==="vertical"?t==null?void 0:t.scrollTop:t==null?void 0:t.scrollLeft)!=null?E:0;g(O(k))},[t,n,O]),Te(()=>{if(!t)return;const k=()=>{g(E=>{const{scrollLeft:J,scrollTop:R}=t,A=rt({containerElement:t,direction:n,isRtl:s,scrollOffset:n==="vertical"?R:J}),T=Wt({cachedBounds:v,containerScrollOffset:A,containerSize:j,itemCount:a,overscanCount:u});return Ne(T,E)?E:T})};return t.addEventListener("scroll",k),()=>{t.removeEventListener("scroll",k)}},[v,t,j,n,a,u]);const C=Bn(({align:k="auto",containerScrollOffset:E,index:J})=>{let R=Un({align:k,cachedBounds:v,containerScrollOffset:E,containerSize:j,index:J,itemCount:a,itemSize:w});if(t){if(R=rt({containerElement:t,direction:n,isRtl:s,scrollOffset:R}),typeof t.scrollTo!="function"){const A=O(R);Ne(f,A)||g(A)}return R}});return{getCellBounds:h,getEstimatedSize:_,scrollToIndex:C,startIndexOverscan:x,startIndexVisible:p,stopIndexOverscan:I,stopIndexVisible:S}}function Kn(t){return m.useMemo(()=>t,Object.values(t))}function Wn(t,e){const l=t,{ariaAttributes:r,style:n}=l,s=Ee(l,["ariaAttributes","style"]),u=e,{ariaAttributes:a,style:i}=u,c=Ee(u,["ariaAttributes","style"]);return Ne(r,a)&&Ne(n,i)&&Ne(s,c)}function Hn(b){var j=b,{cellComponent:t,cellProps:e,children:r,className:n,columnCount:s,columnWidth:a,defaultHeight:i=0,defaultWidth:c=0,dir:l,gridRef:u,onCellsRendered:f,onResize:g,overscanCount:p=3,rowCount:x,rowHeight:S,style:I,tagName:P="div"}=j,d=Ee(j,["cellComponent","cellProps","children","className","columnCount","columnWidth","defaultHeight","defaultWidth","dir","gridRef","onCellsRendered","onResize","overscanCount","rowCount","rowHeight","style","tagName"]);const w=Kn(e),v=m.useMemo(()=>m.memo(t,Wn),[t]),[h,_]=m.useState(null),O=Dn(h,l),{getCellBounds:C,getEstimatedSize:k,startIndexOverscan:E,startIndexVisible:J,scrollToIndex:R,stopIndexOverscan:A,stopIndexVisible:T}=Ht({containerElement:h,containerStyle:I,defaultContainerSize:c,direction:"horizontal",isRtl:O,itemCount:s,itemProps:w,itemSize:a,onResize:g,overscanCount:p}),{getCellBounds:Q,getEstimatedSize:V,startIndexOverscan:H,startIndexVisible:$,scrollToIndex:z,stopIndexOverscan:K,stopIndexVisible:xe}=Ht({containerElement:h,containerStyle:I,defaultContainerSize:i,direction:"vertical",itemCount:x,itemProps:w,itemSize:S,onResize:g,overscanCount:p});m.useImperativeHandle(u,()=>({get element(){return h},scrollToCell({behavior:X="auto",columnAlign:q="auto",columnIndex:ee,rowAlign:te="auto",rowIndex:U}){var ht,ft;const ye=R({align:q,containerScrollOffset:(ht=h==null?void 0:h.scrollLeft)!=null?ht:0,index:ee}),cr=z({align:te,containerScrollOffset:(ft=h==null?void 0:h.scrollTop)!=null?ft:0,index:U});typeof(h==null?void 0:h.scrollTo)=="function"&&h.scrollTo({behavior:X,left:ye,top:cr})},scrollToColumn({align:X="auto",behavior:q="auto",index:ee}){var U;const te=R({align:X,containerScrollOffset:(U=h==null?void 0:h.scrollLeft)!=null?U:0,index:ee});typeof(h==null?void 0:h.scrollTo)=="function"&&h.scrollTo({behavior:q,left:te})},scrollToRow({align:X="auto",behavior:q="auto",index:ee}){var U;const te=z({align:X,containerScrollOffset:(U=h==null?void 0:h.scrollTop)!=null?U:0,index:ee});typeof(h==null?void 0:h.scrollTo)=="function"&&h.scrollTo({behavior:q,top:te})}}),[h,R,z]),m.useEffect(()=>{E>=0&&A>=0&&H>=0&&K>=0&&f&&f({columnStartIndex:J,columnStopIndex:T,rowStartIndex:$,rowStopIndex:xe},{columnStartIndex:E,columnStopIndex:A,rowStartIndex:H,rowStopIndex:K})},[f,E,J,A,T,H,$,K,xe]);const ir=m.useMemo(()=>{const X=[];if(s>0&&x>0)for(let q=H;q<=K;q++){const ee=Q(q),te=[];for(let U=E;U<=A;U++){const ye=C(U);te.push(m.createElement(v,re(W({},w),{ariaAttributes:{"aria-colindex":U+1,role:"gridcell"},columnIndex:U,key:U,rowIndex:q,style:{position:"absolute",left:O?void 0:0,right:O?0:void 0,transform:`translate(${O?-ye.scrollOffset:ye.scrollOffset}px, ${ee.scrollOffset}px)`,height:ee.size,width:ye.size}})))}X.push(o.jsx("div",{role:"row","aria-rowindex":q+1,children:te},q))}return X},[v,w,s,E,A,C,Q,O,x,H,K]),lr=o.jsx("div",{"aria-hidden":!0,style:{height:V(),width:k(),zIndex:-1}});return m.createElement(P,re(W({"aria-colcount":s,"aria-rowcount":x,role:"grid"},d),{className:n,dir:l,ref:_,style:W({position:"relative",width:"100%",height:"100%",maxHeight:"100%",maxWidth:"100%",flexGrow:1,overflow:"auto"},I)}),ir,r,lr)}const Yn=({items:t,loading:e,onItemClick:r,onFolderClick:n,selectedItems:s,onSelectionChange:a,onDownload:i,onCopyUrl:c,onDelete:l,onRename:u,onMove:f})=>{const{columnCount:g,columnWidth:p,rowHeight:x}=m.useMemo(()=>{const d=window.innerWidth-32,b=200,j=300,w=16;let v=Math.floor((d+w)/(b+w));v=Math.max(1,Math.min(v,6));const h=Math.min(j,Math.floor((d-w*(v-1))/v));return{columnCount:v,columnWidth:h+w,rowHeight:h+120}},[]),S=d=>{n(d)},I=d=>{r(d)};if(e)return o.jsx("div",{className:"flex items-center justify-center h-64",children:o.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"加载中..."})});if(t.length===0)return o.jsx("div",{className:"flex items-center justify-center h-64",children:o.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"暂无内容"})});if(t.length>100){const d=Math.ceil(t.length/g);return o.jsx("div",{className:"w-full h-full",children:o.jsx(Hn,{columnCount:g,columnWidth:p,rowCount:d,rowHeight:x,style:{height:window.innerHeight-200,width:window.innerWidth-32},className:"px-4",cellComponent:({columnIndex:b,rowIndex:j,style:w})=>{const v=j*g+b;if(v>=t.length)return o.jsx("div",{style:w});const h=t[v],_=s.has(h.key);return h.type==="folder"?o.jsx("div",{style:w,className:"p-2",children:o.jsxs("div",{className:"h-full rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer transition-colors flex flex-col items-center justify-center p-4",onClick:()=>S(h.key),children:[o.jsx("svg",{className:"w-16 h-16 text-blue-500 dark:text-blue-400 mb-2",fill:"currentColor",viewBox:"0 0 20 20",children:o.jsx("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})}),o.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 text-center truncate w-full",children:h.name})]})}):o.jsx("div",{style:w,className:"p-2",children:o.jsx(qt,{item:h,selected:_,onSelect:O=>a(h.key,O),onClick:()=>I(h),onDownload:()=>i==null?void 0:i(h),onCopyUrl:()=>c==null?void 0:c(h),onDelete:()=>l==null?void 0:l(h),onRename:()=>u==null?void 0:u(h),onMove:()=>f==null?void 0:f(h)})})},cellProps:{}})})}return o.jsx("div",{className:"w-full px-4 py-4",children:o.jsx("div",{className:"grid gap-4",style:{gridTemplateColumns:`repeat(${g}, 1fr)`},children:t.map(d=>{const b=s.has(d.key);return d.type==="folder"?o.jsxs("div",{className:"rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer transition-colors flex flex-col items-center justify-center p-8",onClick:()=>S(d.key),style:{aspectRatio:"1"},children:[o.jsx("svg",{className:"w-16 h-16 text-blue-500 dark:text-blue-400 mb-2",fill:"currentColor",viewBox:"0 0 20 20",children:o.jsx("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})}),o.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 text-center truncate w-full",children:d.name})]},d.key):o.jsx(qt,{item:d,selected:b,onSelect:j=>a(d.key,j),onClick:()=>I(d),onDownload:()=>i==null?void 0:i(d),onCopyUrl:()=>c==null?void 0:c(d),onDelete:()=>l==null?void 0:l(d),onRename:()=>u==null?void 0:u(d),onMove:()=>f==null?void 0:f(d)},d.key)})})})},Gn=()=>{const{items:t,loading:e,loadItems:r,refreshItems:n}=pe(),{currentPath:s,navigate:a}=Me(),{selectedItems:i,toggleSelection:c,clearSelection:l}=tr(),{showViewer:u,showRenameModal:f,showMoveModal:g}=D();m.useEffect(()=>{r(s),l()},[s,r,l]);const p=()=>{const h=s.split("/").filter(Boolean);h.pop();const _=h.length>0?h.join("/")+"/":"";a(_)},x=m.useMemo(()=>!s||s===""||s==="/"?t:[{type:"folder",key:"__back__",name:".."},...t],[s,t]),S=h=>{h==="__back__"?p():a(h)},I=h=>{if(h.type==="image"){const O=x.filter(C=>C.type==="image").findIndex(C=>C.key===h.key);O!==-1&&u(O)}},P=h=>{h!=="__back__"&&c(h)},d=h=>y(null,null,function*(){if(h.fullUrl)try{yield ut.downloadImages([h.fullUrl],[h.name]),N.success("下载成功")}catch(_){console.error("下载失败:",_),N.error("下载失败，请重试")}}),b=h=>y(null,null,function*(){if(h.fullUrl)try{yield navigator.clipboard.writeText(h.fullUrl),N.success("已复制到剪贴板")}catch(_){console.error("复制失败:",_),N.error("复制失败，请重试")}}),j=h=>{or({title:"确认删除",content:`确定要删除 "${h.name}" 吗？此操作无法撤销。`,okText:"删除",cancelText:"取消",okType:"danger",onOk:()=>y(null,null,function*(){const _=G();if(!_){N.error("请先配置S3连接信息");return}try{yield _.deleteObject(h.key),N.success("删除成功"),yield Z.clearPath(s),yield n()}catch(O){throw console.error("删除失败:",O),N.error(O instanceof Error?O.message:"删除失败，请重试"),O}})})},w=h=>{f({key:h.key,name:h.name})},v=h=>{g({key:h.key,name:h.name})};return o.jsx(Yn,{items:x,loading:e,onItemClick:I,onFolderClick:S,selectedItems:i,onSelectionChange:P,onDownload:d,onCopyUrl:b,onDelete:j,onRename:w,onMove:v})},Zn=()=>{const{viewerVisible:t,currentImageIndex:e,hideViewer:r,setCurrentImageIndex:n}=D(),{items:s}=pe(),a=m.useMemo(()=>s.filter(c=>c.type==="image"),[s]);if(m.useEffect(()=>{if(!t||a.length===0)return;const c=l=>{switch(l.key){case"ArrowLeft":l.preventDefault(),e>0&&n(e-1);break;case"ArrowRight":l.preventDefault(),e<a.length-1&&n(e+1);break;case"Escape":l.preventDefault(),r();break}};return document.addEventListener("keydown",c),()=>{document.removeEventListener("keydown",c)}},[t,e,a.length,n,r]),!t||a.length===0)return null;const i=a[e];return i?o.jsxs("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-90 flex items-center justify-center",onClick:r,children:[o.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors z-10",onClick:r,"aria-label":"关闭",children:o.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e>0&&o.jsx("button",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 transition-colors z-10",onClick:c=>{c.stopPropagation(),n(e-1)},"aria-label":"上一张",children:o.jsx("svg",{className:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e<a.length-1&&o.jsx("button",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 transition-colors z-10",onClick:c=>{c.stopPropagation(),n(e+1)},"aria-label":"下一张",children:o.jsx("svg",{className:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),o.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white text-center z-10",children:[o.jsx("div",{className:"text-sm mb-1",children:i.name}),o.jsxs("div",{className:"text-xs text-gray-400",children:[e+1," / ",a.length]})]}),o.jsx("div",{className:"relative max-w-[90vw] max-h-[90vh] flex items-center justify-center",onClick:c=>c.stopPropagation(),children:o.jsx("img",{src:i.fullUrl||i.thumbnailUrl||"",alt:i.name,className:"max-w-full max-h-[90vh] object-contain",loading:"lazy"})})]}):null};function Jn(){const[t]=L.useForm(),[e,r]=m.useState(!1),[n,s]=m.useState(null),a=D(d=>d.settingsModalVisible),i=D(d=>d.hideSettingsModal),c=Pe(d=>d.config),l=Pe(d=>d.saveConfigToStorage),f=D(d=>d.theme)==="dark",g=()=>{c&&t.setFieldsValue(c)},p=()=>y(null,null,function*(){try{yield t.validateFields();const d=t.getFieldsValue();r(!0),s(null);const{S3Service:b}=yield Oe(()=>y(null,null,function*(){const{S3Service:v}=yield Promise.resolve().then(()=>er);return{S3Service:v}}),void 0),j=new b(d),w=yield j.testConnection();j.destroy(),w?(s("success"),M.success("连接测试成功！")):(s("error"),M.error("连接测试失败，请检查配置"))}catch(d){s("error"),d instanceof Error?M.error(`连接测试失败: ${d.message}`):M.error("连接测试失败，请检查配置")}finally{r(!1)}}),x=()=>{try{const d=ce.exportConfig(),b=new Blob([d],{type:"application/json"}),j=URL.createObjectURL(b),w=document.createElement("a");w.href=j,w.download=`s3-config-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(j),M.success("配置已导出")}catch(d){d instanceof Error?M.error(d.message):M.error("导出配置失败")}},S=d=>{const b=new FileReader;return b.onload=j=>{var w;try{const v=(w=j.target)==null?void 0:w.result,h=ce.importConfig(v);t.setFieldsValue(h),M.success("配置已导入，请检查并保存")}catch(v){v instanceof Error?M.error(v.message):M.error("导入配置失败")}},b.readAsText(d),!1},I=()=>y(null,null,function*(){try{const d=yield t.validateFields();l(d),M.success("配置已保存"),i()}catch(d){M.error("请填写所有必填字段")}}),P=()=>{s(null),i()};return o.jsx(dt,{title:"S3配置设置",open:a,onCancel:P,afterOpenChange:d=>d&&g(),width:600,footer:[o.jsx(F,{onClick:P,children:"取消"},"cancel"),o.jsx(F,{type:"primary",onClick:I,children:"保存配置"},"save")],className:f?"dark-modal":"",children:o.jsxs(L,{form:t,layout:"vertical",autoComplete:"off",className:"mt-4",children:[o.jsx(L.Item,{label:"Access Key ID",name:"accessKeyId",rules:[{required:!0,message:"请输入Access Key ID"},{min:16,message:"Access Key ID长度至少16个字符"}],children:o.jsx(ie,{placeholder:"请输入Access Key ID"})}),o.jsx(L.Item,{label:"Secret Access Key",name:"secretAccessKey",rules:[{required:!0,message:"请输入Secret Access Key"},{min:32,message:"Secret Access Key长度至少32个字符"}],children:o.jsx(ie.Password,{placeholder:"请输入Secret Access Key"})}),o.jsx(L.Item,{label:"Region",name:"region",rules:[{required:!0,message:"请输入Region"}],tooltip:"例如: us-east-1, auto",children:o.jsx(ie,{placeholder:"例如: us-east-1, auto"})}),o.jsx(L.Item,{label:"Endpoint",name:"endpoint",rules:[{required:!0,message:"请输入Endpoint"},{pattern:/^https?:\/\/.+/,message:"Endpoint必须以http://或https://开头"}],tooltip:"例如: https://s3.amazonaws.com 或 https://your-account.r2.cloudflarestorage.com",children:o.jsx(ie,{placeholder:"https://your-endpoint.com"})}),o.jsx(L.Item,{label:"Bucket",name:"bucket",rules:[{required:!0,message:"请输入Bucket名称"},{pattern:/^[a-z0-9][a-z0-9-]*[a-z0-9]$/,message:"Bucket名称只能包含小写字母、数字和连字符"}],children:o.jsx(ie,{placeholder:"your-bucket-name"})}),o.jsx(L.Item,{label:"自定义域名（可选）",name:"customDomain",tooltip:"如果配置了自定义域名，将使用该域名生成图片URL",rules:[{pattern:/^https?:\/\/.+/,message:"自定义域名必须以http://或https://开头"}],children:o.jsx(ie,{placeholder:"https://your-custom-domain.com"})}),o.jsx(L.Item,{children:o.jsxs(nt,{className:"w-full",direction:"vertical",children:[o.jsx(F,{block:!0,icon:e?o.jsx(yr,{}):n==="success"?o.jsx(Qr,{}):void 0,onClick:p,loading:e,type:n==="success"?"primary":"default",danger:n==="error",children:e?"测试中...":n==="success"?"连接成功":n==="error"?"连接失败":"测试连接"}),o.jsxs(nt,{className:"w-full",children:[o.jsx(F,{icon:o.jsx(br,{}),onClick:x,disabled:!c,className:"flex-1",children:"导出配置"}),o.jsx(Yt,{accept:".json",showUploadList:!1,beforeUpload:S,className:"flex-1",children:o.jsx(F,{icon:o.jsx(st,{}),className:"w-full",children:"导入配置"})})]})]})})]})})}function Qn(){return o.jsx(Jn,{})}function Xn(t,e=new Date){const r=e.getFullYear().toString(),n=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0");return t.replace(/\{year\}/gi,r).replace(/\{month\}/gi,n).replace(/\{day\}/gi,s)}function Le(t){if(!t)return"";let e=t.replace(/\/+/g,"/");return e=e.replace(/^\/+/,""),e.length>0&&(e=e.replace(/\/+$/,"")),e}function es(t,e){return Le(t?e?`${t}/${e}`:t:e)}const{Dragger:ts}=Yt;function rs(){const[t]=L.useForm(),[e,r]=m.useState([]),[n,s]=m.useState(!1),[a,i]=m.useState([]),c=D(d=>d.uploadModalVisible),l=D(d=>d.hideUploadModal),u=Me(d=>d.currentPath),g=D(d=>d.theme)==="dark";m.useEffect(()=>{c&&(t.setFieldsValue({format:"original",targetPath:"current",customPath:"",nameStrategy:"original"}),r([]),i([]))},[c,t]);const p=d=>{const b=d.fileList.map(j=>j.originFileObj).filter(Boolean);return r(b),!1},x=()=>y(null,null,function*(){if(e.length===0){M.warning("请先选择要上传的文件");return}try{yield t.validateFields();const d=t.getFieldsValue(),b={files:e,format:d.format,targetPath:d.targetPath,customPath:d.customPath,nameStrategy:d.nameStrategy};s(!0);const j=e.map(w=>({fileName:w.name,progress:0,status:"pending"}));i(j),yield S(b),M.success("所有文件上传完成！"),setTimeout(()=>{l()},1e3)}catch(d){d instanceof Error?M.error(`上传失败: ${d.message}`):M.error("上传失败，请重试")}finally{s(!1)}}),S=d=>y(null,null,function*(){const{imageService:b}=yield Oe(()=>y(null,null,function*(){const{imageService:k}=yield Promise.resolve().then(()=>Rn);return{imageService:k}}),void 0),{getS3Service:j}=yield Oe(()=>y(null,null,function*(){const{getS3Service:k}=yield Promise.resolve().then(()=>er);return{getS3Service:k}}),void 0),{cacheService:w}=yield Oe(()=>y(null,null,function*(){const{cacheService:k}=yield Promise.resolve().then(()=>Mn);return{cacheService:k}}),void 0),v=j();if(!v)throw new Error("S3服务未初始化，请先配置S3连接");let h=u;d.targetPath==="custom"&&d.customPath&&(h=Xn(d.customPath)),h=Le(h);const _=3,O=[];for(let k=0;k<d.files.length;k+=_){const J=d.files.slice(k,k+_).map((R,A)=>y(null,null,function*(){const T=k+A;try{i($=>{const z=[...$];return z[T]=re(W({},z[T]),{status:"uploading",progress:10}),z});let Q=R,V=R.name;if(d.format==="webp"&&!R.type.includes("webp")){i(z=>{const K=[...z];return K[T].progress=30,K}),Q=yield b.convertToWebP(R);const $=V.lastIndexOf(".");$!==-1?V=V.substring(0,$)+".webp":V=V+".webp"}if(d.nameStrategy==="md5"){i(K=>{const xe=[...K];return xe[T].progress=50,xe});const $=yield b.calculateMD5(R),z=V.split(".").pop();V=z?`${$}.${z}`:$}const H=h?es(h,V):V;i($=>{const z=[...$];return z[T].progress=70,z}),yield v.uploadObject(H,Q),i($=>{const z=[...$];return z[T]=re(W({},z[T]),{status:"success",progress:100}),z}),O.push({success:!0,fileName:R.name})}catch(Q){const V=Q instanceof Error?Q.message:"未知错误";i(H=>{const $=[...H];return $[T]=re(W({},$[T]),{status:"error",progress:0,error:V}),$}),O.push({success:!1,fileName:R.name,error:V})}}));yield Promise.all(J)}if(yield w.clearPath(h),u===h){const{useGalleryStore:k}=yield Oe(()=>y(null,null,function*(){const{useGalleryStore:E}=yield Promise.resolve().then(()=>_n);return{useGalleryStore:E}}),void 0);yield k.getState().refreshItems()}const C=O.filter(k=>!k.success);if(C.length>0)throw new Error(`${C.length} 个文件上传失败`)}),I=()=>{if(n){M.warning("上传进行中，请等待完成");return}l()},P=L.useWatch("targetPath",t);return o.jsx(dt,{title:"上传图片",open:c,onCancel:I,width:600,footer:[o.jsx(F,{onClick:I,disabled:n,children:"取消"},"cancel"),o.jsx(F,{type:"primary",onClick:x,loading:n,disabled:e.length===0,children:n?"上传中...":"开始上传"},"upload")],className:g?"dark-modal":"",closable:!n,maskClosable:!n,children:o.jsxs(L,{form:t,layout:"vertical",className:"mt-4",children:[o.jsx(L.Item,{label:"选择文件",children:o.jsxs(ts,{multiple:!0,accept:"image/*",fileList:e.map((d,b)=>({uid:`${b}`,name:d.name,status:"done"})),onChange:p,beforeUpload:()=>!1,disabled:n,children:[o.jsx("p",{className:"ant-upload-drag-icon",children:o.jsx(tn,{})}),o.jsx("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"}),o.jsx("p",{className:"ant-upload-hint",children:"支持单个或批量上传图片文件"})]})}),o.jsx(L.Item,{label:"图片格式",name:"format",tooltip:"选择WebP可以减小文件大小，提高加载速度",children:o.jsxs(Y.Group,{disabled:n,children:[o.jsx(Y,{value:"original",children:"保持原格式"}),o.jsx(Y,{value:"webp",children:"转换为WebP"})]})}),o.jsx(L.Item,{label:"上传路径",name:"targetPath",children:o.jsx(Y.Group,{disabled:n,children:o.jsxs(nt,{direction:"vertical",children:[o.jsxs(Y,{value:"current",children:["当前目录 ",u?`(${u})`:"(根目录)"]}),o.jsx(Y,{value:"custom",children:"自定义路径"})]})})}),P==="custom"&&o.jsx(L.Item,{name:"customPath",rules:[{required:!0,message:"请输入自定义路径"}],tooltip:"支持变量: {year}, {month}, {day}",children:o.jsx(ie,{placeholder:"例如: images/{year}/{month}/{day}",disabled:n})}),o.jsx(L.Item,{label:"文件名策略",name:"nameStrategy",tooltip:"使用MD5可以避免文件名冲突，并且文件名长度固定为16个字符",children:o.jsxs(Y.Group,{disabled:n,children:[o.jsx(Y,{value:"original",children:"保留原文件名"}),o.jsx(Y,{value:"md5",children:"使用MD5命名"})]})}),a.length>0&&o.jsxs("div",{className:"mt-4 space-y-2",children:[o.jsx("div",{className:"font-medium",children:"上传进度："}),a.map((d,b)=>o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsx("span",{className:"truncate flex-1",children:d.fileName}),o.jsxs("span",{className:"ml-2",children:[d.status==="pending"&&"等待中",d.status==="uploading"&&`${d.progress}%`,d.status==="success"&&"✓ 完成",d.status==="error"&&"✗ 失败"]})]}),o.jsx(vr,{percent:d.progress,status:d.status==="error"?"exception":d.status==="success"?"success":"active",showInfo:!1,size:"small"}),d.error&&o.jsx("div",{className:"text-xs text-red-500",children:d.error})]},b))]})]})})}function ns(){return o.jsx(rs,{})}const ss=({visible:t,currentName:e,onClose:r,onRename:n})=>{const[s,a]=m.useState(""),[i,c]=m.useState(!1),[l,u]=m.useState(null);m.useEffect(()=>{t&&(a(e),u(null))},[t,e]);const f=p=>y(null,null,function*(){if(p.preventDefault(),!s.trim()){u("文件名不能为空");return}if(s===e){u("新文件名与原文件名相同");return}if(/[<>:"/\\|?*]/.test(s)){u('文件名不能包含特殊字符: < > : " / \\ | ? *');return}c(!0),u(null);try{yield n(s),r()}catch(S){u(S instanceof Error?S.message:"重命名失败")}finally{c(!1)}}),g=()=>{i||r()};return t?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:g,children:o.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md mx-4",onClick:p=>p.stopPropagation(),children:[o.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:o.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"重命名文件"})}),o.jsxs("form",{onSubmit:f,children:[o.jsxs("div",{className:"px-6 py-4",children:[o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{htmlFor:"newName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"新文件名"}),o.jsx("input",{id:"newName",type:"text",value:s,onChange:p=>a(p.target.value),disabled:i,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white disabled:opacity-50",placeholder:"请输入新文件名",autoFocus:!0})]}),o.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:["原文件名: ",e]}),l&&o.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:l})]}),o.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3",children:[o.jsx("button",{type:"button",onClick:g,disabled:i,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"取消"}),o.jsx("button",{type:"submit",disabled:i,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:i?"重命名中...":"确认"})]})]})]})}):null},os=()=>{const{renameModalVisible:t,currentOperationItem:e,hideRenameModal:r}=D(),{refreshItems:n}=pe(),{currentPath:s}=Me(),a=i=>y(null,null,function*(){if(!e)return;const c=G();if(!c)throw new Error("请先配置S3连接信息");try{const l=e.key.split("/");l[l.length-1]=i;const u=l.join("/");yield c.renameObject(e.key,u),N.success("重命名成功"),yield Z.clearPath(s),yield n()}catch(l){throw console.error("重命名失败:",l),l}});return o.jsx(ss,{visible:t,currentName:(e==null?void 0:e.name)||"",onClose:r,onRename:a})},as=({visible:t,currentKey:e,currentPath:r,onClose:n,onMove:s})=>{const[a,i]=m.useState(""),[c,l]=m.useState(!1),[u,f]=m.useState(null),[g,p]=m.useState([]),[x,S]=m.useState(!1);m.useEffect(()=>{t&&(i(r),f(null),I())},[t,r]);const I=()=>y(null,null,function*(){const b=G();if(b){S(!0);try{const w=(yield b.listObjects("")).filter(v=>v.isFolder).map(v=>v.key);p(["",...w])}catch(j){console.error("加载文件夹列表失败:",j)}finally{S(!1)}}}),P=b=>y(null,null,function*(){b.preventDefault();const j=e.split("/").pop()||"";if((a?`${a}${j}`:j)===e){f("目标路径与当前路径相同");return}l(!0),f(null);try{yield s(a),n()}catch(v){f(v instanceof Error?v.message:"移动失败")}finally{l(!1)}}),d=()=>{c||n()};return t?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:d,children:o.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md mx-4",onClick:b=>b.stopPropagation(),children:[o.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:o.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"移动文件"})}),o.jsxs("form",{onSubmit:P,children:[o.jsxs("div",{className:"px-6 py-4",children:[o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{htmlFor:"targetPath",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"目标路径"}),x?o.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"加载文件夹列表..."}):o.jsxs("select",{id:"targetPath",value:a,onChange:b=>i(b.target.value),disabled:c,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white disabled:opacity-50",children:[o.jsx("option",{value:"",children:"根目录 (/)"}),g.slice(1).map(b=>o.jsx("option",{value:b,children:b},b))]})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"或输入自定义路径"}),o.jsx("input",{type:"text",value:a,onChange:b=>i(b.target.value),disabled:c,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white disabled:opacity-50",placeholder:"例如: images/2024/"}),o.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"路径应以 / 结尾，留空表示根目录"})]}),o.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:["当前位置: ",e]}),u&&o.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:u})]}),o.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3",children:[o.jsx("button",{type:"button",onClick:d,disabled:c,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"取消"}),o.jsx("button",{type:"submit",disabled:c,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:c?"移动中...":"确认"})]})]})]})}):null},is=()=>{const{moveModalVisible:t,currentOperationItem:e,hideMoveModal:r}=D(),{refreshItems:n}=pe(),{currentPath:s}=Me(),a=i=>y(null,null,function*(){if(!e)return;const c=G();if(!c)throw new Error("请先配置S3连接信息");try{const l=e.key.split("/").pop()||"",u=i?`${i}${l}`:l;yield c.moveObject(e.key,u),N.success("移动成功"),yield Z.clearPath(s),yield Z.clearPath(i),yield n()}catch(l){throw console.error("移动失败:",l),l}});return o.jsx(as,{visible:t,currentKey:(e==null?void 0:e.key)||"",currentPath:s,onClose:r,onMove:a})};class ls extends m.Component{constructor(r){super(r);ue(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,n){console.error("错误边界捕获到错误:",r,n),this.setState({error:r,errorInfo:n})}render(){return this.state.hasError?o.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:o.jsx(wr,{status:"error",title:"应用程序遇到错误",subTitle:"抱歉，应用程序遇到了一个意外错误。请尝试刷新页面。",extra:[o.jsx(F,{type:"primary",onClick:this.handleReset,children:"刷新页面"},"reload")],children:!1})}):this.props.children}}function cs(){const t=ne(r=>r.messages),e=ne(r=>r.removeMessage);return m.useEffect(()=>{t.forEach(r=>{const n=r.id;switch(r.type){case"success":M.success({content:r.content,key:n,duration:(r.duration||3e3)/1e3,onClose:()=>e(r.id)});break;case"error":M.error({content:r.content,key:n,duration:(r.duration||5e3)/1e3,onClose:()=>e(r.id)});break;case"info":M.info({content:r.content,key:n,duration:(r.duration||3e3)/1e3,onClose:()=>e(r.id)});break;case"warning":M.warning({content:r.content,key:n,duration:(r.duration||3e3)/1e3,onClose:()=>e(r.id)});break;case"loading":M.loading({content:r.content,key:n,duration:0});break}})},[t,e]),null}function ds(){const t=fe(a=>a.visible),e=fe(a=>a.options),r=fe(a=>a.loading),n=fe(a=>a.handleOk),s=fe(a=>a.handleCancel);return e?o.jsx(dt,{open:t,title:e.title,okText:e.okText||"确定",cancelText:e.cancelText||"取消",okButtonProps:{danger:e.okType==="danger",loading:r},onOk:n,onCancel:s,maskClosable:!r,closable:!r,children:e.content}):null}function us(){const t=De(r=>r.loading),e=De(r=>r.tip);return t?o.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black bg-opacity-30",children:o.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-8 shadow-xl",children:o.jsx(jr,{size:"large",tip:e})})}):null}function hs(){const t=D(i=>i.theme==="dark"),e=D(i=>i.loadThemeFromStorage),r=D(i=>i.showSettingsModal),n=Pe(i=>i.config),s=Pe(i=>i.isInitialized),a=Pe(i=>i.loadConfigFromStorage);return m.useEffect(()=>{e(),a()},[e,a]),m.useEffect(()=>{s&&!n&&r()},[s,n,r]),o.jsx(kr,{locale:Kr,theme:{algorithm:t?xt.darkAlgorithm:xt.defaultAlgorithm},children:o.jsxs("div",{className:`min-h-screen ${t?"dark bg-gray-900":"bg-gray-50"}`,children:[o.jsx(fn,{}),o.jsx($n,{}),o.jsx(Gn,{}),o.jsx(Zn,{}),o.jsx(Qn,{}),o.jsx(ns,{}),o.jsx(os,{}),o.jsx(is,{}),o.jsx(cs,{}),o.jsx(ds,{}),o.jsx(us,{})]})})}zr.createRoot(document.getElementById("root")).render(o.jsx(m.StrictMode,{children:o.jsx(ls,{children:o.jsx(hs,{})})}))});export default fs();
