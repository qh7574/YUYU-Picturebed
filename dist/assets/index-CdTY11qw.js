var Bt=Object.defineProperty,Vt=Object.defineProperties;var Ft=Object.getOwnPropertyDescriptors;var Qe=Object.getOwnPropertySymbols;var At=Object.prototype.hasOwnProperty,qt=Object.prototype.propertyIsEnumerable;var Kt=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r);var Ne=(r,e,t)=>e in r?Bt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,X=(r,e)=>{for(var t in e||(e={}))At.call(e,t)&&Ne(r,t,e[t]);if(Qe)for(var t of Qe(e))qt.call(e,t)&&Ne(r,t,e[t]);return r},ee=(r,e)=>Vt(r,Ft(e));var Wt=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var te=(r,e,t)=>Ne(r,typeof e!="symbol"?e+"":e,t);var h=(r,e,t)=>new Promise((n,s)=>{var o=l=>{try{c(t.next(l))}catch(d){s(d)}},i=l=>{try{c(t.throw(l))}catch(d){s(d)}},c=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,i);c((t=t.apply(r,e)).next())}),ve=function(r,e){this[0]=r,this[1]=e},Xe=(r,e,t)=>{var n=(i,c,l,d)=>{try{var g=t[i](c),f=(c=g.value)instanceof ve,p=g.done;Promise.resolve(f?c[0]:c).then(y=>f?n(i==="return"?i:"next",c[1]?{done:y.done,value:y.value}:y,l,d):l({value:y,done:p})).catch(y=>n("throw",y,l,d))}catch(y){d(y)}},s=i=>o[i]=c=>new Promise((l,d)=>n(i,c,l,d)),o={};return t=t.apply(r,e),o[Kt("asyncIterator")]=()=>o,s("next"),s("throw"),s("return"),o};import{r as Ht,a as Yt,g as Gt}from"./vendor-DwRCIQB9.js";import{R as Z,r as m,I as ne,_ as ae,B as T,F as M,M as Ze,a as G,S as Ae,b as Zt,c as Jt,U as Pt,s as S,d as A,P as Qt,e as Xt,f as er,C as tr,t as et}from"./ui-DDoHI4_O.js";import{S as tt,L as rr,P as nr,D as ar,a as sr,C as or,H as ir,_ as ge}from"./aws-MgGeQvF_.js";var $n=Wt(O=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();var Me={exports:{}},ie={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rt;function lr(){if(rt)return ie;rt=1;var r=Ht(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function i(c,l,d){var g,f={},p=null,y=null;d!==void 0&&(p=""+d),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(y=l.ref);for(g in l)n.call(l,g)&&!o.hasOwnProperty(g)&&(f[g]=l[g]);if(c&&c.defaultProps)for(g in l=c.defaultProps,l)f[g]===void 0&&(f[g]=l[g]);return{$$typeof:e,type:c,key:p,ref:y,props:f,_owner:s.current}}return ie.Fragment=t,ie.jsx=i,ie.jsxs=i,ie}var nt;function cr(){return nt||(nt=1,Me.exports=lr()),Me.exports}var a=cr(),we={},at;function dr(){if(at)return we;at=1;var r=Yt();return we.createRoot=r.createRoot,we.hydrateRoot=r.hydrateRoot,we}var ur=dr(),le={},_e={exports:{}},st;function Se(){return st||(st=1,(function(r){function e(t){return t&&t.__esModule?t:{default:t}}r.exports=e,r.exports.__esModule=!0,r.exports.default=r.exports})(_e)),_e.exports}var ce={},ot;function hr(){if(ot)return ce;ot=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.default=void 0;var r={items_per_page:"条/页",jump_to:"跳至",jump_to_confirm:"确定",page:"页",prev_page:"上一页",next_page:"下一页",prev_5:"向前 5 页",next_5:"向后 5 页",prev_3:"向前 3 页",next_3:"向后 3 页",page_size:"页码"};return ce.default=r,ce}var de={},ue={},he={},Oe={exports:{}},Ee={exports:{}},Re={exports:{}},Le={exports:{}},it;function Nt(){return it||(it=1,(function(r){function e(t){"@babel/helpers - typeof";return r.exports=e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},r.exports.__esModule=!0,r.exports.default=r.exports,e(t)}r.exports=e,r.exports.__esModule=!0,r.exports.default=r.exports})(Le)),Le.exports}var $e={exports:{}},lt;function mr(){return lt||(lt=1,(function(r){var e=Nt().default;function t(n,s){if(e(n)!="object"||!n)return n;var o=n[Symbol.toPrimitive];if(o!==void 0){var i=o.call(n,s||"default");if(e(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(n)}r.exports=t,r.exports.__esModule=!0,r.exports.default=r.exports})($e)),$e.exports}var ct;function fr(){return ct||(ct=1,(function(r){var e=Nt().default,t=mr();function n(s){var o=t(s,"string");return e(o)=="symbol"?o:o+""}r.exports=n,r.exports.__esModule=!0,r.exports.default=r.exports})(Re)),Re.exports}var dt;function gr(){return dt||(dt=1,(function(r){var e=fr();function t(n,s,o){return(s=e(s))in n?Object.defineProperty(n,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[s]=o,n}r.exports=t,r.exports.__esModule=!0,r.exports.default=r.exports})(Ee)),Ee.exports}var ut;function pr(){return ut||(ut=1,(function(r){var e=gr();function t(s,o){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(s);o&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),i.push.apply(i,c)}return i}function n(s){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?arguments[o]:{};o%2?t(Object(i),!0).forEach(function(c){e(s,c,i[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach(function(c){Object.defineProperty(s,c,Object.getOwnPropertyDescriptor(i,c))})}return s}r.exports=n,r.exports.__esModule=!0,r.exports.default=r.exports})(Oe)),Oe.exports}var me={},ht;function yr(){return ht||(ht=1,Object.defineProperty(me,"__esModule",{value:!0}),me.commonLocale=void 0,me.commonLocale={yearFormat:"YYYY",dayFormat:"D",cellMeridiemFormat:"A",monthBeforeYear:!0}),me}var mt;function br(){if(mt)return he;mt=1;var r=Se().default;Object.defineProperty(he,"__esModule",{value:!0}),he.default=void 0;var e=r(pr()),t=yr(),n=(0,e.default)((0,e.default)({},t.commonLocale),{},{locale:"zh_CN",today:"今天",now:"此刻",backToToday:"返回今天",ok:"确定",timeSelect:"选择时间",dateSelect:"选择日期",weekSelect:"选择周",clear:"清除",week:"周",month:"月",year:"年",previousMonth:"上个月 (翻页上键)",nextMonth:"下个月 (翻页下键)",monthSelect:"选择月份",yearSelect:"选择年份",decadeSelect:"选择年代",previousYear:"上一年 (Control键加左方向键)",nextYear:"下一年 (Control键加右方向键)",previousDecade:"上一年代",nextDecade:"下一年代",previousCentury:"上一世纪",nextCentury:"下一世纪",yearFormat:"YYYY年",cellDateFormat:"D",monthBeforeYear:!1});return he.default=n,he}var fe={},ft;function Mt(){if(ft)return fe;ft=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.default=void 0;const r={placeholder:"请选择时间",rangePlaceholder:["开始时间","结束时间"]};return fe.default=r,fe}var gt;function _t(){if(gt)return ue;gt=1;var r=Se().default;Object.defineProperty(ue,"__esModule",{value:!0}),ue.default=void 0;var e=r(br()),t=r(Mt());const n={lang:Object.assign({placeholder:"请选择日期",yearPlaceholder:"请选择年份",quarterPlaceholder:"请选择季度",monthPlaceholder:"请选择月份",weekPlaceholder:"请选择周",rangePlaceholder:["开始日期","结束日期"],rangeYearPlaceholder:["开始年份","结束年份"],rangeMonthPlaceholder:["开始月份","结束月份"],rangeQuarterPlaceholder:["开始季度","结束季度"],rangeWeekPlaceholder:["开始周","结束周"]},e.default),timePickerLocale:Object.assign({},t.default)};return n.lang.ok="确定",ue.default=n,ue}var pt;function xr(){if(pt)return de;pt=1;var r=Se().default;Object.defineProperty(de,"__esModule",{value:!0}),de.default=void 0;var e=r(_t());return de.default=e.default,de}var yt;function vr(){if(yt)return le;yt=1;var r=Se().default;Object.defineProperty(le,"__esModule",{value:!0}),le.default=void 0;var e=r(hr()),t=r(xr()),n=r(_t()),s=r(Mt());const o="${label}不是一个有效的${type}",i={locale:"zh-cn",Pagination:e.default,DatePicker:n.default,TimePicker:s.default,Calendar:t.default,global:{placeholder:"请选择",close:"关闭"},Table:{filterTitle:"筛选",filterConfirm:"确定",filterReset:"重置",filterEmptyText:"无筛选项",filterCheckAll:"全选",filterSearchPlaceholder:"在筛选项中搜索",emptyText:"暂无数据",selectAll:"全选当页",selectInvert:"反选当页",selectNone:"清空所有",selectionAll:"全选所有",sortTitle:"排序",expand:"展开行",collapse:"关闭行",triggerDesc:"点击降序",triggerAsc:"点击升序",cancelSort:"取消排序"},Modal:{okText:"确定",cancelText:"取消",justOkText:"知道了"},Tour:{Next:"下一步",Previous:"上一步",Finish:"结束导览"},Popconfirm:{cancelText:"取消",okText:"确定"},Transfer:{titles:["",""],searchPlaceholder:"请输入搜索内容",itemUnit:"项",itemsUnit:"项",remove:"删除",selectCurrent:"全选当页",removeCurrent:"删除当页",selectAll:"全选所有",deselectAll:"取消全选",removeAll:"删除全部",selectInvert:"反选当页"},Upload:{uploading:"文件上传中",removeFile:"删除文件",uploadError:"上传错误",previewFile:"预览文件",downloadFile:"下载文件"},Empty:{description:"暂无数据"},Icon:{icon:"图标"},Text:{edit:"编辑",copy:"复制",copied:"复制成功",expand:"展开",collapse:"收起"},Form:{optional:"（可选）",defaultValidateMessages:{default:"字段验证错误${label}",required:"请输入${label}",enum:"${label}必须是其中一个[${enum}]",whitespace:"${label}不能为空字符",date:{format:"${label}日期格式无效",parse:"${label}不能转换为日期",invalid:"${label}是一个无效日期"},types:{string:o,method:o,array:o,object:o,number:o,date:o,boolean:o,integer:o,float:o,regexp:o,email:o,url:o,hex:o},string:{len:"${label}须为${len}个字符",min:"${label}最少${min}个字符",max:"${label}最多${max}个字符",range:"${label}须在${min}-${max}字符之间"},number:{len:"${label}必须等于${len}",min:"${label}最小值为${min}",max:"${label}最大值为${max}",range:"${label}须在${min}-${max}之间"},array:{len:"须为${len}个${label}",min:"最少${min}个${label}",max:"最多${max}个${label}",range:"${label}数量须在${min}-${max}之间"},pattern:{mismatch:"${label}与模式不匹配${pattern}"}}},Image:{preview:"预览"},QRCode:{expired:"二维码过期",refresh:"点击刷新",scanned:"已扫描"},ColorPicker:{presetEmpty:"暂无",transparent:"无色",singleColor:"单色",gradientColor:"渐变色"}};return le.default=i,le}var De,bt;function wr(){return bt||(bt=1,De=vr()),De}var jr=wr();const kr=Gt(jr),xt=r=>{let e;const t=new Set,n=(d,g)=>{const f=typeof d=="function"?d(e):d;if(!Object.is(f,e)){const p=e;e=(g!=null?g:typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(y=>y(e,p))}},s=()=>e,c={setState:n,getState:s,getInitialState:()=>l,subscribe:d=>(t.add(d),()=>t.delete(d))},l=e=r(n,s,c);return c},Cr=(r=>r?xt(r):xt),Sr=r=>r;function Ir(r,e=Sr){const t=Z.useSyncExternalStore(r.subscribe,Z.useCallback(()=>e(r.getState()),[r,e]),Z.useCallback(()=>e(r.getInitialState()),[r,e]));return Z.useDebugValue(t),t}const vt=r=>{const e=Cr(r),t=n=>Ir(e,n);return Object.assign(t,e),t},Y=(r=>r?vt(r):vt),Te="s3-gallery-config",Ue="s3-gallery-theme";class Pr{saveConfig(e){try{const t=JSON.stringify(e);localStorage.setItem(Te,t)}catch(t){throw console.error("保存配置失败:",t),new Error("保存配置失败")}}loadConfig(){try{const e=localStorage.getItem(Te);return e?JSON.parse(e):null}catch(e){return console.error("加载配置失败:",e),null}}exportConfig(){const e=this.loadConfig();if(!e)throw new Error("没有可导出的配置");return JSON.stringify(e,null,2)}importConfig(e){try{const t=JSON.parse(e);if(!t.accessKeyId||!t.secretAccessKey||!t.endpoint||!t.bucket)throw new Error("配置文件缺少必填字段");return t}catch(t){throw t instanceof SyntaxError?new Error("配置文件格式无效"):t}}saveTheme(e){try{localStorage.setItem(Ue,e)}catch(t){console.error("保存主题失败:",t)}}loadTheme(){try{const e=localStorage.getItem(Ue);return e==="dark"||e==="light"?e:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch(e){return"light"}}clearAll(){localStorage.removeItem(Te),localStorage.removeItem(Ue)}}const J=new Pr,_=Y(r=>({theme:"light",uploadModalVisible:!1,settingsModalVisible:!1,viewerVisible:!1,currentImageIndex:0,renameModalVisible:!1,moveModalVisible:!1,currentOperationItem:null,toggleTheme:()=>r(e=>{const t=e.theme==="light"?"dark":"light";return J.saveTheme(t),{theme:t}}),showUploadModal:()=>r({uploadModalVisible:!0}),hideUploadModal:()=>r({uploadModalVisible:!1}),showSettingsModal:()=>r({settingsModalVisible:!0}),hideSettingsModal:()=>r({settingsModalVisible:!1}),showViewer:e=>r({viewerVisible:!0,currentImageIndex:e}),hideViewer:()=>r({viewerVisible:!1}),setCurrentImageIndex:e=>r({currentImageIndex:e}),loadThemeFromStorage:()=>{const e=J.loadTheme();r({theme:e})},showRenameModal:e=>r({renameModalVisible:!0,currentOperationItem:e}),hideRenameModal:()=>r({renameModalVisible:!1,currentOperationItem:null}),showMoveModal:e=>r({moveModalVisible:!0,currentOperationItem:e}),hideMoveModal:()=>r({moveModalVisible:!1,currentOperationItem:null})}));class Ot{constructor(e){te(this,"client");te(this,"config");this.config=e,this.client=new tt({region:e.region,endpoint:e.endpoint,credentials:{accessKeyId:e.accessKeyId,secretAccessKey:e.secretAccessKey},forcePathStyle:!0})}listObjects(e){return h(this,null,function*(){try{const t=new rr({Bucket:this.config.bucket,Prefix:e,Delimiter:"/"}),n=yield this.client.send(t),s=[];if(n.CommonPrefixes)for(const o of n.CommonPrefixes)o.Prefix&&s.push({key:o.Prefix,size:0,lastModified:new Date,isFolder:!0});if(n.Contents)for(const o of n.Contents)o.Key&&o.Key!==e&&s.push({key:o.Key,size:o.Size||0,lastModified:o.LastModified||new Date,isFolder:!1});return s}catch(t){throw console.error("列出对象失败:",t),new Error(`列出对象失败: ${t instanceof Error?t.message:"未知错误"}`)}})}uploadObject(e,t){return h(this,null,function*(){try{const n=new nr({Bucket:this.config.bucket,Key:e,Body:t,ContentType:t.type});yield this.client.send(n)}catch(n){throw console.error("上传对象失败:",n),new Error(`上传对象失败: ${n instanceof Error?n.message:"未知错误"}`)}})}deleteObject(e){return h(this,null,function*(){try{const t=new ar({Bucket:this.config.bucket,Key:e});yield this.client.send(t)}catch(t){throw console.error("删除对象失败:",t),new Error(`删除对象失败: ${t instanceof Error?t.message:"未知错误"}`)}})}deleteObjects(e){return h(this,null,function*(){const t={success:[],failed:[]};if(e.length===0)return t;try{for(let s=0;s<e.length;s+=1e3){const o=e.slice(s,s+1e3),i=new sr({Bucket:this.config.bucket,Delete:{Objects:o.map(l=>({Key:l})),Quiet:!1}}),c=yield this.client.send(i);if(c.Deleted)for(const l of c.Deleted)l.Key&&t.success.push(l.Key);if(c.Errors)for(const l of c.Errors)l.Key&&t.failed.push({key:l.Key,error:l.Message||"未知错误"})}}catch(n){console.error("批量删除对象失败:",n);for(const s of e)t.success.includes(s)||t.failed.push({key:s,error:n instanceof Error?n.message:"未知错误"})}return t})}renameObject(e,t){return h(this,null,function*(){try{const n=new or({Bucket:this.config.bucket,CopySource:`${this.config.bucket}/${e}`,Key:t});yield this.client.send(n),yield this.deleteObject(e)}catch(n){throw console.error("重命名对象失败:",n),new Error(`重命名对象失败: ${n instanceof Error?n.message:"未知错误"}`)}})}moveObject(e,t){return h(this,null,function*(){return this.renameObject(e,t)})}testConnection(){return h(this,null,function*(){try{const e=new ir({Bucket:this.config.bucket});return yield this.client.send(e),!0}catch(e){return console.error("测试连接失败:",e),!1}})}getObjectUrl(e){if(this.config.customDomain)return`${this.config.customDomain.replace(/\/$/,"")}/${e}`;const t=this.config.endpoint.replace(/\/$/,"");return t.includes("://")?`${t}/${this.config.bucket}/${e}`:`https://${t}/${this.config.bucket}/${e}`}updateConfig(e){this.config=e,this.client=new tt({region:e.region,endpoint:e.endpoint,credentials:{accessKeyId:e.accessKeyId,secretAccessKey:e.secretAccessKey},forcePathStyle:!0})}destroy(){this.client.destroy()}}let H=null;function je(r){return H&&H.destroy(),H=new Ot(r),H}function q(){return H}function Et(){H&&(H.destroy(),H=null)}const Rt=Object.freeze(Object.defineProperty({__proto__:null,S3Service:Ot,destroyS3Service:Et,getS3Service:q,initS3Service:je},Symbol.toStringTag,{value:"Module"})),pe=Y(r=>({config:null,isInitialized:!1,setConfig:e=>{je(e),r({config:e,isInitialized:!0})},clearConfig:()=>{Et(),J.saveConfig({}),r({config:null,isInitialized:!1})},loadConfigFromStorage:()=>{const e=J.loadConfig();e?(je(e),r({config:e,isInitialized:!0})):r({isInitialized:!0})},saveConfigToStorage:e=>{J.saveConfig(e),je(e),r({config:e,isInitialized:!0})}}));var Nr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},Mr=function(e,t){return m.createElement(ne,ae({},e,{ref:t,icon:Nr}))},_r=m.forwardRef(Mr),Or={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},Er=function(e,t){return m.createElement(ne,ae({},e,{ref:t,icon:Or}))},Rr=m.forwardRef(Er),Lr={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M489.5 111.66c30.65-1.8 45.98 36.44 22.58 56.33A243.35 243.35 0 00426 354c0 134.76 109.24 244 244 244 72.58 0 139.9-31.83 186.01-86.08 19.87-23.38 58.07-8.1 56.34 22.53C900.4 745.82 725.15 912 512.5 912 291.31 912 112 732.69 112 511.5c0-211.39 164.29-386.02 374.2-399.65l.2-.01zm-81.15 79.75l-4.11 1.36C271.1 237.94 176 364.09 176 511.5 176 697.34 326.66 848 512.5 848c148.28 0 274.94-96.2 319.45-230.41l.63-1.93-.11.07a307.06 307.06 0 01-159.73 46.26L670 662c-170.1 0-308-137.9-308-308 0-58.6 16.48-114.54 46.27-162.47z"}}]},name:"moon",theme:"outlined"},$r=function(e,t){return m.createElement(ne,ae({},e,{ref:t,icon:Lr}))},Dr=m.forwardRef($r),Tr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"},Ur=function(e,t){return m.createElement(ne,ae({},e,{ref:t,icon:Tr}))},wt=m.forwardRef(Ur),zr={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M548 818v126a16 16 0 01-16 16h-40a16 16 0 01-16-16V818c15.85 1.64 27.84 2.46 36 2.46 8.15 0 20.16-.82 36-2.46m205.25-115.66l89.1 89.1a16 16 0 010 22.62l-28.29 28.29a16 16 0 01-22.62 0l-89.1-89.1c12.37-10.04 21.43-17.95 27.2-23.71 5.76-5.77 13.67-14.84 23.71-27.2m-482.5 0c10.04 12.36 17.95 21.43 23.71 27.2 5.77 5.76 14.84 13.67 27.2 23.71l-89.1 89.1a16 16 0 01-22.62 0l-28.29-28.29a16 16 0 010-22.63zM512 278c129.24 0 234 104.77 234 234S641.24 746 512 746 278 641.24 278 512s104.77-234 234-234m0 72c-89.47 0-162 72.53-162 162s72.53 162 162 162 162-72.53 162-162-72.53-162-162-162M206 476c-1.64 15.85-2.46 27.84-2.46 36 0 8.15.82 20.16 2.46 36H80a16 16 0 01-16-16v-40a16 16 0 0116-16zm738 0a16 16 0 0116 16v40a16 16 0 01-16 16H818c1.64-15.85 2.46-27.84 2.46-36 0-8.15-.82-20.16-2.46-36zM814.06 180.65l28.29 28.29a16 16 0 010 22.63l-89.1 89.09c-10.04-12.37-17.95-21.43-23.71-27.2-5.77-5.76-14.84-13.67-27.2-23.71l89.1-89.1a16 16 0 0122.62 0m-581.5 0l89.1 89.1c-12.37 10.04-21.43 17.95-27.2 23.71-5.76 5.77-13.67 14.84-23.71 27.2l-89.1-89.1a16 16 0 010-22.62l28.29-28.29a16 16 0 0122.62 0M532 64a16 16 0 0116 16v126c-15.85-1.64-27.84-2.46-36-2.46-8.15 0-20.16.82-36 2.46V80a16 16 0 0116-16z"}}]},name:"sun",theme:"outlined"},Br=function(e,t){return m.createElement(ne,ae({},e,{ref:t,icon:zr}))},Vr=m.forwardRef(Br),Fr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},Ar=function(e,t){return m.createElement(ne,ae({},e,{ref:t,icon:Fr}))},qe=m.forwardRef(Ar);function qr(){const r=_(o=>o.theme),e=_(o=>o.toggleTheme),t=_(o=>o.showUploadModal),n=_(o=>o.showSettingsModal),s=r==="dark";return a.jsx("header",{className:`sticky top-0 z-50 border-b ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:a.jsxs("div",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[a.jsx("h1",{className:`text-lg md:text-xl font-bold ${s?"text-white":"text-gray-900"}`,children:"S3图床管理"}),a.jsx("div",{className:"flex-1"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(T,{type:"text",icon:s?a.jsx(Vr,{}):a.jsx(Dr,{}),onClick:e,"aria-label":s?"切换到浅色模式":"切换到深色模式",className:s?"text-gray-300 hover:text-white":""}),a.jsx(T,{type:"primary",icon:a.jsx(qe,{}),onClick:t,className:"hidden sm:inline-flex",children:"上传"}),a.jsx(T,{type:"primary",icon:a.jsx(qe,{}),onClick:t,className:"sm:hidden","aria-label":"上传图片"}),a.jsx(T,{icon:a.jsx(wt,{}),onClick:n,className:"hidden sm:inline-flex",children:"设置"}),a.jsx(T,{icon:a.jsx(wt,{}),onClick:n,className:"sm:hidden","aria-label":"打开设置"})]})]})})}const Kr=({currentPath:r,onNavigate:e,selectedCount:t,onBatchDownload:n,onBatchCopyUrl:s,onBatchDelete:o})=>{const i=Z.useMemo(()=>{if(!r||r==="/")return[{name:"根目录",path:""}];const c=r.split("/").filter(Boolean),l=[{name:"根目录",path:""}];let d="";for(const g of c)d+=(d?"/":"")+g,l.push({name:g,path:d});return l},[r]);return a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:[a.jsx("nav",{className:"flex items-center space-x-2 flex-1 overflow-x-auto",children:i.map((c,l)=>a.jsxs(Z.Fragment,{children:[l>0&&a.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"/"}),a.jsx("button",{onClick:()=>e(c.path),className:`
                px-2 py-1 rounded text-sm font-medium transition-colors
                ${l===i.length-1?"text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}
              `,disabled:l===i.length-1,children:c.name})]},c.path))}),t>0&&a.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[a.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["已选中 ",t," 项"]}),a.jsxs("button",{onClick:n,className:"px-3 py-1.5 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded transition-colors",title:"批量下载",children:[a.jsx("svg",{className:"w-4 h-4 inline-block mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"下载"]}),a.jsxs("button",{onClick:s,className:"px-3 py-1.5 text-sm font-medium text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors",title:"批量复制路径",children:[a.jsx("svg",{className:"w-4 h-4 inline-block mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"复制"]}),a.jsxs("button",{onClick:o,className:"px-3 py-1.5 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded transition-colors",title:"批量删除",children:[a.jsx("svg",{className:"w-4 h-4 inline-block mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"删除"]})]})]})},ye=Y(r=>({currentPath:"",pathHistory:[],navigate:e=>r(t=>({currentPath:e,pathHistory:[...t.pathHistory,t.currentPath]})),goBack:()=>r(e=>{var s;const t=[...e.pathHistory];return{currentPath:(s=t.pop())!=null?s:"",pathHistory:t}}),goToPath:e=>r({currentPath:e,pathHistory:[]})})),Lt=Y((r,e)=>({selectedItems:new Set,toggleSelection:t=>r(n=>{const s=new Set(n.selectedItems);return s.has(t)?s.delete(t):s.add(t),{selectedItems:s}}),selectAll:t=>r({selectedItems:new Set(t)}),clearSelection:()=>r({selectedItems:new Set}),isSelected:t=>e().selectedItems.has(t)})),Ke=(r,e)=>e.some(t=>r instanceof t);let jt,kt;function Wr(){return jt||(jt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Hr(){return kt||(kt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const We=new WeakMap,ze=new WeakMap,Ie=new WeakMap;function Yr(r){const e=new Promise((t,n)=>{const s=()=>{r.removeEventListener("success",o),r.removeEventListener("error",i)},o=()=>{t(Q(r.result)),s()},i=()=>{n(r.error),s()};r.addEventListener("success",o),r.addEventListener("error",i)});return Ie.set(e,r),e}function Gr(r){if(We.has(r))return;const e=new Promise((t,n)=>{const s=()=>{r.removeEventListener("complete",o),r.removeEventListener("error",i),r.removeEventListener("abort",i)},o=()=>{t(),s()},i=()=>{n(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",o),r.addEventListener("error",i),r.addEventListener("abort",i)});We.set(r,e)}let He={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return We.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Q(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function $t(r){He=r(He)}function Zr(r){return Hr().includes(r)?function(...e){return r.apply(Ye(this),e),Q(this.request)}:function(...e){return Q(r.apply(Ye(this),e))}}function Jr(r){return typeof r=="function"?Zr(r):(r instanceof IDBTransaction&&Gr(r),Ke(r,Wr())?new Proxy(r,He):r)}function Q(r){if(r instanceof IDBRequest)return Yr(r);if(ze.has(r))return ze.get(r);const e=Jr(r);return e!==r&&(ze.set(r,e),Ie.set(e,r)),e}const Ye=r=>Ie.get(r);function Qr(r,e,{blocked:t,upgrade:n,blocking:s,terminated:o}={}){const i=indexedDB.open(r,e),c=Q(i);return n&&i.addEventListener("upgradeneeded",l=>{n(Q(i.result),l.oldVersion,l.newVersion,Q(i.transaction),l)}),t&&i.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),c.then(l=>{o&&l.addEventListener("close",()=>o()),s&&l.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const Xr=["get","getKey","getAll","getAllKeys","count"],en=["put","add","delete","clear"],Be=new Map;function Ct(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(Be.get(e))return Be.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,s=en.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(s||Xr.includes(t)))return;const o=function(i,...c){return h(this,null,function*(){const l=this.transaction(i,s?"readwrite":"readonly");let d=l.store;return n&&(d=d.index(c.shift())),(yield Promise.all([d[t](...c),s&&l.done]))[0]})};return Be.set(e,o),o}$t(r=>ee(X({},r),{get:(e,t,n)=>Ct(e,t)||r.get(e,t,n),has:(e,t)=>!!Ct(e,t)||r.has(e,t)}));const tn=["continue","continuePrimaryKey","advance"],St={},Ge=new WeakMap,Dt=new WeakMap,rn={get(r,e){if(!tn.includes(e))return r[e];let t=St[e];return t||(t=St[e]=function(...n){Ge.set(this,Dt.get(this)[e](...n))}),t}};function nn(...r){return Xe(this,null,function*(){let e=this;if(e instanceof IDBCursor||(e=yield new ve(e.openCursor(...r))),!e)return;e=e;const t=new Proxy(e,rn);for(Dt.set(t,e),Ie.set(t,Ye(e));e;)yield t,e=yield new ve(Ge.get(t)||e.continue()),Ge.delete(t)})}function It(r,e){return e===Symbol.asyncIterator&&Ke(r,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&Ke(r,[IDBIndex,IDBObjectStore])}$t(r=>ee(X({},r),{get(e,t,n){return It(e,t)?nn:r.get(e,t,n)},has(e,t){return It(e,t)||r.has(e,t)}}));const an=300*1e3,sn="s3-image-gallery-cache",on=1;class Tt{constructor(){te(this,"db",null);te(this,"initPromise",null)}init(){return h(this,null,function*(){if(!this.db)return this.initPromise?this.initPromise:(this.initPromise=this.doInit(),this.initPromise)})}doInit(){return h(this,null,function*(){try{this.db=yield Qr(sn,on,{upgrade(e){e.objectStoreNames.contains("directories")||e.createObjectStore("directories"),e.objectStoreNames.contains("thumbnails")||e.createObjectStore("thumbnails")}})}catch(e){console.error("Failed to initialize IndexedDB:",e),this.db=null}})}ensureDB(){return h(this,null,function*(){return this.db||(yield this.init()),this.db})}cacheDirectory(s,o){return h(this,arguments,function*(e,t,n=an){const i=yield this.ensureDB();if(i)try{const c={items:t,timestamp:Date.now(),ttl:n};yield i.put("directories",c,e)}catch(c){console.error("Failed to cache directory:",c)}})}getDirectory(e){return h(this,null,function*(){const t=yield this.ensureDB();if(!t)return null;try{const n=yield t.get("directories",e);return n?Date.now()-n.timestamp>n.ttl?(yield t.delete("directories",e),null):n.items:null}catch(n){return console.error("Failed to get cached directory:",n),null}})}cacheThumbnail(e,t){return h(this,null,function*(){const n=yield this.ensureDB();if(n)try{const s={blob:t,timestamp:Date.now()};yield n.put("thumbnails",s,e)}catch(s){console.error("Failed to cache thumbnail:",s)}})}getThumbnail(e){return h(this,null,function*(){const t=yield this.ensureDB();if(!t)return null;try{const n=yield t.get("thumbnails",e);return n?n.blob:null}catch(n){return console.error("Failed to get cached thumbnail:",n),null}})}clearPath(e){return h(this,null,function*(){const t=yield this.ensureDB();if(t)try{const n=t.transaction("directories","readwrite"),s=n.objectStore("directories"),o=yield s.getAllKeys(),i=e.endsWith("/")?e:e+"/";for(const l of o)(l===e||l.startsWith(i))&&(yield s.delete(l));const c=this.getParentPath(e);c!==null&&c!==e&&(yield s.delete(c)),yield n.done}catch(n){console.error("Failed to clear path cache:",n)}})}getParentPath(e){if(!e||e===""||e==="/")return null;const t=e.endsWith("/")?e.slice(0,-1):e,n=t.lastIndexOf("/");return n===-1?"":t.substring(0,n)}clearAll(){return h(this,null,function*(){const e=yield this.ensureDB();if(e)try{yield e.clear("directories"),yield e.clear("thumbnails")}catch(t){console.error("Failed to clear all cache:",t)}})}close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null)}}const z=new Tt,ln=Object.freeze(Object.defineProperty({__proto__:null,CacheService:Tt,cacheService:z},Symbol.toStringTag,{value:"Module"}));class cn{generateThumbnail(e,t=300,n=300){return h(this,null,function*(){return new Promise((s,o)=>{const i=new Image,c=URL.createObjectURL(e);i.onload=()=>{URL.revokeObjectURL(c);let l=i.width,d=i.height;if(l>t||d>n){const p=Math.min(t/l,n/d);l=Math.round(l*p),d=Math.round(d*p)}const g=document.createElement("canvas");g.width=l,g.height=d;const f=g.getContext("2d");if(!f){o(new Error("无法创建Canvas上下文"));return}f.drawImage(i,0,0,l,d),g.toBlob(p=>{p?s(p):o(new Error("生成缩略图失败"))},"image/jpeg",.8)},i.onerror=()=>{URL.revokeObjectURL(c),o(new Error("加载图片失败"))},i.src=c})})}convertToWebP(e,t=.9){return h(this,null,function*(){return new Promise((n,s)=>{const o=new Image,i=URL.createObjectURL(e);o.onload=()=>{URL.revokeObjectURL(i);const c=document.createElement("canvas");c.width=o.width,c.height=o.height;const l=c.getContext("2d");if(!l){s(new Error("无法创建Canvas上下文"));return}l.drawImage(o,0,0),c.toBlob(d=>{d?n(d):s(new Error("转换WebP失败"))},"image/webp",t)},o.onerror=()=>{URL.revokeObjectURL(i),s(new Error("加载图片失败"))},o.src=i})})}calculateMD5(e){return h(this,null,function*(){const t=yield e.arrayBuffer(),n=yield crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(i=>i.toString(16).padStart(2,"0")).join("").substring(0,16)})}downloadImages(e,t){return h(this,null,function*(){for(let n=0;n<e.length;n++)yield this.downloadSingleImage(e[n],t[n]),n<e.length-1&&(yield new Promise(s=>setTimeout(s,300)))})}downloadSingleImage(e,t){return h(this,null,function*(){try{const s=yield(yield fetch(e)).blob(),o=URL.createObjectURL(s),i=document.createElement("a");i.href=o,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)}catch(n){throw console.error(`下载图片失败: ${t}`,n),n}})}getImageDimensions(e){return h(this,null,function*(){return new Promise((t,n)=>{const s=new Image,o=URL.createObjectURL(e);s.onload=()=>{URL.revokeObjectURL(o),t({width:s.width,height:s.height})},s.onerror=()=>{URL.revokeObjectURL(o),n(new Error("加载图片失败"))},s.src=o})})}generateAndCacheThumbnailFromUrl(e,t,n=300,s=300){return h(this,null,function*(){const o=yield z.getThumbnail(t);return o?URL.createObjectURL(o):new Promise((i,c)=>{const l=new Image;l.crossOrigin="anonymous",l.onload=()=>h(null,null,function*(){try{let d=l.width,g=l.height;if(d>n||g>s){const y=Math.min(n/d,s/g);d=Math.round(d*y),g=Math.round(g*y)}const f=document.createElement("canvas");f.width=d,f.height=g;const p=f.getContext("2d");if(!p){c(new Error("无法创建Canvas上下文"));return}p.drawImage(l,0,0,d,g),f.toBlob(y=>h(null,null,function*(){y?(yield z.cacheThumbnail(t,y),i(URL.createObjectURL(y))):c(new Error("生成缩略图失败"))}),"image/jpeg",.8)}catch(d){c(d)}}),l.onerror=()=>{i(e)},l.src=e})})}preGenerateThumbnails(e,t=3){return h(this,null,function*(){const n=[...e],s=[],o=()=>h(this,null,function*(){for(;n.length>0;){const i=n.shift();if(!i)break;try{yield this.generateAndCacheThumbnailFromUrl(i.url,i.key)}catch(c){console.error(`预生成缩略图失败: ${i.key}`,c)}}});for(let i=0;i<t;i++)s.push(o());yield Promise.all(s)})}getCachedThumbnailUrl(e){return h(this,null,function*(){const t=yield z.getThumbnail(e);return t?URL.createObjectURL(t):null})}}const be=new cn,dn=Object.freeze(Object.defineProperty({__proto__:null,imageService:be},Symbol.toStringTag,{value:"Module"}));function Ve(r){return[...r].sort((e,t)=>e.type==="folder"&&t.type!=="folder"?-1:e.type!=="folder"&&t.type==="folder"?1:e.name.localeCompare(t.name))}const se=Y((r,e)=>({items:[],loading:!1,error:null,currentPath:"",setItems:t=>r({items:Ve(t),error:null}),setLoading:t=>r({loading:t}),setError:t=>r({error:t,loading:!1}),clearItems:()=>r({items:[],error:null}),loadItems:t=>h(null,null,function*(){const n=q();if(!n){r({error:"请先配置S3连接信息",loading:!1});return}r({loading:!0,error:null,currentPath:t});try{const s=yield z.getDirectory(t);if(s){r({items:Ve(s),loading:!1}),e().preloadThumbnails();return}const i=(yield n.listObjects(t)).map(l=>{const d=l.key.replace(t,"").replace(/\/$/,"");return l.isFolder?{type:"folder",key:l.key,name:d}:{type:"image",key:l.key,name:d,fullUrl:n.getObjectUrl(l.key),thumbnailUrl:n.getObjectUrl(l.key),size:l.size,lastModified:l.lastModified}}).filter(l=>l.name),c=Ve(i);r({items:c,loading:!1}),yield z.cacheDirectory(t,c),e().preloadThumbnails()}catch(s){console.error("加载目录失败:",s),r({error:s instanceof Error?s.message:"加载目录失败",loading:!1})}}),refreshItems:()=>h(null,null,function*(){const{currentPath:t,loadItems:n}=e();yield z.clearPath(t),yield n(t)}),preloadThumbnails:()=>h(null,null,function*(){const{items:t}=e(),n=t.filter(s=>s.type==="image"&&s.fullUrl).map(s=>({url:s.fullUrl,key:s.key}));n.length!==0&&be.preGenerateThumbnails(n,3).catch(s=>{console.error("预加载缩略图失败:",s)})})})),un=Object.freeze(Object.defineProperty({__proto__:null,useGalleryStore:se},Symbol.toStringTag,{value:"Module"}));let hn=0;const W=Y((r,e)=>({messages:[],addMessage:(t,n,s=3e3)=>{const o=`message-${++hn}`,i={id:o,type:t,content:n,duration:s};return r(c=>({messages:[...c.messages,i]})),t!=="loading"&&s>0&&setTimeout(()=>{r(c=>({messages:c.messages.filter(l=>l.id!==o)}))},s),o},removeMessage:t=>{r(n=>({messages:n.messages.filter(s=>s.id!==t)}))},success:(t,n)=>e().addMessage("success",t,n),error:(t,n=5e3)=>e().addMessage("error",t,n),info:(t,n)=>e().addMessage("info",t,n),warning:(t,n)=>e().addMessage("warning",t,n),loading:t=>e().addMessage("loading",t,0)})),C={success:(r,e)=>{W.getState().success(r,e)},error:(r,e)=>{W.getState().error(r,e)},info:(r,e)=>{W.getState().info(r,e)},warning:(r,e)=>{W.getState().warning(r,e)},loading:r=>W.getState().loading(r),destroy:r=>{W.getState().removeMessage(r)}},re=Y((r,e)=>({visible:!1,options:null,loading:!1,showConfirm:t=>{r({visible:!0,options:t,loading:!1})},hideConfirm:()=>{r({visible:!1,options:null,loading:!1})},setLoading:t=>{r({loading:t})},handleOk:()=>h(null,null,function*(){const{options:t,hideConfirm:n,setLoading:s}=e();if(!(t!=null&&t.onOk)){n();return}try{s(!0),yield t.onOk(),n()}catch(o){throw console.error("确认操作失败:",o),s(!1),o}}),handleCancel:()=>{var s;const{options:t,hideConfirm:n}=e();(s=t==null?void 0:t.onCancel)==null||s.call(t),n()}})),Ut=r=>{re.getState().showConfirm(r)},Ce=Y(r=>({loading:!1,tip:"加载中...",showLoading:(e="加载中...")=>{r({loading:!0,tip:e})},hideLoading:()=>{r({loading:!1})}})),Fe={show:r=>{Ce.getState().showLoading(r)},hide:()=>{Ce.getState().hideLoading()}},mn=()=>{const{currentPath:r,goToPath:e}=ye(),{selectedItems:t,clearSelection:n}=Lt(),{items:s,refreshItems:o}=se(),i=Z.useMemo(()=>s.filter(f=>f.type==="image"&&t.has(f.key)),[s,t]),c=f=>{e(f),n()},l=()=>h(null,null,function*(){if(i.length===0){C.warning("请选择要下载的图片");return}const f=q();if(!f){C.error("请先配置S3连接信息");return}Fe.show(`正在下载 ${i.length} 张图片...`);try{const p=i.map(j=>f.getObjectUrl(j.key)),y=i.map(j=>j.name);yield be.downloadImages(p,y),Fe.hide(),C.success(`成功下载 ${i.length} 张图片`)}catch(p){console.error("批量下载失败:",p),Fe.hide(),C.error(p instanceof Error?p.message:"批量下载失败，请重试")}}),d=()=>h(null,null,function*(){if(i.length===0){C.warning("请选择要复制路径的图片");return}const f=q();if(!f){C.error("请先配置S3连接信息");return}try{const y=i.map(j=>f.getObjectUrl(j.key)).join(`
`);yield navigator.clipboard.writeText(y),C.success(`已复制 ${i.length} 个图片URL到剪贴板`)}catch(p){console.error("复制URL失败:",p),C.error("复制失败，请重试")}}),g=()=>{if(i.length===0){C.warning("请选择要删除的图片");return}Ut({title:"确认批量删除",content:`确定要删除选中的 ${i.length} 张图片吗？此操作无法撤销。`,okText:"删除",cancelText:"取消",okType:"danger",onOk:()=>h(null,null,function*(){const f=q();if(!f){C.error("请先配置S3连接信息");return}try{const p=i.map(j=>j.key),y=yield f.deleteObjects(p);y.failed.length>0?C.warning(`删除完成，成功: ${y.success.length}，失败: ${y.failed.length}`):C.success(`成功删除 ${y.success.length} 张图片`),n(),yield z.clearPath(r),yield o()}catch(p){throw console.error("批量删除失败:",p),C.error(p instanceof Error?p.message:"批量删除失败，请重试"),p}})})};return a.jsx(Kr,{currentPath:r,onNavigate:c,selectedCount:t.size,onBatchDownload:l,onBatchCopyUrl:d,onBatchDelete:g})},fn=({item:r,selected:e,onSelect:t,onClick:n,onDownload:s,onCopyUrl:o,onDelete:i,onRename:c,onMove:l})=>{const[d,g]=m.useState(!1),[f,p]=m.useState(!1),[y,j]=m.useState(!1),[E,v]=m.useState(null),u=m.useRef(null),b=m.useRef(null);m.useEffect(()=>{if(!u.current)return;const k=new IntersectionObserver(B=>{B.forEach(V=>{V.isIntersecting&&(p(!0),k.disconnect())})},{rootMargin:"50px"});return k.observe(u.current),()=>{k.disconnect()}},[]),m.useEffect(()=>!f||!r.thumbnailUrl?void 0:(h(null,null,function*(){try{const B=yield be.getCachedThumbnailUrl(r.key);v(B||r.thumbnailUrl||r.fullUrl||null)}catch(B){console.error("加载缩略图失败:",B),v(r.thumbnailUrl||r.fullUrl||null)}}),()=>{E&&E.startsWith("blob:")&&URL.revokeObjectURL(E)}),[f,r.key,r.thumbnailUrl,r.fullUrl]),m.useEffect(()=>{const k=B=>{b.current&&!b.current.contains(B.target)&&j(!1)};return y&&document.addEventListener("mousedown",k),()=>{document.removeEventListener("mousedown",k)}},[y]);const w=k=>{k.stopPropagation(),t(k.target.checked)},I=()=>{n()},P=k=>{k.stopPropagation(),s()},x=k=>{k.stopPropagation(),o()},R=k=>{k.stopPropagation(),i()},D=k=>{k.stopPropagation(),j(!y)},K=k=>{k.stopPropagation(),j(!1),c==null||c()},N=k=>{k.stopPropagation(),j(!1),l==null||l()};return a.jsxs("div",{ref:u,className:`relative group rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 transition-all duration-200 ${e?"ring-2 ring-blue-500":""}`,children:[a.jsx("div",{className:"absolute top-2 left-2 z-10",children:a.jsx("input",{type:"checkbox",checked:e,onChange:w,className:"w-5 h-5 cursor-pointer accent-blue-500","aria-label":`选择 ${r.name}`})}),a.jsx("div",{className:"aspect-square cursor-pointer overflow-hidden",onClick:I,children:f&&E?a.jsx("img",{src:E,alt:r.name,className:`w-full h-full object-cover transition-all duration-300 ${d?"opacity-100":"opacity-0"} group-hover:scale-105`,onLoad:()=>g(!0),loading:"lazy"}):a.jsx("div",{className:"w-full h-full flex items-center justify-center",children:a.jsx("div",{className:"animate-pulse bg-gray-200 dark:bg-gray-700 w-full h-full"})})}),a.jsxs("div",{className:"p-2 bg-white dark:bg-gray-900",children:[a.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 truncate mb-2",title:r.name,children:r.name}),a.jsxs("div",{className:"flex items-center justify-around gap-2",children:[a.jsx("button",{onClick:P,className:"flex-1 flex items-center justify-center p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"下载图片",title:"下载",children:a.jsx("svg",{className:"w-5 h-5 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),a.jsx("button",{onClick:x,className:"flex-1 flex items-center justify-center p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"复制路径",title:"复制路径",children:a.jsx("svg",{className:"w-5 h-5 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),a.jsx("button",{onClick:R,className:"flex-1 flex items-center justify-center p-2 rounded hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors","aria-label":"删除图片",title:"删除",children:a.jsx("svg",{className:"w-5 h-5 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),a.jsxs("div",{className:"relative flex-1",ref:b,children:[a.jsx("button",{onClick:D,className:"w-full flex items-center justify-center p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"更多操作",title:"更多",children:a.jsx("svg",{className:"w-5 h-5 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),y&&a.jsxs("div",{className:"absolute bottom-full right-0 mb-1 w-32 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 z-10",children:[a.jsx("button",{onClick:K,className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-t-md",children:"重命名"}),a.jsx("button",{onClick:N,className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-b-md",children:"移动"})]})]})]})]})]})};function gn(r,e){let t=null;return function(...n){const s=this;t&&clearTimeout(t),t=setTimeout(()=>{r.apply(s,n),t=null},e)}}const pn=({items:r,loading:e,onItemClick:t,onFolderClick:n,selectedItems:s,onSelectionChange:o,onDownload:i,onCopyUrl:c,onDelete:l,onRename:d,onMove:g})=>{const[f,p]=m.useState({width:window.innerWidth,height:window.innerHeight});m.useEffect(()=>{const v=gn(()=>{p({width:window.innerWidth,height:window.innerHeight})},200);return window.addEventListener("resize",v),()=>{window.removeEventListener("resize",v)}},[]);const{columnCount:y}=m.useMemo(()=>{const v=f.width-32,u=200,b=16;let w=Math.floor((v+b)/(u+b));return w=Math.max(1,Math.min(w,6)),{columnCount:w}},[f]),j=m.useCallback(v=>{n(v)},[n]),E=m.useCallback(v=>{t(v)},[t]);return e?a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"加载中..."})}):r.length===0?a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"暂无内容"})}):a.jsx("div",{className:"w-full px-4 py-4",children:a.jsx("div",{className:"grid gap-4",style:{gridTemplateColumns:`repeat(${y}, 1fr)`},children:r.map(v=>{const u=s.has(v.key);return v.type==="folder"?a.jsxs("div",{className:"rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer transition-colors flex flex-col items-center justify-center p-8",onClick:()=>j(v.key),style:{aspectRatio:"1"},children:[a.jsx("svg",{className:"w-16 h-16 text-blue-500 dark:text-blue-400 mb-2",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})}),a.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 text-center truncate w-full",children:v.name})]},v.key):a.jsx(fn,{item:v,selected:u,onSelect:b=>o(v.key,b),onClick:()=>E(v),onDownload:()=>i==null?void 0:i(v),onCopyUrl:()=>c==null?void 0:c(v),onDelete:()=>l==null?void 0:l(v),onRename:()=>d==null?void 0:d(v),onMove:()=>g==null?void 0:g(v)},v.key)})})})},yn=()=>{const{items:r,loading:e,loadItems:t,refreshItems:n}=se(),{currentPath:s,navigate:o}=ye(),{selectedItems:i,toggleSelection:c,clearSelection:l}=Lt(),{showViewer:d,showRenameModal:g,showMoveModal:f}=_();m.useEffect(()=>{t(s),l()},[s,t,l]);const p=()=>{const x=s.split("/").filter(Boolean);x.pop();const R=x.length>0?x.join("/")+"/":"";o(R)},y=m.useMemo(()=>!s||s===""||s==="/"?r:[{type:"folder",key:"__back__",name:".."},...r],[s,r]),j=x=>{x==="__back__"?p():o(x)},E=x=>{if(x.type==="image"){const D=y.filter(K=>K.type==="image").findIndex(K=>K.key===x.key);D!==-1&&d(D)}},v=x=>{x!=="__back__"&&c(x)},u=m.useCallback(x=>h(null,null,function*(){if(x.fullUrl)try{yield be.downloadImages([x.fullUrl],[x.name]),C.success("下载成功")}catch(R){console.error("下载失败:",R),C.error("下载失败，请重试")}}),[]),b=m.useCallback(x=>h(null,null,function*(){if(x.fullUrl)try{yield navigator.clipboard.writeText(x.fullUrl),C.success("已复制到剪贴板")}catch(R){console.error("复制失败:",R),C.error("复制失败，请重试")}}),[]),w=m.useCallback(x=>{Ut({title:"确认删除",content:`确定要删除 "${x.name}" 吗？此操作无法撤销。`,okText:"删除",cancelText:"取消",okType:"danger",onOk:()=>h(null,null,function*(){const R=q();if(!R){C.error("请先配置S3连接信息");return}try{yield R.deleteObject(x.key),C.success("删除成功"),yield z.clearPath(s),yield n()}catch(D){throw console.error("删除失败:",D),C.error(D instanceof Error?D.message:"删除失败，请重试"),D}})})},[s,n]),I=m.useCallback(x=>{g({key:x.key,name:x.name})},[g]),P=m.useCallback(x=>{f({key:x.key,name:x.name})},[f]);return a.jsx(pn,{items:y,loading:e,onItemClick:E,onFolderClick:j,selectedItems:i,onSelectionChange:v,onDownload:u,onCopyUrl:b,onDelete:w,onRename:I,onMove:P})},bn=()=>{const{viewerVisible:r,currentImageIndex:e,hideViewer:t,setCurrentImageIndex:n}=_(),{items:s}=se(),o=m.useMemo(()=>s.filter(c=>c.type==="image"),[s]);if(m.useEffect(()=>{if(!r||o.length===0)return;const c=l=>{switch(l.key){case"ArrowLeft":l.preventDefault(),e>0&&n(e-1);break;case"ArrowRight":l.preventDefault(),e<o.length-1&&n(e+1);break;case"Escape":l.preventDefault(),t();break}};return document.addEventListener("keydown",c),()=>{document.removeEventListener("keydown",c)}},[r,e,o.length,n,t]),!r||o.length===0)return null;const i=o[e];return i?a.jsxs("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-90 flex items-center justify-center",onClick:t,children:[a.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors z-10",onClick:t,"aria-label":"关闭",children:a.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e>0&&a.jsx("button",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 transition-colors z-10",onClick:c=>{c.stopPropagation(),n(e-1)},"aria-label":"上一张",children:a.jsx("svg",{className:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e<o.length-1&&a.jsx("button",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 transition-colors z-10",onClick:c=>{c.stopPropagation(),n(e+1)},"aria-label":"下一张",children:a.jsx("svg",{className:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),a.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white text-center z-10",children:[a.jsx("div",{className:"text-sm mb-1",children:i.name}),a.jsxs("div",{className:"text-xs text-gray-400",children:[e+1," / ",o.length]})]}),a.jsx("div",{className:"relative max-w-[90vw] max-h-[90vh] flex items-center justify-center",onClick:c=>c.stopPropagation(),children:a.jsx("img",{src:i.fullUrl||i.thumbnailUrl||"",alt:i.name,className:"max-w-full max-h-[90vh] object-contain",loading:"lazy"})})]}):null};function xn(){const[r]=M.useForm(),[e,t]=m.useState(!1),[n,s]=m.useState(null),o=_(u=>u.settingsModalVisible),i=_(u=>u.hideSettingsModal),c=pe(u=>u.config),l=pe(u=>u.saveConfigToStorage),g=_(u=>u.theme)==="dark",f=()=>{c&&r.setFieldsValue(c)},p=()=>h(null,null,function*(){try{yield r.validateFields();const u=r.getFieldsValue();t(!0),s(null);const{S3Service:b}=yield ge(()=>h(null,null,function*(){const{S3Service:P}=yield Promise.resolve().then(()=>Rt);return{S3Service:P}}),void 0),w=new b(u),I=yield w.testConnection();w.destroy(),I?(s("success"),S.success("连接测试成功！")):(s("error"),S.error("连接测试失败，请检查配置"))}catch(u){s("error"),u instanceof Error?S.error(`连接测试失败: ${u.message}`):S.error("连接测试失败，请检查配置")}finally{t(!1)}}),y=()=>{try{const u=J.exportConfig(),b=new Blob([u],{type:"application/json"}),w=URL.createObjectURL(b),I=document.createElement("a");I.href=w,I.download=`s3-config-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(w),S.success("配置已导出")}catch(u){u instanceof Error?S.error(u.message):S.error("导出配置失败")}},j=u=>{const b=new FileReader;return b.onload=w=>{var I;try{const P=(I=w.target)==null?void 0:I.result,x=J.importConfig(P);r.setFieldsValue(x),S.success("配置已导入，请检查并保存")}catch(P){P instanceof Error?S.error(P.message):S.error("导入配置失败")}},b.readAsText(u),!1},E=()=>h(null,null,function*(){try{const u=yield r.validateFields();l(u),S.success("配置已保存"),i()}catch(u){S.error("请填写所有必填字段")}}),v=()=>{s(null),i()};return a.jsx(Ze,{title:"S3配置设置",open:o,onCancel:v,afterOpenChange:u=>u&&f(),width:600,footer:[a.jsx(T,{onClick:v,children:"取消"},"cancel"),a.jsx(T,{type:"primary",onClick:E,children:"保存配置"},"save")],className:g?"dark-modal":"",children:a.jsxs(M,{form:r,layout:"vertical",autoComplete:"off",className:"mt-4",children:[a.jsx(M.Item,{label:"Access Key ID",name:"accessKeyId",rules:[{required:!0,message:"请输入Access Key ID"},{min:16,message:"Access Key ID长度至少16个字符"}],children:a.jsx(G,{placeholder:"请输入Access Key ID"})}),a.jsx(M.Item,{label:"Secret Access Key",name:"secretAccessKey",rules:[{required:!0,message:"请输入Secret Access Key"},{min:32,message:"Secret Access Key长度至少32个字符"}],children:a.jsx(G.Password,{placeholder:"请输入Secret Access Key"})}),a.jsx(M.Item,{label:"Region",name:"region",rules:[{required:!0,message:"请输入Region"}],tooltip:"例如: us-east-1, auto",children:a.jsx(G,{placeholder:"例如: us-east-1, auto"})}),a.jsx(M.Item,{label:"Endpoint",name:"endpoint",rules:[{required:!0,message:"请输入Endpoint"},{pattern:/^https?:\/\/.+/,message:"Endpoint必须以http://或https://开头"}],tooltip:"例如: https://s3.amazonaws.com 或 https://your-account.r2.cloudflarestorage.com",children:a.jsx(G,{placeholder:"https://your-endpoint.com"})}),a.jsx(M.Item,{label:"Bucket",name:"bucket",rules:[{required:!0,message:"请输入Bucket名称"},{pattern:/^[a-z0-9][a-z0-9-]*[a-z0-9]$/,message:"Bucket名称只能包含小写字母、数字和连字符"}],children:a.jsx(G,{placeholder:"your-bucket-name"})}),a.jsx(M.Item,{label:"自定义域名（可选）",name:"customDomain",tooltip:"如果配置了自定义域名，将使用该域名生成图片URL",rules:[{pattern:/^https?:\/\/.+/,message:"自定义域名必须以http://或https://开头"}],children:a.jsx(G,{placeholder:"https://your-custom-domain.com"})}),a.jsx(M.Item,{children:a.jsxs(Ae,{className:"w-full",direction:"vertical",children:[a.jsx(T,{block:!0,icon:e?a.jsx(Zt,{}):n==="success"?a.jsx(_r,{}):void 0,onClick:p,loading:e,type:n==="success"?"primary":"default",danger:n==="error",children:e?"测试中...":n==="success"?"连接成功":n==="error"?"连接失败":"测试连接"}),a.jsxs(Ae,{className:"w-full",children:[a.jsx(T,{icon:a.jsx(Jt,{}),onClick:y,disabled:!c,className:"flex-1",children:"导出配置"}),a.jsx(Pt,{accept:".json",showUploadList:!1,beforeUpload:j,className:"flex-1",children:a.jsx(T,{icon:a.jsx(qe,{}),className:"w-full",children:"导入配置"})})]})]})})]})})}function vn(){return a.jsx(xn,{})}function wn(r,e=new Date){const t=e.getFullYear().toString(),n=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0");return r.replace(/\{year\}/gi,t).replace(/\{month\}/gi,n).replace(/\{day\}/gi,s)}function ke(r){if(!r)return"";let e=r.replace(/\/+/g,"/");return e=e.replace(/^\/+/,""),e.length>0&&(e=e.replace(/\/+$/,"")),e}function jn(r,e){return ke(r?e?`${r}/${e}`:r:e)}const{Dragger:kn}=Pt;function Cn(){const[r]=M.useForm(),[e,t]=m.useState([]),[n,s]=m.useState(!1),[o,i]=m.useState([]),c=_(u=>u.uploadModalVisible),l=_(u=>u.hideUploadModal),d=ye(u=>u.currentPath),f=_(u=>u.theme)==="dark";m.useEffect(()=>{c&&(r.setFieldsValue({format:"original",targetPath:"current",customPath:"",nameStrategy:"original"}),t([]),i([]))},[c,r]);const p=u=>{const b=u.fileList.map(w=>w.originFileObj).filter(Boolean);return t(b),!1},y=()=>h(null,null,function*(){if(e.length===0){S.warning("请先选择要上传的文件");return}try{yield r.validateFields();const u=r.getFieldsValue(),b={files:e,format:u.format,targetPath:u.targetPath,customPath:u.customPath,nameStrategy:u.nameStrategy};s(!0);const w=e.map(I=>({fileName:I.name,progress:0,status:"pending"}));i(w),yield j(b),S.success("所有文件上传完成！"),setTimeout(()=>{l()},1e3)}catch(u){u instanceof Error?S.error(`上传失败: ${u.message}`):S.error("上传失败，请重试")}finally{s(!1)}}),j=u=>h(null,null,function*(){const{imageService:b}=yield ge(()=>h(null,null,function*(){const{imageService:N}=yield Promise.resolve().then(()=>dn);return{imageService:N}}),void 0),{getS3Service:w}=yield ge(()=>h(null,null,function*(){const{getS3Service:N}=yield Promise.resolve().then(()=>Rt);return{getS3Service:N}}),void 0),{cacheService:I}=yield ge(()=>h(null,null,function*(){const{cacheService:N}=yield Promise.resolve().then(()=>ln);return{cacheService:N}}),void 0),P=w();if(!P)throw new Error("S3服务未初始化，请先配置S3连接");let x=d;u.targetPath==="custom"&&u.customPath&&(x=wn(u.customPath)),x=ke(x);const R=3,D=[];for(let N=0;N<u.files.length;N+=R){const B=u.files.slice(N,N+R).map((V,zt)=>h(null,null,function*(){const F=N+zt;try{i(L=>{const $=[...L];return $[F]=ee(X({},$[F]),{status:"uploading",progress:10}),$});let oe=V,U=V.name;if(u.format==="webp"&&!V.type.includes("webp")){i($=>{const xe=[...$];return xe[F].progress=30,xe}),oe=yield b.convertToWebP(V);const L=U.lastIndexOf(".");L!==-1?U=U.substring(0,L)+".webp":U=U+".webp"}if(u.nameStrategy==="md5"){i(xe=>{const Je=[...xe];return Je[F].progress=50,Je});const L=yield b.calculateMD5(V),$=U.split(".").pop();U=$?`${L}.${$}`:L}const Pe=x?jn(x,U):U;i(L=>{const $=[...L];return $[F].progress=70,$}),yield P.uploadObject(Pe,oe),i(L=>{const $=[...L];return $[F]=ee(X({},$[F]),{status:"success",progress:100}),$}),D.push({success:!0,fileName:V.name})}catch(oe){const U=oe instanceof Error?oe.message:"未知错误";i(Pe=>{const L=[...Pe];return L[F]=ee(X({},L[F]),{status:"error",progress:0,error:U}),L}),D.push({success:!1,fileName:V.name,error:U})}}));yield Promise.all(B)}if(yield I.clearPath(x),d===x){const{useGalleryStore:N}=yield ge(()=>h(null,null,function*(){const{useGalleryStore:k}=yield Promise.resolve().then(()=>un);return{useGalleryStore:k}}),void 0);yield N.getState().refreshItems()}const K=D.filter(N=>!N.success);if(K.length>0)throw new Error(`${K.length} 个文件上传失败`)}),E=()=>{if(n){S.warning("上传进行中，请等待完成");return}l()},v=M.useWatch("targetPath",r);return a.jsx(Ze,{title:"上传图片",open:c,onCancel:E,width:600,footer:[a.jsx(T,{onClick:E,disabled:n,children:"取消"},"cancel"),a.jsx(T,{type:"primary",onClick:y,loading:n,disabled:e.length===0,children:n?"上传中...":"开始上传"},"upload")],className:f?"dark-modal":"",closable:!n,maskClosable:!n,children:a.jsxs(M,{form:r,layout:"vertical",className:"mt-4",children:[a.jsx(M.Item,{label:"选择文件",children:a.jsxs(kn,{multiple:!0,accept:"image/*",fileList:e.map((u,b)=>({uid:`${b}`,name:u.name,status:"done"})),onChange:p,beforeUpload:()=>!1,disabled:n,children:[a.jsx("p",{className:"ant-upload-drag-icon",children:a.jsx(Rr,{})}),a.jsx("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"}),a.jsx("p",{className:"ant-upload-hint",children:"支持单个或批量上传图片文件"})]})}),a.jsx(M.Item,{label:"图片格式",name:"format",tooltip:"选择WebP可以减小文件大小，提高加载速度",children:a.jsxs(A.Group,{disabled:n,children:[a.jsx(A,{value:"original",children:"保持原格式"}),a.jsx(A,{value:"webp",children:"转换为WebP"})]})}),a.jsx(M.Item,{label:"上传路径",name:"targetPath",children:a.jsx(A.Group,{disabled:n,children:a.jsxs(Ae,{direction:"vertical",children:[a.jsxs(A,{value:"current",children:["当前目录 ",d?`(${d})`:"(根目录)"]}),a.jsx(A,{value:"custom",children:"自定义路径"})]})})}),v==="custom"&&a.jsx(M.Item,{name:"customPath",rules:[{required:!0,message:"请输入自定义路径"}],tooltip:"支持变量: {year}, {month}, {day}",children:a.jsx(G,{placeholder:"例如: images/{year}/{month}/{day}",disabled:n})}),a.jsx(M.Item,{label:"文件名策略",name:"nameStrategy",tooltip:"使用MD5可以避免文件名冲突，并且文件名长度固定为16个字符",children:a.jsxs(A.Group,{disabled:n,children:[a.jsx(A,{value:"original",children:"保留原文件名"}),a.jsx(A,{value:"md5",children:"使用MD5命名"})]})}),o.length>0&&a.jsxs("div",{className:"mt-4 space-y-2",children:[a.jsx("div",{className:"font-medium",children:"上传进度："}),o.map((u,b)=>a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"truncate flex-1",children:u.fileName}),a.jsxs("span",{className:"ml-2",children:[u.status==="pending"&&"等待中",u.status==="uploading"&&`${u.progress}%`,u.status==="success"&&"✓ 完成",u.status==="error"&&"✗ 失败"]})]}),a.jsx(Qt,{percent:u.progress,status:u.status==="error"?"exception":u.status==="success"?"success":"active",showInfo:!1,size:"small"}),u.error&&a.jsx("div",{className:"text-xs text-red-500",children:u.error})]},b))]})]})})}function Sn(){return a.jsx(Cn,{})}const In=({visible:r,currentName:e,onClose:t,onRename:n})=>{const[s,o]=m.useState(""),[i,c]=m.useState(!1),[l,d]=m.useState(null);m.useEffect(()=>{r&&(o(e),d(null))},[r,e]);const g=p=>h(null,null,function*(){if(p.preventDefault(),!s.trim()){d("文件名不能为空");return}if(s===e){d("新文件名与原文件名相同");return}if(/[<>:"/\\|?*]/.test(s)){d('文件名不能包含特殊字符: < > : " / \\ | ? *');return}c(!0),d(null);try{yield n(s),t()}catch(j){d(j instanceof Error?j.message:"重命名失败")}finally{c(!1)}}),f=()=>{i||t()};return r?a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:f,children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md mx-4",onClick:p=>p.stopPropagation(),children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"重命名文件"})}),a.jsxs("form",{onSubmit:g,children:[a.jsxs("div",{className:"px-6 py-4",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{htmlFor:"newName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"新文件名"}),a.jsx("input",{id:"newName",type:"text",value:s,onChange:p=>o(p.target.value),disabled:i,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white disabled:opacity-50",placeholder:"请输入新文件名",autoFocus:!0})]}),a.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:["原文件名: ",e]}),l&&a.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:l})]}),a.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3",children:[a.jsx("button",{type:"button",onClick:f,disabled:i,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"取消"}),a.jsx("button",{type:"submit",disabled:i,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:i?"重命名中...":"确认"})]})]})]})}):null},Pn=()=>{const{renameModalVisible:r,currentOperationItem:e,hideRenameModal:t}=_(),{refreshItems:n}=se(),{currentPath:s}=ye(),o=i=>h(null,null,function*(){if(!e)return;const c=q();if(!c)throw new Error("请先配置S3连接信息");try{const l=e.key.split("/");l[l.length-1]=i;const d=l.join("/");yield c.renameObject(e.key,d),C.success("重命名成功"),yield z.clearPath(s),yield n()}catch(l){throw console.error("重命名失败:",l),l}});return a.jsx(In,{visible:r,currentName:(e==null?void 0:e.name)||"",onClose:t,onRename:o})},Nn=({visible:r,currentKey:e,currentPath:t,onClose:n,onMove:s})=>{const[o,i]=m.useState(""),[c,l]=m.useState(!1),[d,g]=m.useState(null),[f,p]=m.useState([]),[y,j]=m.useState(!1);m.useEffect(()=>{r&&(i(t),g(null),E())},[r,t]);const E=()=>h(null,null,function*(){const b=q();if(b){j(!0);try{const I=(yield b.listObjects("")).filter(P=>P.isFolder).map(P=>P.key);p(["",...I])}catch(w){console.error("加载文件夹列表失败:",w)}finally{j(!1)}}}),v=b=>h(null,null,function*(){b.preventDefault();const w=e.split("/").pop()||"";if((o?`${o}${w}`:w)===e){g("目标路径与当前路径相同");return}l(!0),g(null);try{yield s(o),n()}catch(P){g(P instanceof Error?P.message:"移动失败")}finally{l(!1)}}),u=()=>{c||n()};return r?a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:u,children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md mx-4",onClick:b=>b.stopPropagation(),children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"移动文件"})}),a.jsxs("form",{onSubmit:v,children:[a.jsxs("div",{className:"px-6 py-4",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{htmlFor:"targetPath",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"目标路径"}),y?a.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"加载文件夹列表..."}):a.jsxs("select",{id:"targetPath",value:o,onChange:b=>i(b.target.value),disabled:c,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white disabled:opacity-50",children:[a.jsx("option",{value:"",children:"根目录 (/)"}),f.slice(1).map(b=>a.jsx("option",{value:b,children:b},b))]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"或输入自定义路径"}),a.jsx("input",{type:"text",value:o,onChange:b=>i(b.target.value),disabled:c,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white disabled:opacity-50",placeholder:"例如: images/2024/"}),a.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"路径应以 / 结尾，留空表示根目录"})]}),a.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:["当前位置: ",e]}),d&&a.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:d})]}),a.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3",children:[a.jsx("button",{type:"button",onClick:u,disabled:c,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"取消"}),a.jsx("button",{type:"submit",disabled:c,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:c?"移动中...":"确认"})]})]})]})}):null},Mn=()=>{const{moveModalVisible:r,currentOperationItem:e,hideMoveModal:t}=_(),{refreshItems:n}=se(),{currentPath:s}=ye(),o=i=>h(null,null,function*(){if(!e)return;const c=q();if(!c)throw new Error("请先配置S3连接信息");try{const l=e.key.split("/").pop()||"",d=i?`${i}${l}`:l;yield c.moveObject(e.key,d),C.success("移动成功"),yield z.clearPath(s),yield z.clearPath(i),yield n()}catch(l){throw console.error("移动失败:",l),l}});return a.jsx(Nn,{visible:r,currentKey:(e==null?void 0:e.key)||"",currentPath:s,onClose:t,onMove:o})};class _n extends m.Component{constructor(t){super(t);te(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,n){console.error("错误边界捕获到错误:",t,n),this.setState({error:t,errorInfo:n})}render(){return this.state.hasError?a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:a.jsx(Xt,{status:"error",title:"应用程序遇到错误",subTitle:"抱歉，应用程序遇到了一个意外错误。请尝试刷新页面。",extra:[a.jsx(T,{type:"primary",onClick:this.handleReset,children:"刷新页面"},"reload")],children:!1})}):this.props.children}}function On(){const r=W(t=>t.messages),e=W(t=>t.removeMessage);return m.useEffect(()=>{r.forEach(t=>{const n=t.id;switch(t.type){case"success":S.success({content:t.content,key:n,duration:(t.duration||3e3)/1e3,onClose:()=>e(t.id)});break;case"error":S.error({content:t.content,key:n,duration:(t.duration||5e3)/1e3,onClose:()=>e(t.id)});break;case"info":S.info({content:t.content,key:n,duration:(t.duration||3e3)/1e3,onClose:()=>e(t.id)});break;case"warning":S.warning({content:t.content,key:n,duration:(t.duration||3e3)/1e3,onClose:()=>e(t.id)});break;case"loading":S.loading({content:t.content,key:n,duration:0});break}})},[r,e]),null}function En(){const r=re(o=>o.visible),e=re(o=>o.options),t=re(o=>o.loading),n=re(o=>o.handleOk),s=re(o=>o.handleCancel);return e?a.jsx(Ze,{open:r,title:e.title,okText:e.okText||"确定",cancelText:e.cancelText||"取消",okButtonProps:{danger:e.okType==="danger",loading:t},onOk:n,onCancel:s,maskClosable:!t,closable:!t,children:e.content}):null}function Rn(){const r=Ce(t=>t.loading),e=Ce(t=>t.tip);return r?a.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black bg-opacity-30",children:a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-8 shadow-xl",children:a.jsx(er,{size:"large",tip:e})})}):null}function Ln(){const r=_(i=>i.theme==="dark"),e=_(i=>i.loadThemeFromStorage),t=_(i=>i.showSettingsModal),n=pe(i=>i.config),s=pe(i=>i.isInitialized),o=pe(i=>i.loadConfigFromStorage);return m.useEffect(()=>{e(),o()},[e,o]),m.useEffect(()=>{s&&!n&&t()},[s,n,t]),a.jsx(tr,{locale:kr,theme:{algorithm:r?et.darkAlgorithm:et.defaultAlgorithm},children:a.jsxs("div",{className:`min-h-screen ${r?"dark bg-gray-900":"bg-gray-50"}`,children:[a.jsx(qr,{}),a.jsx(mn,{}),a.jsx(yn,{}),a.jsx(bn,{}),a.jsx(vn,{}),a.jsx(Sn,{}),a.jsx(Pn,{}),a.jsx(Mn,{}),a.jsx(On,{}),a.jsx(En,{}),a.jsx(Rn,{})]})})}ur.createRoot(document.getElementById("root")).render(a.jsx(m.StrictMode,{children:a.jsx(_n,{children:a.jsx(Ln,{})})}))});export default $n();
