var K=Object.defineProperty;var U=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var j=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r);var N=Math.pow,H=(r,e,t)=>e in r?K(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,O=(r,e)=>{for(var t in e||(e={}))$.call(e,t)&&H(r,t,e[t]);if(U)for(var t of U(e))q.call(e,t)&&H(r,t,e[t]);return r};var E=(r,e,t)=>H(r,typeof e!="symbol"?e+"":e,t);var B=(r,e,t)=>new Promise((i,y)=>{var o=s=>{try{c(t.next(s))}catch(n){y(n)}},l=s=>{try{c(t.throw(s))}catch(n){y(n)}},c=s=>s.done?i(s.value):Promise.resolve(s.value).then(o,l);c((t=t.apply(r,e)).next())}),I=function(r,e){this[0]=r,this[1]=e},_=(r,e,t)=>{var i=(l,c,s,n)=>{try{var h=t[l](c),g=(c=h.value)instanceof I,f=h.done;Promise.resolve(g?c[0]:c).then(m=>g?i(l==="return"?l:"next",c[1]?{done:m.done,value:m.value}:m,s,n):s({value:m,done:f})).catch(m=>i("throw",m,s,n))}catch(m){n(m)}},y=l=>o[l]=c=>new Promise((s,n)=>i(l,c,s,n)),o={};return t=t.apply(r,e),o[j("asyncIterator")]=()=>o,y("next"),y("throw"),y("return"),o};var D=(r,e,t)=>(e=r[j("asyncIterator")])?e.call(r):(r=r[j("iterator")](),e={},t=(i,y)=>(y=r[i])&&(e[i]=o=>new Promise((l,c,s)=>(o=y.call(r,o),s=o.done,Promise.resolve(o.value).then(n=>l({value:n,done:s}),c)))),t("next"),t("return"),e);import{t as A,f as F}from"./aws-MgGeQvF_.js";class L{constructor({marshaller:e,serializer:t,deserializer:i,serdeContext:y,defaultContentType:o}){E(this,"marshaller");E(this,"serializer");E(this,"deserializer");E(this,"serdeContext");E(this,"defaultContentType");this.marshaller=e,this.serializer=t,this.deserializer=i,this.serdeContext=y,this.defaultContentType=o}serializeEventStream(y){return B(this,arguments,function*({eventStream:e,requestSchema:t,initialRequest:i}){const o=this.marshaller,l=t.getEventStreamMember(),c=t.getMemberSchema(l),s=this.serializer,n=this.defaultContentType,h=Symbol("initialRequestMarker"),g={[Symbol.asyncIterator](){return _(this,null,function*(){if(i){const u={":event-type":{type:"string",value:"initial-request"},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:n}};s.write(t,i);const b=s.flush();yield{[h]:!0,headers:u,body:b}}try{for(var m=D(e),p,a,d;p=!(a=yield new I(m.next())).done;p=!1){const u=a.value;yield u}}catch(a){d=[a]}finally{try{p&&(a=m.return)&&(yield new I(a.call(m)))}finally{if(d)throw d[0]}}})}};return o.serialize(g,m=>{var S;if(m[h])return{headers:m.headers,body:m.body};const p=(S=Object.keys(m).find(T=>T!=="__type"))!=null?S:"",{additionalHeaders:a,body:d,eventType:u,explicitPayloadContentType:b}=this.writeEventBody(p,c,m);return{headers:O({":event-type":{type:"string",value:u},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:b!=null?b:n}},a),body:d}})})}deserializeEventStream(y){return B(this,arguments,function*({response:e,responseSchema:t,initialResponseContainer:i}){var m;const o=this.marshaller,l=t.getEventStreamMember(),s=t.getMemberSchema(l).getMemberSchemas(),n=Symbol("initialResponseMarker"),h=o.deserialize(e.body,a=>B(this,null,function*(){var b,v,S,T;const d=(b=Object.keys(a).find(w=>w!=="__type"))!=null?b:"",u=a[d].body;if(d==="initial-response"){const w=yield this.deserializer.read(t,u);return delete w[l],O({[n]:!0},w)}else if(d in s){const w=s[d];if(w.isStructSchema()){const z={};let C=!1;for(const[M,x]of w.structIterator()){const{eventHeader:P,eventPayload:R}=x.getMergedTraits();if(C=C||!!(P||R),R)x.isBlobSchema()?z[M]=u:x.isStringSchema()?z[M]=((S=(v=this.serdeContext)==null?void 0:v.utf8Encoder)!=null?S:A)(u):x.isStructSchema()&&(z[M]=yield this.deserializer.read(x,u));else if(P){const k=(T=a[d].headers[M])==null?void 0:T.value;k!=null&&(x.isNumericSchema()?k&&typeof k=="object"&&"bytes"in k?z[M]=BigInt(k.toString()):z[M]=Number(k):z[M]=k)}}if(C)return{[d]:z}}return{[d]:yield this.deserializer.read(w,u)}}else return{$unknown:a}})),g=h[Symbol.asyncIterator](),f=yield g.next();if(f.done)return h;if((m=f.value)!=null&&m[n]){if(!t)throw new Error("@smithy::core/protocols - initial-response event encountered in event stream but no response schema given.");for(const[a,d]of Object.entries(f.value))i[a]=d}return{[Symbol.asyncIterator](){return _(this,null,function*(){var a;for((a=f==null?void 0:f.value)!=null&&a[n]||(yield f.value);;){const{done:d,value:u}=yield new I(g.next());if(d)break;yield u}})}}})}writeEventBody(e,t,i){var f,m;const y=this.serializer;let o=e,l=null,c;const s=t.getSchema()[4].includes(e),n={};if(s){const p=t.getMemberSchema(e);if(p.isStructSchema()){for(const[a,d]of p.structIterator()){const{eventHeader:u,eventPayload:b}=d.getMergedTraits();if(b)l=a;else if(u){const v=i[e][a];let S="binary";d.isNumericSchema()?N(-2,31)<=v&&v<=N(2,31)-1?S="integer":S="long":d.isTimestampSchema()?S="timestamp":d.isStringSchema()?S="string":d.isBooleanSchema()&&(S="boolean"),v!=null&&(n[a]={type:S,value:v},delete i[e][a])}}if(l!==null){const a=p.getMemberSchema(l);a.isBlobSchema()?c="application/octet-stream":a.isStringSchema()&&(c="text/plain"),y.write(a,i[e][l])}else y.write(p,i[e])}else throw new Error("@smithy/core/event-streams - non-struct member not supported in event stream union.")}else{const[p,a]=i[e];o=p,y.write(15,a)}const h=y.flush();return{body:typeof h=="string"?((m=(f=this.serdeContext)==null?void 0:f.utf8Decoder)!=null?m:F)(h):h,eventType:o,explicitPayloadContentType:c,additionalHeaders:n}}}export{L as EventStreamSerde};
